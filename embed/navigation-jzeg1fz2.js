import{M as L}from"./runtime-emnwg501.js";import"./runtime-zmh0xn4h.js";import"./runtime-nmjc1qqb.js";var W={currentPath:window.location.pathname,isNavigating:!1,pendingNavigation:null},F=new Set,K=new Set;function b(j){return F.add(j),()=>F.delete(j)}function m(j){return K.add(j),()=>K.delete(j)}function H(j){let B=j.getAttribute("href");if(!B||B.startsWith("#")||B.startsWith("javascript:"))return!1;if(B.startsWith("http://")||B.startsWith("https://")||B.startsWith("//"))try{return new URL(B,window.location.origin).origin===window.location.origin}catch{return!1}if(j.hasAttribute("data-external")||j.hasAttribute("download")||j.getAttribute("target")==="_blank")return!1;return!0}var q=new Map;async function M(j){try{let B=await fetch(j,{headers:{"X-Requested-With":"GoSPA-Navigate",Accept:"text/html"}});if(!B.ok)return console.error("[GoSPA] Navigation failed:",B.status),null;let G=await B.text(),J=new DOMParser().parseFromString(G,"text/html"),Z=J.querySelector("[data-gospa-page-content]"),_=J.querySelector("[data-gospa-root]"),$=J.querySelector("main"),Q=Z?Z.innerHTML:_?_.innerHTML:$?$.innerHTML:J.body.innerHTML,V=J.querySelector("title")?.textContent||"",U=J.querySelector("head"),X=U?U.innerHTML:"";return{content:Q,title:V,head:X}}catch(B){return console.error("[GoSPA] Navigation error:",B),null}}async function O(j){let B=q.get(j);if(B)return q.delete(j),B;return M(j)}async function D(j){try{return await L(j)}catch(B){console.error("[GoSPA] Sanitization failed:",B);let G=document.createElement("div");return G.textContent=j,G.innerHTML}}async function P(j){if(j.title)document.title=j.title;let B=document.querySelector("[data-gospa-page-content]"),G=document.querySelector("[data-gospa-root]"),R=await D(j.content);if(B)B.innerHTML=R;else if(G)G.innerHTML=R;else{let J=document.querySelector("main");if(J)J.innerHTML=R;else document.body.innerHTML=R}y(j.head),await N()}function y(j){let G=new DOMParser().parseFromString(`<html><head>${j}</head></html>`,"text/html"),R=G.querySelector("head");if(!R)return;let J=G.querySelector("title")?.textContent;if(J&&J!==document.title)document.title=J;Array.from(R.querySelectorAll("link")).forEach((Q)=>{let V=Q.getAttribute("href"),U=Q.getAttribute("rel"),X=V?`link[href="${V}"]`:null;if(!(X?document.head.querySelector(X):null)){let A=Q.cloneNode(!0);A.setAttribute("data-gospa-head","true"),document.head.appendChild(A)}}),Array.from(R.querySelectorAll("meta")).forEach((Q)=>{let V=Q.getAttribute("name"),U=Q.getAttribute("property"),X=Q.getAttribute("http-equiv"),Y="";if(V)Y=`meta[name="${V}"]`;else if(U)Y=`meta[property="${U}"]`;else if(X)Y=`meta[http-equiv="${X}"]`;let A=Y?document.head.querySelector(Y):null;if(A){let I=Q.getAttribute("content");if(I)A.setAttribute("content",I)}else{let I=Q.cloneNode(!0);I.setAttribute("data-gospa-head","true"),document.head.appendChild(I)}}),Array.from(R.querySelectorAll("style")).forEach((Q)=>{let V=Q.id,U=V?`style#${V}`:null;if(!(U?document.head.querySelector(U):null)){let Y=Q.cloneNode(!0);Y.setAttribute("data-gospa-head","true"),document.head.appendChild(Y)}}),R.querySelectorAll("script[data-gospa-head]").forEach((Q)=>{let V=Q.getAttribute("src");if(!(V?document.head.querySelector(`script[src="${V}"]`):null)){let X=document.createElement("script");Array.from(Q.attributes).forEach((Y)=>X.setAttribute(Y.name,Y.value)),X.textContent=Q.textContent,document.head.appendChild(X)}})}async function N(){let j=document.querySelectorAll("[data-on]"),B=document.querySelectorAll("[data-bind]"),G=window.__gospa__,R=G?._ws;j.forEach((J)=>{let Z=J.getAttribute("data-on");if(!Z)return;let[_,$]=Z.split(":");if(!_||!$)return;let Q=J.cloneNode(!0);J.parentNode?.replaceChild(Q,J),Q.addEventListener(_,()=>{if(R&&R.readyState===WebSocket.OPEN)R.send(JSON.stringify({action:$}))})});for(let J of B){let Z=J.getAttribute("data-bind");if(!Z)continue;let[_,$]=Z.split(":");if(!_||!$)continue;let Q=G?.state?.get($);if(!Q)continue;let V=async(U)=>{switch(_){case"text":J.textContent=U;break;case"html":J.innerHTML=await D(U);break;case"value":J.value=U;break;case"checked":J.checked=U;break;case"show":J.style.display=U?"":"none";break}};await V(Q.get()),Q.subscribe((U)=>V(U))}}async function S(j,B={}){if(j===W.currentPath&&!B.replace)return!1;if(W.pendingNavigation)await W.pendingNavigation;W.isNavigating=!0,F.forEach((G)=>G(j));try{return W.pendingNavigation=(async()=>{let G=await O(j);if(!G)return window.location.href=j,!1;if(B.replace)window.history.replaceState({path:j},"",j);else window.history.pushState({path:j},"",j);if(W.currentPath=j,await P(G),B.scrollToTop!==!1)window.scrollTo(0,0);return K.forEach((R)=>R(j)),document.dispatchEvent(new CustomEvent("gospa:navigated",{detail:{path:j}})),!0})(),await W.pendingNavigation}finally{W.isNavigating=!1,W.pendingNavigation=null}}function g(){window.history.back()}function C(){window.history.forward()}function u(j){window.history.go(j)}function w(){return W.currentPath}function E(){return W.isNavigating}function T(j){let B=window.location.pathname;F.forEach((G)=>G(B)),O(B).then((G)=>{if(G)W.currentPath=B,P(G).then(()=>{K.forEach((R)=>R(B)),document.dispatchEvent(new CustomEvent("gospa:navigated",{detail:{path:B}}))});else window.location.reload()})}function z(j){if(j.button!==0||j.metaKey||j.ctrlKey||j.shiftKey||j.altKey)return;let G=j.target.closest("a[href]");if(!G)return;if(!H(G))return;j.preventDefault();let R=G.getAttribute("href");if(!R)return;S(R)}function x(){document.addEventListener("click",z),window.addEventListener("popstate",T),document.documentElement.setAttribute("data-gospa-spa","true")}function v(){document.removeEventListener("click",z),window.removeEventListener("popstate",T),document.documentElement.removeAttribute("data-gospa-spa")}async function k(j){if(q.has(j))return;let B=await M(j);if(B)q.set(j,B),setTimeout(()=>q.delete(j),30000)}function d(){return{get path(){return W.currentPath},get isNavigating(){return W.isNavigating},navigate:S,back:g,forward:C,go:u,prefetch:k}}if(typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",x);else x();export{k as prefetch,b as onBeforeNavigate,m as onAfterNavigate,S as navigate,E as isNavigating,x as initNavigation,u as go,w as getCurrentPath,C as forward,v as destroyNavigation,d as createNavigationState,g as back};
export{b as A,m as B,S as C,g as D,C as E,u as F,w as G,E as H,x as I,v as J,k as K,d as L};
