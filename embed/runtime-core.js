import{S as qq,T as Qq,U as y,V as f,W as Uq,X as Yq}from"./runtime-hyt5wa6f.js";import{$ as o,aa as n,ba as S,ca as t,da as e,ea as L,fa as k}from"./runtime-9yfwsbhc.js";import{na as O,oa as H}from"./runtime-sm05dxvs.js";var p={prevent:(q,Q)=>{return q.preventDefault(),Q(q)},stop:(q,Q)=>{return q.stopPropagation(),Q(q)},capture:(q,Q)=>Q(q),once:(q,Q)=>Q(q),passive:(q,Q)=>Q(q),self:(q,Q)=>{if(q.target===q.currentTarget)return Q(q)}},W=new WeakMap;function b(q,Q){return(U)=>{for(let Z of Q){if(Z==="capture"||Z==="once"||Z==="passive")continue;let $=p[Z];$(U,q)}if(Q.filter((Z)=>!["capture","once","passive"].includes(Z)).length===0)return q(U)}}function T(q){let Q=q.split(":"),U=Q[0],Y=Q.slice(1);return{event:U,modifiers:Y}}function I(q,Q,U){let{event:Y,modifiers:Z}=T(Q),$={capture:Z.includes("capture"),once:Z.includes("once"),passive:Z.includes("passive")},V=b(U,Z);if(q.addEventListener(Y,V,$),!W.has(q))W.set(q,new Map);let F=W.get(q);if(!F.has(Q))F.set(Q,new Set);return F.get(Q).add(V),()=>{q.removeEventListener(Y,V,$);let J=F.get(Q);if(J){if(J.delete(V),J.size===0)F.delete(Q)}}}function l(q){let Q=W.get(q);if(!Q)return;for(let[U,Y]of Q){let{event:Z,modifiers:$}=T(U),V={capture:$.includes("capture")};for(let F of Y)q.removeEventListener(Z,F,V)}W.delete(q)}function m(q,Q){let U=null;return(Y)=>{if(U)clearTimeout(U);U=setTimeout(()=>{q(Y),U=null},Q)}}function d(q,Q){let U=!1;return(Y)=>{if(!U)q(Y),U=!0,setTimeout(()=>{U=!1},Q)}}var i={value:(q)=>q.target.value,checked:(q)=>q.target.checked,numberValue:(q)=>Number(q.target.value),files:(q)=>q.target.files,formData:(q)=>{return q.preventDefault(),new FormData(q.target)}};function r(q,Q,U,Y){let{event:Z,modifiers:$}=T(U),V=(J)=>{if(J.target.closest(Q))b(Y,$)(J)},F={capture:$.includes("capture"),passive:$.includes("passive")};return q.addEventListener(Z,V,F),()=>{q.removeEventListener(Z,V,F)}}function a(q,Q,U){let Y=Array.isArray(q)?q:[q];return(Z)=>{if(Y.includes(Z.key)){if(U?.preventDefault)Z.preventDefault();Q(Z)}}}var s={enter:"Enter",escape:"Escape",tab:"Tab",space:" ",arrowUp:"ArrowUp",arrowDown:"ArrowDown",arrowLeft:"ArrowLeft",arrowRight:"ArrowRight"};var x="/_gospa/remote";function C(q){if(q.prefix)x=q.prefix}function K(){return x}async function D(q,Q,U={}){let Y=`${x}/${encodeURIComponent(q)}`,Z=U.timeout??30000,$=Z!==void 0||U.signal?new AbortController:null,V=$?setTimeout(()=>$.abort(),Z):null,F;if(U.signal&&$)F=()=>$.abort(),U.signal.addEventListener("abort",F);let J=$?.signal??U.signal;try{let G=await fetch(Y,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...U.headers},body:Q!==void 0?JSON.stringify(Q):void 0,signal:J,credentials:"same-origin"});if(V!==null)clearTimeout(V);let P,z;if(G.headers.get("content-type")?.includes("application/json"))try{let B=await G.json();if(!G.ok)z=B.error||`HTTP ${G.status}`;else P=B}catch(B){z=B instanceof Error?`Invalid JSON: ${B.message}`:"Invalid JSON response"}else if(!G.ok)z=`HTTP ${G.status}: ${G.statusText}`;return{data:P,error:z,status:G.status,ok:G.ok}}catch(G){if(V!==null)clearTimeout(V);if(G instanceof Error){if(G.name==="AbortError")return{error:"Request timeout",status:0,ok:!1};return{error:G.message,status:0,ok:!1}}return{error:"Unknown error",status:0,ok:!1}}finally{if(F&&U.signal)U.signal.removeEventListener("abort",F)}}function A(q){return(Q,U)=>{return D(q,Q,U)}}if(typeof window<"u")window.__GOSPA_REMOTE__={remote:D,remoteAction:A,configureRemote:C,getRemotePrefix:K};var X=new Map,_=new k,h=!1,N={},j=null,E=null,R=null;function Zq(q={}){if(h){console.warn("GoSPA runtime already initialized");return}if(N=q,h=!0,N.wsUrl)j=import("./websocket-3s5snmzx.js").then((Q)=>{return Q.initWebSocket({url:N.wsUrl,onMessage:$q}).connect().catch((Y)=>{if(N.onConnectionError)N.onConnectionError(Y);else if(N.debug)console.error("WebSocket connection failed:",Y)}),Q});window.addEventListener("error",(Q)=>{if(N.debug)console.error("Runtime error:",Q.error)}),window.__GOSPA__={config:N,components:X,globalState:_,init:Zq,createComponent:v,destroyComponent:Gq,getComponent:Jq,getState:g,setState:Xq,callAction:c,bind:M,autoInit:w,remote:D,remoteAction:A,configureRemote:C,getRemotePrefix:K}}function $q(q){switch(q.type){case"init":if(q.componentId&&q.data){let Q=X.get(q.componentId);if(Q)Q.states.fromJSON(q.data)}else if(q.state){let Q=q.state;for(let[U,Y]of Object.entries(Q)){let Z=U.indexOf(".");if(Z>0){let $=U.substring(0,Z),V=U.substring(Z+1),F=X.get($);if(F)F.states.set(V,Y)}else{for(let $ of X.values())if($.states.get(U)!==void 0)$.states.set(U,Y);_.set(U,Y)}}}break;case"patch":if(q.patch){let Q=q.patch;_.fromJSON(Q)}break;case"update":if(q.componentId&&q.diff){let Q=X.get(q.componentId);if(Q)Q.states.fromJSON(q.diff)}break;case"sync":if(q.data)_.fromJSON(q.data);else if(q.key!==void 0&&q.value!==void 0){let{key:Q,componentId:U}=q;if(U){let Y=X.get(U);if(Y)Y.states.set(Q,q.value)}else _.set(Q,q.value)}break;case"error":if(N.debug)console.error("Server error:",q.error);break}}var u="gospa_local_";function Vq(q){try{let Q=localStorage.getItem(u+q);return Q?JSON.parse(Q):null}catch{return null}}function Fq(q,Q){try{localStorage.setItem(u+q,JSON.stringify(Q))}catch{}}function v(q,Q,U=!1){let Y={id:q.id,definition:q,states:new k,derived:new Map,unsubscribers:[],cleanup:[],element:Q||null,isLocal:U};if(U){let Z=Vq(q.id);if(Z)for(let[$,V]of Object.entries(Z))Y.states.set($,V)}for(let[Z,$]of Object.entries(q.state))if(!U||Y.states.get(Z)===void 0)Y.states.set(Z,$);if(U)for(let Z of Object.keys(q.state)){let $=Y.states.get(Z);if($){let V=L($,()=>{Fq(q.id,Y.states.toJSON())});Y.unsubscribers.push(V)}}if(q.computed)for(let[Z,$]of Object.entries(q.computed))Y.derived.set(Z,new S($));if(q.watch)for(let[Z,$]of Object.entries(q.watch)){let V=Y.states.get(Z);if(V)Y.unsubscribers.push(L(V,$))}if(q.mount){let Z=q.mount();if(Z)Y.cleanup.push(Z)}return X.set(q.id,Y),Y}function Gq(q){let Q=X.get(q);if(!Q)return;if(Q.definition.destroy)Q.definition.destroy();for(let U of Q.cleanup)U();for(let U of Q.unsubscribers)U();for(let U of Q.derived.values())U.dispose();X.delete(q)}function Jq(q){return X.get(q)}function g(q,Q){return X.get(q)?.states.get(Q)}async function Xq(q,Q,U){let Y=X.get(q);if(!Y)return;if(Y.states.set(Q,U),!Y.isLocal&&j){let $=(await j).getWebSocketClient();if($?.isConnected)$.send({type:"update",componentId:q,payload:{key:Q,value:U}})}}function c(q,Q,...U){let Y=X.get(q);if(!Y?.definition.actions?.[Q])throw Error(`Action "${Q}" not found on component "${q}"`);return Y.definition.actions[Q](...U)}function M(q,Q,U,Y,Z){let $=g(q,Y);if(!$)return console.warn(`State "${Y}" not found on component "${q}"`),()=>{};if(Z?.twoWay)return f(Q,$);return y(Q,$,{type:U,transform:Z?.transform})}function w(){let q=document.querySelectorAll("[data-gospa-component]");for(let Q of q){let U=Q.getAttribute("data-gospa-component"),Y=Q.getAttribute("data-gospa-state"),Z=Q.hasAttribute("data-gospa-local");if(!U)continue;let $={};try{$=Y?JSON.parse(Y):{}}catch{}let V=Q.getAttribute("data-gospa-hydrate")||N.hydration?.mode||"immediate",F=()=>{v({id:U,name:U,state:$},Q,Z),Nq(Q)};if(V==="visible"){let J=new IntersectionObserver((G)=>{if(G[0].isIntersecting)J.disconnect(),F()});J.observe(Q)}else if(V==="idle"&&"requestIdleCallback"in window)window.requestIdleCallback(()=>F(),{timeout:N.hydration?.timeout||2000});else F()}}function Nq(q=document){for(let Q of q.querySelectorAll("[data-bind]")){let U=Q.closest("[data-gospa-component]")?.getAttribute("data-gospa-component")||"",Y=Q.getAttribute("data-bind"),Z=Q.getAttribute("data-transform");if(!Y)continue;let[$,V="text"]=Y.split(":").map((J)=>J.trim()),F;if(Z&&typeof window[Z]==="function")F=window[Z];M(U,Q,V,$,{transform:F})}for(let Q of q.querySelectorAll("[data-on]")){let U=Q.closest("[data-gospa-component]")?.getAttribute("data-gospa-component")||"",Y=Q.getAttribute("data-on");if(!Y)continue;let[Z,$,V]=Y.split(":").map((J)=>J.trim()),F=V?V.split(",").map((J)=>J.trim()):[];I(Q,Z,async()=>{try{c(U,$,...F)}catch{if(j){let G=(await j).getWebSocketClient();if(G?.isConnected)G.sendAction($)}}})}for(let Q of q.querySelectorAll("[data-model]")){let U=Q.closest("[data-gospa-component]")?.getAttribute("data-gospa-component")||"",Y=Q.getAttribute("data-model");if(Y)M(U,Q,"value",Y,{twoWay:!0})}}async function Hq(){if(!j)j=import("./websocket-3s5snmzx.js");return j}async function Pq(){if(!E)E=import("./navigation-yxp4bvt9.js");return E}async function Tq(){if(!R)R=import("./transition-5yeb629b.js");return R}if(typeof document<"u"){if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>{if(document.documentElement.hasAttribute("data-gospa-auto"))w()});else if(document.documentElement.hasAttribute("data-gospa-auto"))w()}export{L as watch,Qq as unregisterBinding,i as transformers,d as throttle,Xq as setState,Yq as renderList,Uq as renderIf,A as remoteAction,D as remote,qq as registerBinding,a as onKey,I as on,l as offAll,s as keys,Zq as init,Hq as getWebSocket,Tq as getTransitions,g as getState,K as getRemotePrefix,Pq as getNavigation,Jq as getComponent,e as effect,Gq as destroyComponent,r as delegate,m as debounce,v as createComponent,C as configureRemote,c as callAction,f as bindTwoWay,y as bindElement,M as bind,o as batch,w as autoInit,k as StateMap,n as Rune,t as Effect,S as Derived};
export{I as a,l as b,m as c,d,i as e,r as f,a as g,s as h,C as i,K as j,D as k,A as l,Zq as m,v as n,Gq as o,Jq as p,g as q,Xq as r,c as s,M as t,w as u,Hq as v,Pq as w,Tq as x};
