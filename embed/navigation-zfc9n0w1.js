import{M as _}from"./runtime-r397vfs2.js";import"./runtime-1w8zs78r.js";import"./runtime-vhktm8ba.js";var R={currentPath:window.location.pathname,isNavigating:!1,pendingNavigation:null},$=new Set,x=new Set;function N(j){return $.add(j),()=>$.delete(j)}function w(j){return x.add(j),()=>x.delete(j)}function z(j){let q=j.getAttribute("href");if(!q||q.startsWith("#")||q.startsWith("javascript:"))return!1;if(q.startsWith("http://")||q.startsWith("https://")||q.startsWith("//"))try{return new URL(q,window.location.origin).origin===window.location.origin}catch{return!1}if(j.hasAttribute("data-external")||j.hasAttribute("download")||j.getAttribute("target")==="_blank")return!1;return!0}var Y=new Map;async function I(j){try{let q=await fetch(j,{headers:{"X-Requested-With":"GoSPA-Navigate",Accept:"text/html"}});if(!q.ok)return console.error("[GoSPA] Navigation failed:",q.status),null;let B=await q.text(),G=new DOMParser().parseFromString(B,"text/html"),J=G.querySelector("main"),V=J?J.innerHTML:G.body.innerHTML,W=G.querySelector("title")?.textContent||"",U=G.querySelector("head"),Z=U?U.innerHTML:"";return{content:V,title:W,head:Z}}catch(q){return console.error("[GoSPA] Navigation error:",q),null}}async function F(j){let q=Y.get(j);if(q)return Y.delete(j),q;return I(j)}function K(j){if(j.title)document.title=j.title;let q=document.querySelector("main");if(q)q.innerHTML=_(j.content);else document.body.innerHTML=_(j.content);S(j.head),T()}function S(j){let Q=new DOMParser().parseFromString(`<html><head>${j}</head></html>`,"text/html").querySelector("head");if(!Q)return;document.head.querySelectorAll("[data-gospa-head]").forEach((J)=>J.remove()),Q.querySelectorAll("title, meta, link, style, script").forEach((J)=>{if(J.tagName==="SCRIPT"&&!J.hasAttribute("data-gospa-head"))return;J.setAttribute("data-gospa-head","true"),document.head.appendChild(J.cloneNode(!0))})}function T(){let j=document.querySelectorAll("[data-on]"),q=document.querySelectorAll("[data-bind]"),B=window.__gospa__,Q=B?._ws;j.forEach((G)=>{let J=G.getAttribute("data-on");if(!J)return;let[V,W]=J.split(":");if(!V||!W)return;let U=G.cloneNode(!0);G.parentNode?.replaceChild(U,G),U.addEventListener(V,()=>{if(Q&&Q.readyState===WebSocket.OPEN)Q.send(JSON.stringify({action:W}))})}),q.forEach((G)=>{let J=G.getAttribute("data-bind");if(!J)return;let[V,W]=J.split(":");if(!V||!W)return;let U=B?.state?.get(W);if(!U)return;let Z=(X)=>{switch(V){case"text":G.textContent=X;break;case"html":G.innerHTML=_(X);break;case"value":G.value=X;break;case"checked":G.checked=X;break;case"show":G.style.display=X?"":"none";break}};Z(U.get()),U.subscribe(Z)})}async function L(j,q={}){if(j===R.currentPath&&!q.replace)return!1;if(R.pendingNavigation)await R.pendingNavigation;R.isNavigating=!0,$.forEach((B)=>B(j));try{return R.pendingNavigation=(async()=>{let B=await F(j);if(!B)return window.location.href=j,!1;if(q.replace)window.history.replaceState({path:j},"",j);else window.history.pushState({path:j},"",j);if(R.currentPath=j,K(B),q.scrollToTop!==!1)window.scrollTo(0,0);return x.forEach((Q)=>Q(j)),!0})(),await R.pendingNavigation}finally{R.isNavigating=!1,R.pendingNavigation=null}}function D(){window.history.back()}function P(){window.history.forward()}function y(j){window.history.go(j)}function g(){return R.currentPath}function C(){return R.isNavigating}function M(j){let q=window.location.pathname;$.forEach((B)=>B(q)),F(q).then((B)=>{if(B)R.currentPath=q,K(B),x.forEach((Q)=>Q(q));else window.location.reload()})}function O(j){if(j.button!==0||j.metaKey||j.ctrlKey||j.shiftKey||j.altKey)return;let B=j.target.closest("a[href]");if(!B)return;if(!z(B))return;j.preventDefault();let Q=B.getAttribute("href");if(!Q)return;L(Q)}function A(){document.addEventListener("click",O),window.addEventListener("popstate",M),document.documentElement.setAttribute("data-gospa-spa","true"),console.log("[GoSPA] SPA navigation initialized")}function u(){document.removeEventListener("click",O),window.removeEventListener("popstate",M),document.documentElement.removeAttribute("data-gospa-spa")}async function H(j){if(Y.has(j))return;let q=await I(j);if(q)Y.set(j,q),setTimeout(()=>Y.delete(j),30000)}function k(){return{get path(){return R.currentPath},get isNavigating(){return R.isNavigating},navigate:L,back:D,forward:P,go:y,prefetch:H}}if(typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",A);else A();export{H as prefetch,N as onBeforeNavigate,w as onAfterNavigate,L as navigate,C as isNavigating,A as initNavigation,y as go,g as getCurrentPath,P as forward,u as destroyNavigation,k as createNavigationState,D as back};
export{N as A,w as B,L as C,D,P as E,y as F,g as G,C as H,A as I,u as J,H as K,k as L};
