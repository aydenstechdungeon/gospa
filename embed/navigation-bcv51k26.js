import{Q as L}from"./runtime-kzfvzrpk.js";import"./runtime-7ws0tb7k.js";import"./runtime-sm05dxvs.js";var W={currentPath:window.location.pathname,isNavigating:!1,pendingNavigation:null},F=new Set,K=new Set;function b(j){return F.add(j),()=>F.delete(j)}function m(j){return K.add(j),()=>K.delete(j)}function H(j){let B=j.getAttribute("href");if(!B||B.startsWith("#")||B.startsWith("javascript:"))return!1;if(B.startsWith("http://")||B.startsWith("https://")||B.startsWith("//"))try{return new URL(B,window.location.origin).origin===window.location.origin}catch{return!1}if(j.hasAttribute("data-external")||j.hasAttribute("download")||j.getAttribute("target")==="_blank")return!1;return!0}var q=new Map;async function M(j){try{let B=await fetch(j,{headers:{"X-Requested-With":"GoSPA-Navigate",Accept:"text/html"}});if(!B.ok)return console.error("[GoSPA] Navigation failed:",B.status),null;let Q=await B.text(),G=new DOMParser().parseFromString(Q,"text/html"),Z=G.querySelector("[data-gospa-page-content]"),_=G.querySelector("[data-gospa-root]"),$=G.querySelector("main"),J=Z?Z.innerHTML:_?_.innerHTML:$?$.innerHTML:G.body.innerHTML,V=G.querySelector("title")?.textContent||"",U=G.querySelector("head"),X=U?U.innerHTML:"";return{content:J,title:V,head:X}}catch(B){return console.error("[GoSPA] Navigation error:",B),null}}async function O(j){let B=q.get(j);if(B)return q.delete(j),B;return M(j)}async function D(j){try{return await L(j)}catch(B){console.error("[GoSPA] Sanitization failed:",B);let Q=document.createElement("div");return Q.textContent=j,Q.innerHTML}}async function P(j){if(j.title)document.title=j.title;let B=document.querySelector("[data-gospa-page-content]"),Q=document.querySelector("[data-gospa-root]"),R=await D(j.content);if(B)B.innerHTML=R;else if(Q)Q.innerHTML=R;else{let G=document.querySelector("main");if(G)G.innerHTML=R;else document.body.innerHTML=R}y(j.head),await N()}function y(j){let Q=new DOMParser().parseFromString(`<html><head>${j}</head></html>`,"text/html"),R=Q.querySelector("head");if(!R)return;let G=Q.querySelector("title")?.textContent;if(G&&G!==document.title)document.title=G;Array.from(R.querySelectorAll("link")).forEach((J)=>{let V=J.getAttribute("href"),U=J.getAttribute("rel"),X=V?`link[href="${V}"]`:null;if(!(X?document.head.querySelector(X):null)){let A=J.cloneNode(!0);A.setAttribute("data-gospa-head","true"),document.head.appendChild(A)}}),Array.from(R.querySelectorAll("meta")).forEach((J)=>{let V=J.getAttribute("name"),U=J.getAttribute("property"),X=J.getAttribute("http-equiv"),Y="";if(V)Y=`meta[name="${V}"]`;else if(U)Y=`meta[property="${U}"]`;else if(X)Y=`meta[http-equiv="${X}"]`;let A=Y?document.head.querySelector(Y):null;if(A){let I=J.getAttribute("content");if(I)A.setAttribute("content",I)}else{let I=J.cloneNode(!0);I.setAttribute("data-gospa-head","true"),document.head.appendChild(I)}}),Array.from(R.querySelectorAll("style")).forEach((J)=>{let V=J.id,U=V?`style#${V}`:null;if(!(U?document.head.querySelector(U):null)){let Y=J.cloneNode(!0);Y.setAttribute("data-gospa-head","true"),document.head.appendChild(Y)}}),R.querySelectorAll("script[data-gospa-head]").forEach((J)=>{let V=J.getAttribute("src");if(!(V?document.head.querySelector(`script[src="${V}"]`):null)){let X=document.createElement("script");Array.from(J.attributes).forEach((Y)=>X.setAttribute(Y.name,Y.value)),X.textContent=J.textContent,document.head.appendChild(X)}})}async function N(){let j=document.querySelectorAll("[data-on]"),B=document.querySelectorAll("[data-bind]"),Q=window.__gospa__,R=Q?._ws;j.forEach((G)=>{let Z=G.getAttribute("data-on");if(!Z)return;let[_,$]=Z.split(":");if(!_||!$)return;let J=G.cloneNode(!0);G.parentNode?.replaceChild(J,G),J.addEventListener(_,()=>{if(R&&R.readyState===WebSocket.OPEN)R.send(JSON.stringify({action:$}))})});for(let G of B){let Z=G.getAttribute("data-bind");if(!Z)continue;let[_,$]=Z.split(":");if(!_||!$)continue;let J=Q?.state?.get($);if(!J)continue;let V=async(U)=>{switch(_){case"text":G.textContent=U;break;case"html":G.innerHTML=await D(U);break;case"value":G.value=U;break;case"checked":G.checked=U;break;case"show":G.style.display=U?"":"none";break}};await V(J.get()),J.subscribe((U)=>V(U))}}async function S(j,B={}){if(j===W.currentPath&&!B.replace)return!1;let R=(W.pendingNavigation??Promise.resolve(!0)).then(async()=>{if(j===W.currentPath&&!B.replace)return!1;W.isNavigating=!0,F.forEach((G)=>G(j));try{let G=await O(j);if(!G)return window.location.href=j,!1;if(B.replace)window.history.replaceState({path:j},"",j);else window.history.pushState({path:j},"",j);if(W.currentPath=j,await P(G),B.scrollToTop!==!1)window.scrollTo(0,0);return K.forEach((Z)=>Z(j)),document.dispatchEvent(new CustomEvent("gospa:navigated",{detail:{path:j}})),!0}catch(G){return console.error("[GoSPA] Navigation error:",G),W.isNavigating=!1,W.pendingNavigation=null,!1}finally{if(W.isNavigating=!1,W.pendingNavigation===R)W.pendingNavigation=null}});return W.pendingNavigation=R,R}function g(){window.history.back()}function C(){window.history.forward()}function k(j){window.history.go(j)}function w(){return W.currentPath}function E(){return W.isNavigating}function T(j){let B=window.location.pathname;F.forEach((Q)=>Q(B)),O(B).then((Q)=>{if(Q)W.currentPath=B,P(Q).then(()=>{K.forEach((R)=>R(B)),document.dispatchEvent(new CustomEvent("gospa:navigated",{detail:{path:B}}))});else window.location.reload()})}function z(j){if(j.button!==0||j.metaKey||j.ctrlKey||j.shiftKey||j.altKey)return;let Q=j.target.closest("a[href]");if(!Q)return;if(!H(Q))return;j.preventDefault();let R=Q.getAttribute("href");if(!R)return;S(R)}function x(){document.addEventListener("click",z),window.addEventListener("popstate",T),document.documentElement.setAttribute("data-gospa-spa","true")}function v(){document.removeEventListener("click",z),window.removeEventListener("popstate",T),document.documentElement.removeAttribute("data-gospa-spa")}async function u(j){if(q.has(j))return;let B=await M(j);if(B)q.set(j,B),setTimeout(()=>q.delete(j),30000)}function d(){return{get path(){return W.currentPath},get isNavigating(){return W.isNavigating},navigate:S,back:g,forward:C,go:k,prefetch:u}}if(typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",x);else x();export{u as prefetch,b as onBeforeNavigate,m as onAfterNavigate,S as navigate,E as isNavigating,x as initNavigation,k as go,w as getCurrentPath,C as forward,v as destroyNavigation,d as createNavigationState,g as back};
export{b as E,m as F,S as G,g as H,C as I,k as J,w as K,E as L,x as M,v as N,u as O,d as P};
