function $(){return typeof window<"u"&&window.__GOSPA_DEV__!==!1}function T(...q){if(!$())return{with:()=>{}};let F=!0,G=[],H=()=>q.map((K)=>typeof K==="function"?K():K),J=(K)=>{let U=H();console.log(`%c[${K}]`,"color: #888",...U),G.forEach((X)=>X(K,U))};return new Y(()=>{if(H(),F)F=!1,J("init");else J("update")}),{with:(K)=>{G.push(K)}}}T.trace=(q)=>{if(!$())return;console.log(`%c[trace]${q?` ${q}`:""}`,"color: #666; font-style: italic")};var I=0,x=0,O=0,_=new Set,Q=new Set,W=null;if(typeof globalThis.FinalizationRegistry<"u")W=new globalThis.FinalizationRegistry((q)=>{});var z=!1;function h(q=!0){z=q}function y(){let q=0;for(let F of Q)if(F.deref())q++;return q}function R(){for(let q of Q){let F=q.deref();if(F&&!F.isDisposed())F.dispose()}Q.clear()}function A(q){if(z){if(typeof globalThis.WeakRef<"u"){let F=globalThis.WeakRef;Q.add(new F(q))}else Q.add({deref:()=>q});if(W)W.register(q,`disposable-${Date.now()}`)}return q}var L=null,Z=[];function k(q){O++;try{q()}finally{if(O--,O===0){let F=[..._];_.clear(),F.forEach((G)=>G.notify())}}}class C{_value;_id;_subscribers=new Set;_dirty=!1;_disposed=!1;constructor(q){this._value=q,this._id=++I,A(this)}get value(){return this.trackDependency(),this._value}set value(q){if(this._equal(this._value,q))return;let F=this._value;this._value=q,this._dirty=!0,this._notifySubscribers(F)}get(){return this.trackDependency(),this._value}set(q){this.value=q}update(q){this.value=q(this._value)}subscribe(q){return this._subscribers.add(q),()=>this._subscribers.delete(q)}_notifySubscribers(q){if(O>0){_.add(this);return}this.notify(q)}notify(q){let F=this._value,G=q!==void 0?q:F;this._subscribers.forEach((H)=>H(F,G))}_equal(q,F){if(Object.is(q,F))return!0;if(typeof q!==typeof F)return!1;if(typeof q!=="object"||q===null||F===null)return!1;return JSON.stringify(q)===JSON.stringify(F)}trackDependency(){if(L)L.addDependency(this)}toJSON(){return{id:this._id,value:this._value}}dispose(){this._disposed=!0,this._subscribers.clear()}isDisposed(){return this._disposed}}class N{_value;_compute;_dependencies=new Set;_subscribers=new Set;_depUnsubs=new Map;_dirty=!0;_disposed=!1;constructor(q){this._compute=q,this._value=void 0,this._recompute()}get value(){if(this._dirty)this._recompute();return this.trackDependency(),this._value}get(){return this.value}subscribe(q){return this._subscribers.add(q),()=>this._subscribers.delete(q)}_recompute(){let q=new Set(this._dependencies);this._dependencies.clear();let F=L;L={addDependency:(H)=>{this._dependencies.add(H)}};try{this._value=this._compute(),this._dirty=!1}finally{L=F}q.forEach((H)=>{if(!this._dependencies.has(H)){let J=this._depUnsubs.get(H);if(J)J(),this._depUnsubs.delete(H)}}),this._dependencies.forEach((H)=>{if(!q.has(H)){let J=H.subscribe(()=>{this._dirty=!0,this._notifySubscribers()});this._depUnsubs.set(H,J)}})}_notifySubscribers(){if(O>0){_.add(this);return}this.notify()}notify(){let q=this._dirty?void 0:this._value;if(this._dirty)this._recompute();let F=this._value;this._subscribers.forEach((G)=>G(F,q??F))}trackDependency(){if(L)L.addDependency(this)}dispose(){this._disposed=!0,this._depUnsubs.forEach((q)=>q()),this._depUnsubs.clear(),this._dependencies.clear(),this._subscribers.clear()}isDisposed(){return this._disposed}}class Y{_fn;_cleanup;_dependencies=new Set;_id;_active=!0;_disposed=!1;constructor(q){this._fn=q,this._id=++x,this._cleanup=void 0,this._run()}_run(){if(!this._active||this._disposed)return;if(this._cleanup)this._cleanup(),this._cleanup=void 0;this._dependencies.clear(),Z.push(this),L=this;try{this._cleanup=this._fn()}finally{Z.pop(),L=Z[Z.length-1]||null}}addDependency(q){this._dependencies.add(q)}notify(){this._run()}pause(){this._active=!1}resume(){this._active=!0,this._run()}dispose(){if(this._cleanup)this._cleanup();this._disposed=!0,this._dependencies.clear()}isDisposed(){return this._disposed}}function V(q){return new Y(q)}function E(q,F){let G=Array.isArray(q)?q:[q],H=[];return G.forEach((J)=>{H.push(J.subscribe((K,U)=>{let X=G.map((M)=>M.get()),B=G.map((M)=>U);F(Array.isArray(q)?X:X[0],Array.isArray(q)?B:B[0])}))}),()=>H.forEach((J)=>J())}class S{_runes=new Map;set(q,F){let G=this._runes.get(q);if(G)return G.set(F),G;let H=new C(F);return this._runes.set(q,H),H}get(q){return this._runes.get(q)}has(q){return this._runes.has(q)}delete(q){return this._runes.delete(q)}clear(){this._runes.clear()}toJSON(){let q={};return this._runes.forEach((F,G)=>{q[G]=F.get()}),q}fromJSON(q){Object.entries(q).forEach(([F,G])=>{if(this._runes.has(F))this._runes.get(F).set(G);else this.set(F,G)})}dispose(){this._runes.forEach((q)=>{if("dispose"in q&&typeof q.dispose==="function")q.dispose()}),this._runes.clear()}isDisposed(){return this._runes.size===0}}
export{h as U,y as V,R as W,k as X,C as Y,N as Z,Y as _,V as $,E as aa,S as ba};
