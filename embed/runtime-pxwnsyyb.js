var _=0,$=0,O=0,U=new Set,J=null,T=[];function I(q){O++;try{q()}finally{if(O--,O===0){let z=[...U];U.clear(),z.forEach((F)=>F.notify())}}}class Z{_value;_id;_subscribers=new Set;_dirty=!1;constructor(q){this._value=q,this._id=++_}get value(){return this.trackDependency(),this._value}set value(q){if(this._equal(this._value,q))return;let z=this._value;this._value=q,this._dirty=!0,this._notifySubscribers(z)}get(){return this.trackDependency(),this._value}set(q){this.value=q}update(q){this.value=q(this._value)}subscribe(q){return this._subscribers.add(q),()=>this._subscribers.delete(q)}_notifySubscribers(q){if(O>0){U.add(this);return}this.notify()}notify(){let q=this._value;this._subscribers.forEach((z)=>z(q,this._value))}_equal(q,z){if(Object.is(q,z))return!0;if(typeof q!==typeof z)return!1;if(typeof q!=="object"||q===null||z===null)return!1;return JSON.stringify(q)===JSON.stringify(z)}trackDependency(){if(J)J.addDependency(this)}toJSON(){return{id:this._id,value:this._value}}}class C{_value;_compute;_dependencies=new Set;_subscribers=new Set;_dirty=!0;_disposed=!1;constructor(q){this._compute=q,this._value=void 0,this._recompute()}get value(){if(this._dirty)this._recompute();return this.trackDependency(),this._value}get(){return this.value}subscribe(q){return this._subscribers.add(q),()=>this._subscribers.delete(q)}_recompute(){let q=new Set(this._dependencies);this._dependencies.clear();let z=J;J={addDependency:(G)=>{this._dependencies.add(G)}};try{this._value=this._compute(),this._dirty=!1}finally{J=z}this._dependencies.forEach((G)=>{if(!q.has(G))G.subscribe(()=>{this._dirty=!0,this._notifySubscribers()})})}_notifySubscribers(){if(O>0){U.add(this);return}this.notify()}notify(){if(this._dirty)this._recompute();let q=this._value;this._subscribers.forEach((z)=>z(q,this._value))}trackDependency(){if(J)J.addDependency(this)}dispose(){this._disposed=!0,this._dependencies.clear(),this._subscribers.clear()}}class X{_fn;_cleanup;_dependencies=new Set;_id;_active=!0;_disposed=!1;constructor(q){this._fn=q,this._id=++$,this._cleanup=void 0,this._run()}_run(){if(!this._active||this._disposed)return;if(this._cleanup)this._cleanup(),this._cleanup=void 0;this._dependencies.clear(),T.push(this),J=this;try{this._cleanup=this._fn()}finally{T.pop(),J=T[T.length-1]||null}}addDependency(q){this._dependencies.add(q)}notify(){this._run()}pause(){this._active=!1}resume(){this._active=!0,this._run()}dispose(){if(this._cleanup)this._cleanup();this._disposed=!0,this._dependencies.clear()}}function x(q){return new X(q)}function A(q,z){let F=Array.isArray(q)?q:[q],G=[];return F.forEach((K)=>{G.push(K.subscribe((W,H)=>{let L=F.map((Y)=>Y.get()),Q=F.map((Y)=>H);z(Array.isArray(q)?L:L[0],Array.isArray(q)?Q:Q[0])}))}),()=>G.forEach((K)=>K())}class B{_runes=new Map;set(q,z){let F=this._runes.get(q);if(F)return F.set(z),F;let G=new Z(z);return this._runes.set(q,G),G}get(q){return this._runes.get(q)}has(q){return this._runes.has(q)}delete(q){return this._runes.delete(q)}clear(){this._runes.clear()}toJSON(){let q={};return this._runes.forEach((z,F)=>{q[F]=z.get()}),q}fromJSON(q){Object.entries(q).forEach(([z,F])=>{if(this._runes.has(z))this._runes.get(z).set(F);else this.set(z,F)})}}function M(...q){if(!(typeof window<"u"&&window.__GOSPA_DEV__!==!1))return{with:()=>{}};let F=!0,G=[],K=()=>q.map((H)=>typeof H==="function"?H():H),W=(H)=>{let L=K();console.log(`%c[${H}]`,"color: #888",...L),G.forEach((Q)=>Q(H,L))};return new X(()=>{if(K(),F)F=!1,W("init");else W("update")}),{with:(H)=>{G.push(H)}}}M.trace=(q)=>{if(!(typeof window<"u"&&window.__GOSPA_DEV__!==!1))return;console.log(`%c[trace]${q?` ${q}`:""}`,"color: #666; font-style: italic")};
export{I as T,Z as U,C as V,X as W,x as X,A as Y,B as Z};
