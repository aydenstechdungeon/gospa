var yq=0,bq=0,P=0,S=new Set,A=null,V=[];function D(q){P++;try{q()}finally{if(P--,P===0){let G=[...S];S.clear(),G.forEach((Q)=>Q.notify())}}}class H{_value;_id;_subscribers=new Set;_dirty=!1;constructor(q){this._value=q,this._id=++yq}get value(){return this.trackDependency(),this._value}set value(q){if(this._equal(this._value,q))return;let G=this._value;this._value=q,this._dirty=!0,this._notifySubscribers(G)}get(){return this.trackDependency(),this._value}set(q){this.value=q}update(q){this.value=q(this._value)}subscribe(q){return this._subscribers.add(q),()=>this._subscribers.delete(q)}_notifySubscribers(q){if(P>0){S.add(this);return}this.notify()}notify(){let q=this._value;console.log("[GoSPA DEBUG] Rune.notify - value:",q,"subscribers count:",this._subscribers.size),this._subscribers.forEach((G)=>G(q,this._value))}_equal(q,G){return Object.is(q,G)||JSON.stringify(q)===JSON.stringify(G)}trackDependency(){if(A)A.addDependency(this)}toJSON(){return{id:this._id,value:this._value}}}class E{_value;_compute;_dependencies=new Set;_subscribers=new Set;_dirty=!0;_disposed=!1;constructor(q){this._compute=q,this._value=void 0,this._recompute()}get value(){if(this._dirty)this._recompute();return this.trackDependency(),this._value}get(){return this.value}subscribe(q){return this._subscribers.add(q),()=>this._subscribers.delete(q)}_recompute(){let q=new Set(this._dependencies);this._dependencies.clear();let G=A;A={addDependency:(Y)=>{this._dependencies.add(Y)}};try{this._value=this._compute(),this._dirty=!1}finally{A=G}this._dependencies.forEach((Y)=>{if(!q.has(Y))Y.subscribe(()=>{this._dirty=!0,this._notifySubscribers()})})}_notifySubscribers(){if(P>0){S.add(this);return}this.notify()}notify(){if(this._dirty)this._recompute();let q=this._value;this._subscribers.forEach((G)=>G(q,this._value))}trackDependency(){if(A)A.addDependency(this)}dispose(){this._disposed=!0,this._dependencies.clear(),this._subscribers.clear()}}class T{_fn;_cleanup;_dependencies=new Set;_id;_active=!0;_disposed=!1;constructor(q){this._fn=q,this._id=++bq,this._cleanup=void 0,this._run()}_run(){if(!this._active||this._disposed)return;if(this._cleanup)this._cleanup(),this._cleanup=void 0;this._dependencies.clear(),V.push(this),A=this;try{this._cleanup=this._fn()}finally{V.pop(),A=V[V.length-1]||null}}addDependency(q){this._dependencies.add(q)}notify(){this._run()}pause(){this._active=!1}resume(){this._active=!0,this._run()}dispose(){if(this._cleanup)this._cleanup();this._disposed=!0,this._dependencies.clear()}}function Xq(q){return new T(q)}function p(q,G){let Q=Array.isArray(q)?q:[q],Y=[];return Q.forEach((X)=>{Y.push(X.subscribe((_,Z)=>{let $=Q.map((z)=>z.get()),U=Q.map((z)=>Z);G(Array.isArray(q)?$:$[0],Array.isArray(q)?U:U[0])}))}),()=>Y.forEach((X)=>X())}class x{_runes=new Map;set(q,G){console.log("[GoSPA DEBUG] StateMap.set called - key:",q,"value:",G);let Q=this._runes.get(q);if(Q)return console.log("[GoSPA DEBUG] StateMap.set - updating existing Rune, subscribers:",Q._subscribers?.size||0),Q.set(G),Q;console.log("[GoSPA DEBUG] StateMap.set - creating new Rune");let Y=new H(G);return this._runes.set(q,Y),Y}get(q){return this._runes.get(q)}has(q){return this._runes.has(q)}delete(q){return this._runes.delete(q)}clear(){this._runes.clear()}toJSON(){let q={};return this._runes.forEach((G,Q)=>{q[Q]=G.get()}),q}fromJSON(q){Object.entries(q).forEach(([G,Q])=>{if(this._runes.has(G))this._runes.get(G).set(Q);else this.set(G,Q)})}}function hq(...q){if(!(typeof window<"u"&&window.__GOSPA_DEV__!==!1))return{with:()=>{}};let Q=!0,Y=[],X=()=>q.map((Z)=>typeof Z==="function"?Z():Z),_=(Z)=>{let $=X();console.log(`%c[${Z}]`,"color: #888",...$),Y.forEach((U)=>U(Z,$))};return new T(()=>{if(X(),Q)Q=!1,_("init");else _("update")}),{with:(Z)=>{Y.push(Z)}}}hq.trace=(q)=>{if(!(typeof window<"u"&&window.__GOSPA_DEV__!==!1))return;console.log(`%c[trace]${q?` ${q}`:""}`,"color: #666; font-style: italic")};var N=new Map,C=new WeakMap,gq=0;function vq(){return`binding-${++gq}`}function Zq(q){let G=vq();if(!N.has(G))N.set(G,new Set);if(N.get(G).add(q),!C.has(q.element))C.set(q.element,new Set);return C.get(q.element).add(q),G}function _q(q){let G=N.get(q);if(G)G.forEach((Q)=>{let Y=C.get(Q.element);if(Y){if(Y.delete(Q),Y.size===0)C.delete(Q.element)}}),N.delete(q)}function Yq(q,G){let{element:Q,type:Y,attribute:X,transform:_}=q,Z=_?_(G):G;switch(Y){case"text":if(Q instanceof HTMLElement||Q instanceof SVGElement)Q.textContent=String(Z??"");break;case"html":if(Q instanceof HTMLElement)Q.innerHTML=String(Z??"");break;case"value":if(Q instanceof HTMLInputElement||Q instanceof HTMLTextAreaElement||Q instanceof HTMLSelectElement){if(Q.value!==String(Z??""))Q.value=String(Z??"")}break;case"checked":if(Q instanceof HTMLInputElement)Q.checked=Boolean(Z);break;case"class":if(Q instanceof Element){if(X)if(Z)Q.classList.add(X);else Q.classList.remove(X);else if(typeof Z==="string")Q.className=Z;else if(Array.isArray(Z))Q.className=Z.join(" ");else if(typeof Z==="object"&&Z!==null)Object.entries(Z).forEach(([$,U])=>{if(U)Q.classList.add($);else Q.classList.remove($)})}break;case"style":if(Q instanceof HTMLElement||Q instanceof SVGElement){if(X)Q.style[X]=String(Z??"");else if(typeof Z==="string")Q.setAttribute("style",Z);else if(typeof Z==="object"&&Z!==null)Object.entries(Z).forEach(([$,U])=>{Q.style[$]=U})}break;case"attr":if(X)if(Z===null||Z===void 0||Z===!1)Q.removeAttribute(X);else if(Z===!0)Q.setAttribute(X,"");else Q.setAttribute(X,String(Z));break;case"prop":if(X&&Q instanceof HTMLElement)Q[X]=Z;break}}function $q(q,G,Q={}){let Y={type:Q.type||"text",key:Q.key||"",element:q,attribute:Q.attribute,transform:Q.transform},X=Zq(Y);console.log("[GoSPA DEBUG] bindElement called - key:",Q.key,"type:",Y.type,"initial value:",G.get()),Yq(Y,G.get());let _=G.subscribe((Z)=>{console.log("[GoSPA DEBUG] bindElement subscriber callback - key:",Q.key,"value:",Z),Yq(Y,Z)});return()=>{_(),_q(X)}}function Uq(q,G){let Q=q instanceof HTMLInputElement&&q.type==="checkbox",Y=q instanceof HTMLInputElement&&q.type==="radio",X=q instanceof HTMLInputElement&&q.type==="number";if(Q)q.checked=Boolean(G.get());else q.value=String(G.get()??"");let _=G.subscribe(($)=>{if(Q)q.checked=Boolean($);else if(q.value!==String($??""))q.value=String($??"")}),Z=()=>{let $;if(Q)$=q.checked;else if(X)$=q.value?parseFloat(q.value):0;else $=q.value;D(()=>{G.set($)})};return q.addEventListener("input",Z),q.addEventListener("change",Z),()=>{_(),q.removeEventListener("input",Z),q.removeEventListener("change",Z)}}function fq(q,G,Q){let Y=null,X=(Z)=>{if(Z){if(!Y)Y=G()}else if(Y&&Q)Y=Q();else Y=null};X(q.get());let _=q.subscribe(X);return{element:Y,cleanup:()=>{_()}}}function pq(q,G,Q){let Y=document.createDocumentFragment(),X=document.createElement("div");Y.appendChild(X);let _=new Map,Z=(U)=>{let z=new Set;U.forEach((J,F)=>{let j=Q(J,F);if(z.add(j),!_.has(j)){let L=G(J,F);_.set(j,{element:L,index:F});let f=X.children[F]||null;X.insertBefore(L,f)}else{let L=_.get(j);if(L.index=F,X.children[F]!==L.element)X.insertBefore(L.element,X.children[F]||null)}}),_.forEach((J,F)=>{if(!z.has(F))J.element.remove(),_.delete(F)})};Z(q.get());let $=q.subscribe(Z);return{container:X,cleanup:()=>{$(),_.clear()}}}var uq={prevent:(q,G)=>{return q.preventDefault(),G(q)},stop:(q,G)=>{return q.stopPropagation(),G(q)},capture:(q,G)=>G(q),once:(q,G)=>G(q),passive:(q,G)=>G(q),self:(q,G)=>{if(q.target===q.currentTarget)return G(q)}},I=new WeakMap;function Jq(q,G){return(Q)=>{for(let X of G){if(X==="capture"||X==="once"||X==="passive")continue;let _=uq[X];_(Q,q)}if(G.filter((X)=>!["capture","once","passive"].includes(X)).length===0)return q(Q)}}function u(q){let G=q.split(":"),Q=G[0],Y=G.slice(1);return{event:Q,modifiers:Y}}function m(q,G,Q){let{event:Y,modifiers:X}=u(G),_={capture:X.includes("capture"),once:X.includes("once"),passive:X.includes("passive")},Z=Jq(Q,X);if(q.addEventListener(Y,Z,_),!I.has(q))I.set(q,new Map);let $=I.get(q);if(!$.has(G))$.set(G,new Set);return $.get(G).add(Z),()=>{q.removeEventListener(Y,Z,_);let U=$.get(G);if(U){if(U.delete(Z),U.size===0)$.delete(G)}}}function mq(q){let G=I.get(q);if(!G)return;for(let[Q,Y]of G){let{event:X,modifiers:_}=u(Q),Z={capture:_.includes("capture")};for(let $ of Y)q.removeEventListener(X,$,Z)}I.delete(q)}function zq(q,G){let Q=null;return(Y)=>{if(Q)clearTimeout(Q);Q=setTimeout(()=>{q(Y),Q=null},G)}}function Fq(q,G){let Q=!1;return(Y)=>{if(!Q)q(Y),Q=!0,setTimeout(()=>{Q=!1},G)}}var cq={value:(q)=>q.target.value,checked:(q)=>q.target.checked,numberValue:(q)=>Number(q.target.value),files:(q)=>q.target.files,formData:(q)=>{return q.preventDefault(),new FormData(q.target)}};function dq(q,G,Q,Y){let{event:X,modifiers:_}=u(Q),Z=(U)=>{if(U.target.closest(G))Jq(Y,_)(U)},$={capture:_.includes("capture"),passive:_.includes("passive")};return q.addEventListener(X,Z,$),()=>{q.removeEventListener(X,Z,$)}}function oq(q,G,Q){let Y=Array.isArray(q)?q:[q];return(X)=>{if(Y.includes(X.key)){if(Q?.preventDefault)X.preventDefault();G(X)}}}var lq={enter:"Enter",escape:"Escape",tab:"Tab",space:" ",arrowUp:"ArrowUp",arrowDown:"ArrowDown",arrowLeft:"ArrowLeft",arrowRight:"ArrowRight"};class c{ws=null;config;reconnectAttempts=0;heartbeatTimer=null;messageQueue=[];connectionState;pendingRequests=new Map;requestId=0;constructor(q){this.config={reconnect:!0,reconnectInterval:1000,maxReconnectAttempts:10,heartbeatInterval:30000,onOpen:()=>{},onClose:()=>{},onError:()=>{},onMessage:()=>{},...q},this.connectionState=new H("disconnected")}get state(){return this.connectionState.get()}get isConnected(){return this.connectionState.get()==="connected"}connect(){return new Promise((q,G)=>{if(this.ws?.readyState===WebSocket.OPEN){q();return}this.connectionState.set("connecting");try{this.ws=new WebSocket(this.config.url)}catch(Q){this.connectionState.set("disconnected"),G(Q);return}this.ws.onopen=()=>{this.connectionState.set("connected"),this.reconnectAttempts=0,this.startHeartbeat(),this.flushMessageQueue(),this.send({type:"sync"}),this.config.onOpen(),q()},this.ws.onclose=(Q)=>{if(this.connectionState.set("disconnected"),this.stopHeartbeat(),this.config.onClose(Q),this.config.reconnect&&this.reconnectAttempts<this.config.maxReconnectAttempts)this.scheduleReconnect()},this.ws.onerror=(Q)=>{if(this.config.onError(Q),this.connectionState.get()==="connecting")G(Error("WebSocket connection failed"))},this.ws.onmessage=(Q)=>{this.handleMessage(Q.data)}})}disconnect(){if(this.ws)this.connectionState.set("disconnecting"),this.stopHeartbeat(),this.ws.close(1000,"Client disconnect"),this.ws=null,this.connectionState.set("disconnected")}scheduleReconnect(){this.reconnectAttempts++;let q=this.config.reconnectInterval*Math.min(this.reconnectAttempts,5);setTimeout(()=>{if(this.connectionState.get()==="disconnected")this.connect().catch(()=>{})},q)}startHeartbeat(){this.heartbeatTimer=setInterval(()=>{this.send({type:"ping"})},this.config.heartbeatInterval)}stopHeartbeat(){if(this.heartbeatTimer)clearInterval(this.heartbeatTimer),this.heartbeatTimer=null}flushMessageQueue(){while(this.messageQueue.length>0&&this.isConnected){let q=this.messageQueue.shift();if(q)this.send(q)}}send(q){if(this.ws?.readyState===WebSocket.OPEN)this.ws.send(JSON.stringify(q));else this.messageQueue.push(q)}sendWithResponse(q){return new Promise((G,Q)=>{let Y=`req_${++this.requestId}`;q.data={...q.data,_requestId:Y},this.pendingRequests.set(Y,{resolve:G,reject:Q}),this.send(q),setTimeout(()=>{if(this.pendingRequests.has(Y))this.pendingRequests.delete(Y),Q(Error("Request timeout"))},30000)})}handleMessage(q){try{let G=JSON.parse(q);if(G.type==="pong")return;if(G.data?._responseId){let Q=G.data._responseId,Y=this.pendingRequests.get(Q);if(Y)if(this.pendingRequests.delete(Q),G.type==="error")Y.reject(Error(G.error||"Unknown error"));else Y.resolve(G.data)}this.config.onMessage(G)}catch(G){console.error("Failed to parse WebSocket message:",G)}}requestSync(){this.send({type:"sync"})}sendAction(q,G={}){this.send({type:"action",action:q,payload:G})}requestState(q){return this.sendWithResponse({type:"init",componentId:q})}}function Lq(q,G={}){if(M)M.sendAction(q,G);else console.warn("[GoSPA] Cannot send action: WebSocket not initialized")}var M=null;function d(){return M}function Kq(q){if(M)M.disconnect();return M=new c(q),M}function rq(q,G){let Q=new H(q),Y=G.ws||M,X=!1,_=Q.set.bind(Q);return Q.set=(Z)=>{if(X){_(Z);return}let $=Q.get();if(_(Z),Y?.isConnected)try{let U=()=>{Y.send({type:"update",payload:{key:G.key,value:Z}})};if(G.debounce)setTimeout(U,G.debounce);else U()}catch(U){console.warn("[GoSPA] Optimistic update failed, rolling back.",U),X=!0,_($),X=!1}else console.warn("[GoSPA] WS disconnected, optimistic update rolled back."),X=!0,_($),X=!1},Q}function sq(q,G){D(()=>{for(let[Q,Y]of Object.entries(G)){let X=q[Q];if(X)X.set(Y)}})}var K={currentPath:window.location.pathname,isNavigating:!1,pendingNavigation:null},k=new Set,y=new Set;function Oq(q){return k.add(q),()=>k.delete(q)}function Wq(q){return y.add(q),()=>y.delete(q)}function iq(q){let G=q.getAttribute("href");if(!G||G.startsWith("#")||G.startsWith("javascript:"))return!1;if(G.startsWith("http://")||G.startsWith("https://")||G.startsWith("//"))try{return new URL(G,window.location.origin).origin===window.location.origin}catch{return!1}if(q.hasAttribute("data-external")||q.hasAttribute("download")||q.getAttribute("target")==="_blank")return!1;return!0}var R=new Map;async function jq(q){try{let G=await fetch(q,{headers:{"X-Requested-With":"GoSPA-Navigate",Accept:"text/html"}});if(!G.ok)return console.error("[GoSPA] Navigation failed:",G.status),null;let Q=await G.text(),X=new DOMParser().parseFromString(Q,"text/html"),_=X.querySelector("main"),Z=_?_.innerHTML:X.body.innerHTML,$=X.querySelector("title")?.textContent||"",U=X.querySelector("head"),z=U?U.innerHTML:"";return{content:Z,title:$,head:z}}catch(G){return console.error("[GoSPA] Navigation error:",G),null}}async function Aq(q){let G=R.get(q);if(G)return R.delete(q),G;return jq(q)}function Hq(q){if(q.title)document.title=q.title;let G=document.querySelector("main");if(G)G.innerHTML=q.content;else document.body.innerHTML=q.content;aq(q.head),nq()}function aq(q){let Y=new DOMParser().parseFromString(`<html><head>${q}</head></html>`,"text/html").querySelector("head");if(!Y)return;document.head.querySelectorAll("[data-gospa-head]").forEach((_)=>_.remove()),Y.querySelectorAll("title, meta, link, style, script").forEach((_)=>{if(_.tagName==="SCRIPT"&&!_.hasAttribute("data-gospa-head"))return;_.setAttribute("data-gospa-head","true"),document.head.appendChild(_.cloneNode(!0))})}function nq(){let q=document.querySelectorAll("[data-on]"),G=document.querySelectorAll("[data-bind]"),Q=window.__gospa__,Y=Q?._ws;q.forEach((X)=>{let _=X.getAttribute("data-on");if(!_)return;let[Z,$]=_.split(":");if(!Z||!$)return;let U=X.cloneNode(!0);X.parentNode?.replaceChild(U,X),U.addEventListener(Z,()=>{if(Y&&Y.readyState===WebSocket.OPEN)Y.send(JSON.stringify({action:$}))})}),G.forEach((X)=>{let _=X.getAttribute("data-bind");if(!_)return;let[Z,$]=_.split(":");if(!Z||!$)return;let U=Q?.state?.get($);if(!U)return;let z=(J)=>{switch(Z){case"text":X.textContent=J;break;case"html":X.innerHTML=J;break;case"value":X.value=J;break;case"checked":X.checked=J;break;case"show":X.style.display=J?"":"none";break}};z(U.get()),U.subscribe(z)})}async function w(q,G={}){if(q===K.currentPath&&!G.replace)return!1;if(K.pendingNavigation)await K.pendingNavigation;K.isNavigating=!0,k.forEach((Q)=>Q(q));try{return K.pendingNavigation=(async()=>{let Q=await Aq(q);if(!Q)return window.location.href=q,!1;if(G.replace)window.history.replaceState({path:q},"",q);else window.history.pushState({path:q},"",q);if(K.currentPath=q,Hq(Q),G.scrollToTop!==!1)window.scrollTo(0,0);return y.forEach((Y)=>Y(q)),!0})(),await K.pendingNavigation}finally{K.isNavigating=!1,K.pendingNavigation=null}}function o(){window.history.back()}function l(){window.history.forward()}function r(q){window.history.go(q)}function Mq(){return K.currentPath}function Bq(){return K.isNavigating}function Dq(q){let G=window.location.pathname;k.forEach((Q)=>Q(G)),Aq(G).then((Q)=>{if(Q)K.currentPath=G,Hq(Q),y.forEach((Y)=>Y(G));else window.location.reload()})}function Pq(q){if(q.button!==0||q.metaKey||q.ctrlKey||q.shiftKey||q.altKey)return;let Q=q.target.closest("a[href]");if(!Q)return;if(!iq(Q))return;q.preventDefault();let Y=Q.getAttribute("href");if(!Y)return;w(Y)}function b(){document.addEventListener("click",Pq),window.addEventListener("popstate",Dq),document.documentElement.setAttribute("data-gospa-spa","true"),console.log("[GoSPA] SPA navigation initialized")}function Tq(){document.removeEventListener("click",Pq),window.removeEventListener("popstate",Dq),document.documentElement.removeAttribute("data-gospa-spa")}async function s(q){if(R.has(q))return;let G=await jq(q);if(G)R.set(q,G),setTimeout(()=>R.delete(q),30000)}function xq(){return{get path(){return K.currentPath},get isNavigating(){return K.isNavigating},navigate:w,back:o,forward:l,go:r,prefetch:s}}if(typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",b);else b();var tq=(q)=>q,Iq=(q)=>{let G=q-1;return G*G*G+1};function i(q,{delay:G=0,duration:Q=400,easing:Y=tq}={}){let X=+getComputedStyle(q).opacity;return{delay:G,duration:Q,easing:"linear",css:(_)=>`opacity: ${_*X}`}}function a(q,{delay:G=0,duration:Q=400,easing:Y=Iq,x:X=0,y:_=0,opacity:Z=0}={}){let $=getComputedStyle(q),U=+$.opacity,z=$.transform==="none"?"":$.transform;return{delay:G,duration:Q,easing:"ease-out",css:(J,F)=>`
			transform: ${z} translate(${(1-J)*X}px, ${(1-J)*_}px);
			opacity: ${U-(U-Z)*F}
		`}}function n(q,{delay:G=0,duration:Q=400,easing:Y=Iq}={}){let X=getComputedStyle(q),_=+X.opacity,Z=parseFloat(X.height),$=parseFloat(X.paddingTop),U=parseFloat(X.paddingBottom),z=parseFloat(X.marginTop),J=parseFloat(X.marginBottom),F=parseFloat(X.borderTopWidth),j=parseFloat(X.borderBottomWidth);return{delay:G,duration:Q,easing:"ease-out",css:(L)=>`
			overflow: hidden;
			opacity: ${Math.min(L*20,1)*_};
			height: ${L*Z}px;
			padding-top: ${L*$}px;
			padding-bottom: ${L*U}px;
			margin-top: ${L*z}px;
			margin-bottom: ${L*J}px;
			border-top-width: ${L*F}px;
			border-bottom-width: ${L*j}px;
		`}}var B=new Set;function eq(q,G,Q){if(B.has(q))return;B.add(q);let Y=G(q,Q),X=Y.duration||400,_=Y.delay||0,Z=Y.css||(()=>""),$=q.getAttribute("style")||"",U=`gospa-transition-${Math.random().toString(36).substring(2,9)}`,z=`
		@keyframes ${U} {
			0% { ${Z(0,1)} }
			100% { ${Z(1,0)} }
		}
	`,J=document.createElement("style");J.textContent=z,document.head.appendChild(J),q.style.animation=`${U} ${X}ms ${Y.easing||"linear"} ${_}ms both`,setTimeout(()=>{q.setAttribute("style",$),q.style.animation="",J.remove(),B.delete(q)},X+_)}function qG(q,G,Q,Y){if(B.has(q))return;B.add(q);let X=G(q,Q),_=X.duration||400,Z=X.delay||0,$=X.css||(()=>""),U=`gospa-transition-${Math.random().toString(36).substring(2,9)}`,z=`
		@keyframes ${U} {
			0% { ${$(1,0)} }
			100% { ${$(0,1)} }
		}
	`,J=document.createElement("style");J.textContent=z,document.head.appendChild(J),q.style.animation=`${U} ${_}ms ${X.easing||"linear"} ${Z}ms both`,setTimeout(()=>{J.remove(),B.delete(q),Y()},_+Z)}function t(q=document.body){new MutationObserver((Q)=>{Q.forEach((Y)=>{if(Y.type==="childList")Y.addedNodes.forEach((X)=>{if(X.nodeType===Node.ELEMENT_NODE){let _=X;if(_.closest("[data-gospa-static]"))return;let Z=_.getAttribute("data-transition-in")||_.getAttribute("data-transition");if(Z){let $=Nq(Z);if($)eq(_,$,Cq(_))}}}),Y.removedNodes.forEach((X)=>{if(X.nodeType===Node.ELEMENT_NODE){let _=X;if(_.closest("[data-gospa-static]"))return;let Z=_.getAttribute("data-transition-out")||_.getAttribute("data-transition");if(Z){let $=Nq(Z);if($&&!B.has(_)){let U=_.cloneNode(!0);if(U.querySelectorAll("[data-bind]").forEach((z)=>z.removeAttribute("data-bind")),U.removeAttribute("data-bind"),Y.previousSibling&&Y.previousSibling.parentNode)Y.previousSibling.parentNode.insertBefore(U,Y.previousSibling.nextSibling);else if(Y.target)Y.target.appendChild(U);qG(U,$,Cq(_),()=>U.remove())}}}})})}).observe(q,{childList:!0,subtree:!0})}function Nq(q){if(q.startsWith("fade"))return i;if(q.startsWith("fly"))return a;if(q.startsWith("slide"))return n;return null}function Cq(q){let G=q.getAttribute("data-transition-params");if(!G)return{};try{return JSON.parse(G)}catch(Q){return console.warn("Invalid transition parameters:",G),{}}}var O=new Map,h=new x,Rq=!1,W={};function wq(q={}){if(Rq){console.warn("GoSPA runtime already initialized");return}if(W=q,Rq=!0,t(),W.wsUrl)Kq({url:W.wsUrl,onMessage:GG}).connect().catch((Q)=>{if(W.debug)console.error("WebSocket connection failed:",Q)});if(window.addEventListener("error",(G)=>{if(W.debug)console.error("Runtime error:",G.error)}),W.debug)console.log("GoSPA runtime initialized");window.__GOSPA__={config:W,components:O,globalState:h,init:wq,createComponent:e,destroyComponent:Vq,getComponent:Sq,getState:qq,setState:Eq,callAction:Gq,bind:g,autoInit:v,sendAction:Lq,getWebSocketClient:d,navigate:w}}function GG(q){switch(console.log("[GoSPA DEBUG] handleServerMessage received:",JSON.stringify(q)),q.type){case"init":if(q.componentId&&q.data){let G=O.get(q.componentId);if(G)G.states.fromJSON(q.data)}else if(q.state){for(let G of O.values())for(let[Q,Y]of Object.entries(q.state))if(G.states.get(Q)!==void 0)G.states.set(Q,Y);h.fromJSON(q.state)}break;case"update":if(q.componentId&&q.diff){let G=O.get(q.componentId);if(G)G.states.fromJSON(q.diff)}break;case"sync":if(console.log("[GoSPA DEBUG] sync message - data:",q.data,"key:",q.key,"value:",q.value),q.data)h.fromJSON(q.data);else if(q.key!==void 0&&q.value!==void 0){console.log("[GoSPA DEBUG] Processing partial sync. Components count:",O.size);for(let G of O.values()){let Q=G.states.get(q.key);if(console.log("[GoSPA DEBUG] Component:",G.id,"key:",q.key,"existingRune:",Q?"exists":"not found"),Q!==void 0)console.log("[GoSPA DEBUG] Setting state key:",q.key,"to value:",q.value),G.states.set(q.key,q.value)}h.set(q.key,q.value)}break;case"error":if(W.debug)console.error("Server error:",q.error);break}}function e(q,G){let Q={id:q.id,definition:q,states:new x,derived:new Map,unsubscribers:[],cleanup:[],element:G||null};for(let[Y,X]of Object.entries(q.state))Q.states.set(Y,X);if(q.computed)for(let[Y,X]of Object.entries(q.computed)){let _=new E(X);Q.derived.set(Y,_)}if(q.watch)for(let[Y,X]of Object.entries(q.watch)){let _=Q.states.get(Y);if(_){let Z=p(_,X);Q.unsubscribers.push(Z)}}if(q.mount){let Y=q.mount();if(Y)Q.cleanup.push(Y)}if(O.set(q.id,Q),W.debug)console.log(`Component "${q.name}" created with id "${q.id}"`);return Q}function Vq(q){let G=O.get(q);if(!G)return;if(G.definition.destroy)G.definition.destroy();for(let Q of G.cleanup)Q();for(let Q of G.unsubscribers)Q();for(let Q of G.derived.values())Q.dispose();if(O.delete(q),W.debug)console.log(`Component "${q}" destroyed`)}function Sq(q){return O.get(q)}function qq(q,G){return O.get(q)?.states.get(G)}function Eq(q,G,Q){let Y=O.get(q);if(Y)Y.states.set(G,Q)}function Gq(q,G,...Q){let Y=O.get(q);if(!Y||!Y.definition.actions)throw Error(`Action "${G}" not found on component "${q}"`);let X=Y.definition.actions[G];if(!X)throw Error(`Action "${G}" not found on component "${q}"`);return X(...Q)}function g(q,G,Q,Y,X){let _=qq(q,Y);if(!_)return console.warn(`State "${Y}" not found on component "${q}"`),()=>{};if(X?.twoWay)return Uq(G,_);return $q(G,_,{type:Q,transform:X?.transform})}function v(){let q=document.querySelectorAll("[data-gospa-component]");for(let G of q){let Q=G.getAttribute("data-gospa-component"),Y=G.getAttribute("data-gospa-state");if(!Q)continue;let X=Y?JSON.parse(Y):{};e({id:Q,name:Q,state:X},G)}QG()}function QG(){let q=document.querySelectorAll("[data-gospa-component]");console.log("[GoSPA DEBUG] Found components with data-gospa-component:",q.length),q.forEach((X,_)=>{console.log(`[GoSPA DEBUG] Component ${_}:`,X.getAttribute("data-gospa-component"),X)});let G=document.querySelectorAll("[data-bind]");for(let X of G){let _=X.closest("[data-gospa-component]"),Z=_?.getAttribute("data-gospa-component")||"";console.log("[GoSPA DEBUG] setupBindings - element:",X,"closest component:",_,"componentId:",Z);let $=X.getAttribute("data-bind"),U=X.getAttribute("data-transform");if(!$)continue;let[z,J="text"]=$.split(":").map((j)=>j.trim()),F;if(U){if(F=window[U],typeof F!=="function"&&W.debug)console.warn(`[GoSPA] Transform "${U}" not found or not a function`)}g(Z,X,J,z,{transform:F})}let Q=document.querySelectorAll("[data-on]");for(let X of Q){let _=X.closest("[data-gospa-component]")?.getAttribute("data-gospa-component")||"",Z=X.getAttribute("data-on");if(!Z)continue;let[$,U,z]=Z.split(":").map((F)=>F.trim()),J=z?z.split(",").map((F)=>F.trim()):[];m(X,$,()=>{try{Gq(_,U,...J)}catch(F){let j=d();if(j?.isConnected){let L={};J.forEach((f)=>{let[kq,Qq]=f.split("=");if(Qq!==void 0)L[kq]=Qq}),j.sendAction(U,Object.keys(L).length>0?L:void 0)}else if(W.debug)console.error(`[GoSPA] Failed to execute action "${U}":`,F)}})}let Y=document.querySelectorAll("[data-model]");for(let X of Y){let _=X.closest("[data-gospa-component]")?.getAttribute("data-gospa-component")||"",Z=X.getAttribute("data-model");if(!Z)continue;g(_,X,"value",Z,{twoWay:!0})}}if(typeof document<"u"){if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>{if(document.documentElement.hasAttribute("data-gospa-auto"))v()});else if(document.documentElement.hasAttribute("data-gospa-auto"))v()}var HG={init:wq,createComponent:e,destroyComponent:Vq,getComponent:Sq,getState:qq,setState:Eq,callAction:Gq,bind:g,autoInit:v,Rune:H,Derived:E,Effect:T,StateMap:x,batch:D,effect:Xq,watch:p,on:m,debounce:zq,throttle:Fq,fade:i,fly:a,slide:n,setupTransitions:t,navigate:w,back:o,forward:l,go:r,prefetch:s,getCurrentPath:Mq,isNavigating:Bq,onBeforeNavigate:Oq,onAfterNavigate:Wq,initNavigation:b,destroyNavigation:Tq,createNavigationState:xq};export{p as watch,_q as unregisterBinding,cq as transformers,Fq as throttle,rq as syncedRune,n as slide,t as setupTransitions,Eq as setState,pq as renderList,fq as renderIf,Zq as registerBinding,s as prefetch,oq as onKey,Oq as onBeforeNavigate,Wq as onAfterNavigate,m as on,mq as offAll,w as navigate,lq as keys,Bq as isNavigating,Kq as initWebSocket,b as initNavigation,wq as init,r as go,d as getWebSocketClient,qq as getState,Mq as getCurrentPath,Sq as getComponent,l as forward,a as fly,i as fade,Xq as effect,Tq as destroyNavigation,Vq as destroyComponent,dq as delegate,HG as default,zq as debounce,xq as createNavigationState,e as createComponent,Gq as callAction,Uq as bindTwoWay,$q as bindElement,g as bind,D as batch,o as back,v as autoInit,sq as applyStateUpdate,c as WSClient,x as StateMap,H as Rune,T as Effect,E as Derived};
