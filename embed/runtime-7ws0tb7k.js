function W(){return typeof window<"u"&&window.__GOSPA_DEV__!==!1}function I(...F){if(!W())return{with:()=>{}};let G=!0,H=[],J=()=>F.map((L)=>typeof L==="function"?L():L),K=(L)=>{let Y=J();console.log(`%c[${L}]`,"color: #888",...Y),H.forEach((Z)=>Z(L,Y))};return new _(()=>{if(J(),G)G=!1,K("init");else K("update")}),{with:(L)=>{H.push(L)}}}I.trace=(F)=>{if(!W())return;console.log(`%c[trace]${F?` ${F}`:""}`,"color: #666; font-style: italic")};var B=0,A=0,U=0,Q=new Set,M=!1;function S(){if(M||U>0)return;M=!0,queueMicrotask(()=>{if(M=!1,U===0&&Q.size>0){let F=[...Q];Q.clear(),F.forEach((G)=>G.notify())}})}var X=new Set,T=null;if(typeof globalThis.FinalizationRegistry<"u")T=new globalThis.FinalizationRegistry((F)=>{});var x=!1;function h(F=!0){x=F}function V(){let F=0;for(let G of X)if(G.deref())F++;return F}function E(){for(let F of X){let G=F.deref();if(G&&!G.isDisposed())G.dispose()}X.clear()}function N(F){if(x){if(typeof globalThis.WeakRef<"u"){let G=globalThis.WeakRef;X.add(new G(F))}else X.add({deref:()=>F});if(T)T.register(F,`disposable-${Date.now()}`)}return F}var O=null,$=[];function q(F,G){if(F===G)return!0;if(typeof F!==typeof G)return!1;if(typeof F!=="object"||F===null||G===null)return!1;if(Array.isArray(F)&&Array.isArray(G)){if(F.length!==G.length)return!1;for(let K=0;K<F.length;K++)if(!q(F[K],G[K]))return!1;return!0}if(Array.isArray(F)!==Array.isArray(G))return!1;let H=Object.keys(F),J=Object.keys(G);if(H.length!==J.length)return!1;for(let K of H){if(!Object.prototype.hasOwnProperty.call(G,K))return!1;if(!q(F[K],G[K]))return!1}return!0}function d(F){U++;try{F()}finally{if(U--,U===0){let G=[...Q];Q.clear(),G.forEach((H)=>H.notify())}}}class j{_value;_id;_subscribers=new Set;_dirty=!1;_disposed=!1;constructor(F){this._value=F,this._id=++B,N(this)}get value(){return this.trackDependency(),this._value}set value(F){if(this._equal(this._value,F))return;let G=this._value;this._value=F,this._dirty=!0,this._notifySubscribers(G)}get(){return this.trackDependency(),this._value}set(F){this.value=F}update(F){this.value=F(this._value)}subscribe(F){return this._subscribers.add(F),()=>this._subscribers.delete(F)}_notifySubscribers(F){if(U>0){Q.add(this);return}Q.add(this),S()}notify(F){let G=this._value,H=F!==void 0?F:G;this._subscribers.forEach((J)=>J(G,H))}_equal(F,G){if(Object.is(F,G))return!0;if(typeof F!==typeof G)return!1;if(typeof F!=="object"||F===null||G===null)return!1;return q(F,G)}trackDependency(){if(O)O.addDependency(this)}toJSON(){return{id:this._id,value:this._value}}dispose(){this._disposed=!0,this._subscribers.clear()}isDisposed(){return this._disposed}}class w{_value;_compute;_dependencies=new Set;_subscribers=new Set;_depUnsubs=new Map;_dirty=!0;_disposed=!1;constructor(F){this._compute=F,this._value=void 0,this._recompute()}get value(){if(this._dirty)this._recompute();return this.trackDependency(),this._value}get(){return this.value}subscribe(F){return this._subscribers.add(F),()=>this._subscribers.delete(F)}_recompute(){let F=new Set(this._dependencies);this._dependencies.clear();let G=O;O={addDependency:(J)=>{this._dependencies.add(J)}};try{this._value=this._compute(),this._dirty=!1}finally{O=G}F.forEach((J)=>{if(!this._dependencies.has(J)){let K=this._depUnsubs.get(J);if(K)K(),this._depUnsubs.delete(J)}}),this._dependencies.forEach((J)=>{if(!F.has(J)){let K=J.subscribe(()=>{this._dirty=!0,this._notifySubscribers()});this._depUnsubs.set(J,K)}})}_notifySubscribers(){if(U>0){Q.add(this);return}this.notify()}notify(){let F=this._dirty?void 0:this._value;if(this._dirty)this._recompute();let G=this._value;this._subscribers.forEach((H)=>H(G,F??G))}trackDependency(){if(O)O.addDependency(this)}dispose(){this._disposed=!0,this._depUnsubs.forEach((F)=>F()),this._depUnsubs.clear(),this._dependencies.clear(),this._subscribers.clear()}isDisposed(){return this._disposed}}class _{_fn;_cleanup;_dependencies=new Set;_id;_active=!0;_disposed=!1;constructor(F){this._fn=F,this._id=++A,this._cleanup=void 0,this._run()}_run(){if(!this._active||this._disposed)return;if(this._cleanup)this._cleanup(),this._cleanup=void 0;this._dependencies.clear(),$.push(this),O=this;try{this._cleanup=this._fn()}finally{$.pop(),O=$[$.length-1]||null}}addDependency(F){this._dependencies.add(F)}notify(){this._run()}pause(){this._active=!1}resume(){this._active=!0,this._run()}dispose(){if(this._cleanup)this._cleanup();this._disposed=!0,this._dependencies.clear()}isDisposed(){return this._disposed}}function v(F){return new _(F)}function b(F,G){let H=Array.isArray(F)?F:[F],J=[];return H.forEach((K)=>{J.push(K.subscribe((L,Y)=>{let Z=H.map((C)=>C.get()),z=H.map((C)=>Y);G(Array.isArray(F)?Z:Z[0],Array.isArray(F)?z:z[0])}))}),()=>J.forEach((K)=>K())}class m{_runes=new Map;set(F,G){let H=this._runes.get(F);if(H)return H.set(G),H;let J=new j(G);return this._runes.set(F,J),J}get(F){return this._runes.get(F)}has(F){return this._runes.has(F)}delete(F){return this._runes.delete(F)}clear(){this._runes.clear()}toJSON(){let F={};return this._runes.forEach((G,H)=>{F[H]=G.get()}),F}fromJSON(F){Object.entries(F).forEach(([G,H])=>{if(this._runes.has(G))this._runes.get(G).set(H);else this.set(G,H)})}dispose(){this._runes.forEach((F)=>{if("dispose"in F&&typeof F.dispose==="function")F.dispose()}),this._runes.clear()}isDisposed(){return this._runes.size===0}}
export{h as Y,V as Z,E as _,d as $,j as aa,w as ba,_ as ca,v as da,b as ea,m as fa};
