import{T as S}from"./runtime-pxwnsyyb.js";import"./runtime-cap19hgg.js";var O=(j)=>j;function m(j){O=j}var L=new Map,T=new WeakMap,E=0;function V(){return`binding-${++E}`}function y(j){let G=V();if(!L.has(G))L.set(G,new Set);if(L.get(G).add(j),!T.has(j.element))T.set(j.element,new Set);return T.get(j.element).add(j),G}function k(j){let G=L.get(j);if(G)G.forEach((q)=>{let U=T.get(q.element);if(U){if(U.delete(q),U.size===0)T.delete(q.element)}}),L.delete(j)}async function z(j,G){let{element:q,type:U,attribute:Q,transform:W}=j,J=W?W(G):G;switch(U){case"text":if(q instanceof HTMLElement||q instanceof SVGElement)q.textContent=String(J??"");break;case"html":if(q instanceof HTMLElement){let X=await O(String(J??""));q.innerHTML=X}break;case"value":if(q instanceof HTMLInputElement||q instanceof HTMLTextAreaElement||q instanceof HTMLSelectElement){if(q.value!==String(J??""))q.value=String(J??"")}break;case"checked":if(q instanceof HTMLInputElement)q.checked=Boolean(J);break;case"class":if(q instanceof Element){if(Q)if(J)q.classList.add(Q);else q.classList.remove(Q);else if(typeof J==="string")q.className=J;else if(Array.isArray(J))q.className=J.join(" ");else if(typeof J==="object"&&J!==null)Object.entries(J).forEach(([X,Y])=>{if(Y)q.classList.add(X);else q.classList.remove(X)})}break;case"style":if(q instanceof HTMLElement||q instanceof SVGElement){if(Q)q.style[Q]=String(J??"");else if(typeof J==="string")q.setAttribute("style",J);else if(typeof J==="object"&&J!==null)Object.entries(J).forEach(([X,Y])=>{q.style[X]=Y})}break;case"attr":if(Q)if(J===null||J===void 0||J===!1)q.removeAttribute(Q);else if(J===!0)q.setAttribute(Q,"");else q.setAttribute(Q,String(J));break;case"prop":if(Q&&q instanceof HTMLElement)q[Q]=J;break}}function r(j,G,q={}){let U={type:q.type||"text",key:q.key||"",element:j,attribute:q.attribute,transform:q.transform},Q=y(U);z(U,G.get());let W=G.subscribe((J)=>{z(U,J)});return()=>{W(),k(Q)}}function d(j,G){let q=j instanceof HTMLInputElement&&j.type==="checkbox",U=j instanceof HTMLInputElement&&j.type==="radio",Q=j instanceof HTMLInputElement&&j.type==="number";if(q)j.checked=Boolean(G.get());else j.value=String(G.get()??"");let W=G.subscribe((X)=>{if(q)j.checked=Boolean(X);else if(j.value!==String(X??""))j.value=String(X??"")}),J=()=>{let X;if(q)X=j.checked;else if(Q)X=j.value?parseFloat(j.value):0;else X=j.value;S(()=>{G.set(X)})};return j.addEventListener("input",J),j.addEventListener("change",J),()=>{W(),j.removeEventListener("input",J),j.removeEventListener("change",J)}}function i(j,G,q){let U=null,Q=(J)=>{if(J){if(!U)U=G()}else if(U&&q)U=q();else U=null};Q(j.get());let W=j.subscribe(Q);return{element:U,cleanup:()=>{W()}}}function l(j,G,q){let U=document.createDocumentFragment(),Q=document.createElement("div");U.appendChild(Q);let W=new Map,J=(Y)=>{let A=new Set;Y.forEach((_,$)=>{let I=q(_,$);if(A.add(I),!W.has(I)){let F=G(_,$);W.set(I,{element:F,index:$});let x=Q.children[$]||null;Q.insertBefore(F,x)}else{let F=W.get(I);if(F.index=$,Q.children[$]!==F.element)Q.insertBefore(F.element,Q.children[$]||null)}}),W.forEach((_,$)=>{if(!A.has($))_.element.remove(),W.delete($)})};J(j.get());let X=j.subscribe(J);return{container:Q,cleanup:()=>{X(),W.clear()}}}var Z={currentPath:window.location.pathname,isNavigating:!1,pendingNavigation:null},K=new Set,P=new Set;function t(j){return K.add(j),()=>K.delete(j)}function e(j){return P.add(j),()=>P.delete(j)}function f(j){let G=j.getAttribute("href");if(!G||G.startsWith("#")||G.startsWith("javascript:"))return!1;if(G.startsWith("http://")||G.startsWith("https://")||G.startsWith("//"))try{return new URL(G,window.location.origin).origin===window.location.origin}catch{return!1}if(j.hasAttribute("data-external")||j.hasAttribute("download")||j.getAttribute("target")==="_blank")return!1;return!0}var D=new Map;async function R(j){try{let G=await fetch(j,{headers:{"X-Requested-With":"GoSPA-Navigate",Accept:"text/html"}});if(!G.ok)return console.error("[GoSPA] Navigation failed:",G.status),null;let q=await G.text(),Q=new DOMParser().parseFromString(q,"text/html"),W=Q.querySelector("main"),J=W?W.innerHTML:Q.body.innerHTML,X=Q.querySelector("title")?.textContent||"",Y=Q.querySelector("head"),A=Y?Y.innerHTML:"";return{content:J,title:X,head:A}}catch(G){return console.error("[GoSPA] Navigation error:",G),null}}async function B(j){let G=D.get(j);if(G)return D.delete(j),G;return R(j)}function H(j){if(j.title)document.title=j.title;let G=document.querySelector("main");if(G)G.innerHTML=O(j.content);else document.body.innerHTML=O(j.content);g(j.head),h()}function g(j){let U=new DOMParser().parseFromString(`<html><head>${j}</head></html>`,"text/html").querySelector("head");if(!U)return;document.head.querySelectorAll("[data-gospa-head]").forEach((W)=>W.remove()),U.querySelectorAll("title, meta, link, style, script").forEach((W)=>{if(W.tagName==="SCRIPT"&&!W.hasAttribute("data-gospa-head"))return;W.setAttribute("data-gospa-head","true"),document.head.appendChild(W.cloneNode(!0))})}function h(){let j=document.querySelectorAll("[data-on]"),G=document.querySelectorAll("[data-bind]"),q=window.__gospa__,U=q?._ws;j.forEach((Q)=>{let W=Q.getAttribute("data-on");if(!W)return;let[J,X]=W.split(":");if(!J||!X)return;let Y=Q.cloneNode(!0);Q.parentNode?.replaceChild(Y,Q),Y.addEventListener(J,()=>{if(U&&U.readyState===WebSocket.OPEN)U.send(JSON.stringify({action:X}))})}),G.forEach((Q)=>{let W=Q.getAttribute("data-bind");if(!W)return;let[J,X]=W.split(":");if(!J||!X)return;let Y=q?.state?.get(X);if(!Y)return;let A=(_)=>{switch(J){case"text":Q.textContent=_;break;case"html":Q.innerHTML=O(_);break;case"value":Q.value=_;break;case"checked":Q.checked=_;break;case"show":Q.style.display=_?"":"none";break}};A(Y.get()),Y.subscribe(A)})}async function N(j,G={}){if(j===Z.currentPath&&!G.replace)return!1;if(Z.pendingNavigation)await Z.pendingNavigation;Z.isNavigating=!0,K.forEach((q)=>q(j));try{return Z.pendingNavigation=(async()=>{let q=await B(j);if(!q)return window.location.href=j,!1;if(G.replace)window.history.replaceState({path:j},"",j);else window.history.pushState({path:j},"",j);if(Z.currentPath=j,H(q),G.scrollToTop!==!1)window.scrollTo(0,0);return P.forEach((U)=>U(j)),!0})(),await Z.pendingNavigation}finally{Z.isNavigating=!1,Z.pendingNavigation=null}}function b(){window.history.back()}function v(){window.history.forward()}function c(j){window.history.go(j)}function jj(){return Z.currentPath}function qj(){return Z.isNavigating}function C(j){let G=window.location.pathname;K.forEach((q)=>q(G)),B(G).then((q)=>{if(q)Z.currentPath=G,H(q),P.forEach((U)=>U(G));else window.location.reload()})}function w(j){if(j.button!==0||j.metaKey||j.ctrlKey||j.shiftKey||j.altKey)return;let q=j.target.closest("a[href]");if(!q)return;if(!f(q))return;j.preventDefault();let U=q.getAttribute("href");if(!U)return;N(U)}function M(){document.addEventListener("click",w),window.addEventListener("popstate",C),document.documentElement.setAttribute("data-gospa-spa","true"),console.log("[GoSPA] SPA navigation initialized")}function Gj(){document.removeEventListener("click",w),window.removeEventListener("popstate",C),document.documentElement.removeAttribute("data-gospa-spa")}async function p(j){if(D.has(j))return;let G=await R(j);if(G)D.set(j,G),setTimeout(()=>D.delete(j),30000)}function Jj(){return{get path(){return Z.currentPath},get isNavigating(){return Z.isNavigating},navigate:N,back:b,forward:v,go:c,prefetch:p}}if(typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",M);else M();export{p as prefetch,t as onBeforeNavigate,e as onAfterNavigate,N as navigate,qj as isNavigating,M as initNavigation,c as go,jj as getCurrentPath,v as forward,Gj as destroyNavigation,Jj as createNavigationState,b as back};
export{m as A,y as B,k as C,r as D,d as E,i as F,l as G,t as H,e as I,N as J,b as K,v as L,c as M,jj as N,qj as O,M as P,Gj as Q,p as R,Jj as S};
