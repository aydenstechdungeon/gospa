import{M as L}from"./runtime-qrdd0a7v.js";import"./runtime-1w8zs78r.js";import"./runtime-vhktm8ba.js";var X={currentPath:window.location.pathname,isNavigating:!1,pendingNavigation:null},M=new Set,O=new Set;function p(j){return M.add(j),()=>M.delete(j)}function d(j){return O.add(j),()=>O.delete(j)}function A(j){let B=j.getAttribute("href");if(!B||B.startsWith("#")||B.startsWith("javascript:"))return!1;if(B.startsWith("http://")||B.startsWith("https://")||B.startsWith("//"))try{return new URL(B,window.location.origin).origin===window.location.origin}catch{return!1}if(j.hasAttribute("data-external")||j.hasAttribute("download")||j.getAttribute("target")==="_blank")return!1;return!0}var I=new Map;async function P(j){try{let B=await fetch(j,{headers:{"X-Requested-With":"GoSPA-Navigate",Accept:"text/html"}});if(!B.ok)return console.error("[GoSPA] Navigation failed:",B.status),null;let G=await B.text(),J=new DOMParser().parseFromString(G,"text/html"),R=J.querySelector("[data-gospa-root]"),Y=J.querySelector("main"),Z=R?R.innerHTML:Y?Y.innerHTML:J.body.innerHTML,U=J.querySelector("title")?.textContent||"",V=J.querySelector("head"),W=V?V.innerHTML:"";return{content:Z,title:U,head:W}}catch(B){return console.error("[GoSPA] Navigation error:",B),null}}async function S(j){let B=I.get(j);if(B)return I.delete(j),B;return P(j)}async function x(j){try{return await L(j)}catch(B){console.error("[GoSPA] Sanitization failed:",B);let G=document.createElement("div");return G.textContent=j,G.innerHTML}}async function T(j){if(j.title&&document.title!==j.title)document.title=j.title;let B=document.querySelector("[data-gospa-root]");if(B){let Q=new DOMParser().parseFromString(j.content,"text/html"),J=await x(j.content),R=document.createElement("div");R.innerHTML=J,z(B,R)}else{let Q=document.querySelector("main")||document.body;Q.innerHTML=await x(j.content)}k(j.head),await b()}function u(j,B){if(j.nodeType!==B.nodeType){if(j.parentNode)j.parentNode.replaceChild(B.cloneNode(!0),j);return}if(j.nodeType===Node.TEXT_NODE||j.nodeType===Node.COMMENT_NODE){if(j.nodeValue!==B.nodeValue)j.nodeValue=B.nodeValue;return}if(j instanceof Element&&B instanceof Element){if(j.tagName!==B.tagName){if(j.parentNode)j.parentNode.replaceChild(B.cloneNode(!0),j);return}if(C(j,B),j instanceof HTMLInputElement||j instanceof HTMLTextAreaElement||j instanceof HTMLSelectElement){if(j.value!==B.value)j.value=B.value}z(j,B)}}function C(j,B){let G=j.attributes,Q=B.attributes;for(let J=G.length-1;J>=0;J--){let R=G[J];if(!B.hasAttribute(R.name))j.removeAttribute(R.name)}for(let J=0;J<Q.length;J++){let R=Q[J];if(j.getAttribute(R.name)!==R.value)j.setAttribute(R.name,R.value)}}function z(j,B){let G=Array.from(j.childNodes),Q=Array.from(B.childNodes),J=Math.max(G.length,Q.length);for(let R=0;R<J;R++){let Y=G[R],Z=Q[R];if(!Y)j.appendChild(Z.cloneNode(!0));else if(!Z)Y.remove();else u(Y,Z)}}function k(j){let G=new DOMParser().parseFromString(`<html><head>${j}</head></html>`,"text/html"),Q=G.querySelector("head");if(!Q)return;let J=G.querySelector("title")?.textContent;if(J&&J!==document.title)document.title=J;Array.from(Q.querySelectorAll("link")).forEach((U)=>{let V=U.getAttribute("href"),W=U.getAttribute("rel"),$=V?`link[href="${V}"]`:null;if(!($?document.head.querySelector($):null)){let q=U.cloneNode(!0);q.setAttribute("data-gospa-head","true"),document.head.appendChild(q)}}),Array.from(Q.querySelectorAll("meta")).forEach((U)=>{let V=U.getAttribute("name"),W=U.getAttribute("property"),$=U.getAttribute("http-equiv"),_="";if(V)_=`meta[name="${V}"]`;else if(W)_=`meta[property="${W}"]`;else if($)_=`meta[http-equiv="${$}"]`;let q=_?document.head.querySelector(_):null;if(q){let F=U.getAttribute("content");if(F)q.setAttribute("content",F)}else{let F=U.cloneNode(!0);F.setAttribute("data-gospa-head","true"),document.head.appendChild(F)}}),Array.from(Q.querySelectorAll("style")).forEach((U)=>{let V=U.id,W=V?`style#${V}`:null;if(!(W?document.head.querySelector(W):null)){let _=U.cloneNode(!0);_.setAttribute("data-gospa-head","true"),document.head.appendChild(_)}}),Q.querySelectorAll("script[data-gospa-head]").forEach((U)=>{let V=U.getAttribute("src");if(!(V?document.head.querySelector(`script[src="${V}"]`):null)){let $=document.createElement("script");Array.from(U.attributes).forEach((_)=>$.setAttribute(_.name,_.value)),$.textContent=U.textContent,document.head.appendChild($)}})}var K=new WeakSet;async function b(){let j=document.querySelectorAll("[data-on]"),B=document.querySelectorAll("[data-bind]"),G=window.__gospa__,Q=G?._ws;j.forEach((J)=>{if(K.has(J))return;let R=J.getAttribute("data-on");if(!R)return;let[Y,Z]=R.split(":");if(!Y||!Z)return;J.addEventListener(Y,()=>{if(Q&&Q.readyState===WebSocket.OPEN)Q.send(JSON.stringify({action:Z}))}),K.add(J)});for(let J of B){if(K.has(J))continue;let R=J.getAttribute("data-bind");if(!R)continue;let[Y,Z]=R.split(":");if(!Y||!Z)continue;let U=G?.state?.get(Z);if(!U)continue;let V=async(W)=>{switch(Y){case"text":J.textContent=W;break;case"html":J.innerHTML=await x(W);break;case"value":J.value=W;break;case"checked":J.checked=W;break;case"show":J.style.display=W?"":"none";break}};await V(U.get()),U.subscribe((W)=>V(W)),K.add(J)}}async function H(j,B={}){if(j===X.currentPath&&!B.replace)return!1;if(X.pendingNavigation)await X.pendingNavigation;X.isNavigating=!0,M.forEach((G)=>G(j));try{return X.pendingNavigation=(async()=>{let G=await S(j);if(!G)return window.location.href=j,!1;if(B.replace)window.history.replaceState({path:j},"",j);else window.history.pushState({path:j},"",j);if(X.currentPath=j,await T(G),B.scrollToTop!==!1)window.scrollTo(0,0);return O.forEach((Q)=>Q(j)),!0})(),await X.pendingNavigation}finally{X.isNavigating=!1,X.pendingNavigation=null}}function w(){window.history.back()}function E(){window.history.forward()}function v(j){window.history.go(j)}function f(){return X.currentPath}function m(){return X.isNavigating}function N(j){let B=window.location.pathname;M.forEach((G)=>G(B)),S(B).then((G)=>{if(G)X.currentPath=B,T(G).then(()=>{O.forEach((Q)=>Q(B))});else window.location.reload()})}function y(j){if(j.button!==0||j.metaKey||j.ctrlKey||j.shiftKey||j.altKey)return;let G=j.target.closest("a[href]");if(!G)return;if(!A(G))return;j.preventDefault();let Q=G.getAttribute("href");if(!Q)return;H(Q)}function c(j){let G=j.target.closest("a[href]");if(!G)return;if(!A(G))return;let Q=G.getAttribute("href");if(Q)g(Q)}function D(){document.addEventListener("click",y),document.addEventListener("mouseover",c),window.addEventListener("popstate",N),document.documentElement.setAttribute("data-gospa-spa","true")}function h(){document.removeEventListener("click",y),window.removeEventListener("popstate",N),document.documentElement.removeAttribute("data-gospa-spa")}async function g(j){if(I.has(j))return;let B=await P(j);if(B)I.set(j,B),setTimeout(()=>I.delete(j),30000)}function i(){return{get path(){return X.currentPath},get isNavigating(){return X.isNavigating},navigate:H,back:w,forward:E,go:v,prefetch:g}}if(typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",D);else D();export{g as prefetch,p as onBeforeNavigate,d as onAfterNavigate,H as navigate,m as isNavigating,D as initNavigation,v as go,f as getCurrentPath,E as forward,h as destroyNavigation,i as createNavigationState,w as back};
export{p as A,d as B,H as C,w as D,E,v as F,f as G,m as H,D as I,h as J,g as K,i as L};
