{
  "version": 3,
  "sources": ["../src/state.ts", "../src/dom.ts", "../src/events.ts", "../src/websocket.ts", "../src/navigation.ts", "../src/transition.ts", "../src/runtime.ts"],
  "sourcesContent": [
    "// Client-side reactive primitives mirroring Go state package\n\nexport type Unsubscribe = () => void;\nexport type Subscriber<T> = (value: T, oldValue: T) => void;\nexport type EffectFn = () => void | (() => void);\nexport type ComputeFn<T> = () => T;\n\nlet runeId = 0;\nlet effectId = 0;\nlet batchDepth = 0;\nlet pendingNotifications: Set<Notifier> = new Set();\n\ninterface Notifier {\n\tnotify(): void;\n}\n\n// Track current effect for dependency collection\nlet currentEffect: Effect | null = null;\nconst effectStack: Effect[] = [];\n\n// Batch updates\nexport function batch(fn: () => void): void {\n\tbatchDepth++;\n\ttry {\n\t\tfn();\n\t} finally {\n\t\tbatchDepth--;\n\t\tif (batchDepth === 0) {\n\t\t\tconst pending = [...pendingNotifications];\n\t\t\tpendingNotifications.clear();\n\t\t\tpending.forEach(n => n.notify());\n\t\t}\n\t}\n}\n\n// Rune - core reactive primitive\nexport class Rune<T> implements Notifier {\n\tprivate _value: T;\n\tprivate readonly _id: number;\n\tprivate readonly _subscribers: Set<Subscriber<T>> = new Set();\n\tprivate _dirty: boolean = false;\n\n\tconstructor(initialValue: T) {\n\t\tthis._value = initialValue;\n\t\tthis._id = ++runeId;\n\t}\n\n\tget value(): T {\n\t\tthis.trackDependency();\n\t\treturn this._value;\n\t}\n\n\tset value(newValue: T) {\n\t\tif (this._equal(this._value, newValue)) return;\n\t\tconst oldValue = this._value;\n\t\tthis._value = newValue;\n\t\tthis._dirty = true;\n\t\tthis._notifySubscribers(oldValue);\n\t}\n\n\tget(): T {\n\t\tthis.trackDependency();\n\t\treturn this._value;\n\t}\n\n\tset(newValue: T): void {\n\t\tthis.value = newValue;\n\t}\n\n\tupdate(fn: (current: T) => T): void {\n\t\tthis.value = fn(this._value);\n\t}\n\n\tsubscribe(fn: Subscriber<T>): Unsubscribe {\n\t\tthis._subscribers.add(fn);\n\t\treturn () => this._subscribers.delete(fn);\n\t}\n\n\tprivate _notifySubscribers(oldValue: T): void {\n\t\tif (batchDepth > 0) {\n\t\t\tpendingNotifications.add(this);\n\t\t\treturn;\n\t\t}\n\t\tthis.notify();\n\t}\n\n\tnotify(): void {\n\t\tconst value = this._value;\n\t\tthis._subscribers.forEach(fn => fn(value, this._value));\n\t}\n\n\tprivate _equal(a: T, b: T): boolean {\n\t\treturn Object.is(a, b) || JSON.stringify(a) === JSON.stringify(b);\n\t}\n\n\tprivate trackDependency(): void {\n\t\tif (currentEffect) {\n\t\t\tcurrentEffect.addDependency(this as unknown as Rune<unknown>);\n\t\t}\n\t}\n\n\ttoJSON(): { id: number; value: T } {\n\t\treturn { id: this._id, value: this._value };\n\t}\n}\n\n// Create a new Rune\nexport function rune<T>(initialValue: T): Rune<T> {\n\treturn new Rune(initialValue);\n}\n\n// Derived - computed state\nexport class Derived<T> implements Notifier {\n\tprivate _value: T;\n\tprivate readonly _compute: ComputeFn<T>;\n\tprivate readonly _dependencies: Set<Rune<unknown>> = new Set();\n\tprivate readonly _subscribers: Set<Subscriber<T>> = new Set();\n\tprivate _dirty: boolean = true;\n\tprivate _disposed: boolean = false;\n\n\tconstructor(compute: ComputeFn<T>) {\n\t\tthis._compute = compute;\n\t\tthis._value = undefined as T;\n\t\tthis._recompute();\n\t}\n\n\tget value(): T {\n\t\tif (this._dirty) {\n\t\t\tthis._recompute();\n\t\t}\n\t\tthis.trackDependency();\n\t\treturn this._value;\n\t}\n\n\tget(): T {\n\t\treturn this.value;\n\t}\n\n\tsubscribe(fn: Subscriber<T>): Unsubscribe {\n\t\tthis._subscribers.add(fn);\n\t\treturn () => this._subscribers.delete(fn);\n\t}\n\n\tprivate _recompute(): void {\n\t\tconst oldDeps = new Set(this._dependencies);\n\t\tthis._dependencies.clear();\n\n\t\tconst prevEffect = currentEffect;\n\t\tconst collector = {\n\t\t\taddDependency: (rune: Rune<unknown>) => {\n\t\t\t\tthis._dependencies.add(rune);\n\t\t\t}\n\t\t} as Effect;\n\t\t\n\t\tcurrentEffect = collector;\n\t\ttry {\n\t\t\tthis._value = this._compute();\n\t\t\tthis._dirty = false;\n\t\t} finally {\n\t\t\tcurrentEffect = prevEffect;\n\t\t}\n\n\t\t// Subscribe to new dependencies\n\t\tthis._dependencies.forEach(dep => {\n\t\t\tif (!oldDeps.has(dep)) {\n\t\t\t\tdep.subscribe(() => {\n\t\t\t\t\tthis._dirty = true;\n\t\t\t\t\tthis._notifySubscribers();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _notifySubscribers(): void {\n\t\tif (batchDepth > 0) {\n\t\t\tpendingNotifications.add(this);\n\t\t\treturn;\n\t\t}\n\t\tthis.notify();\n\t}\n\n\tnotify(): void {\n\t\tif (this._dirty) {\n\t\t\tthis._recompute();\n\t\t}\n\t\tconst value = this._value;\n\t\tthis._subscribers.forEach(fn => fn(value, this._value));\n\t}\n\n\tprivate trackDependency(): void {\n\t\tif (currentEffect) {\n\t\t\tcurrentEffect.addDependency(this as unknown as Rune<unknown>);\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis._disposed = true;\n\t\tthis._dependencies.clear();\n\t\tthis._subscribers.clear();\n\t}\n}\n\n// Create a Derived\nexport function derived<T>(compute: ComputeFn<T>): Derived<T> {\n\treturn new Derived(compute);\n}\n\n// Effect - side effects\nexport class Effect implements Notifier {\n\tprivate readonly _fn: EffectFn;\n\tprivate _cleanup: (() => void) | void;\n\tprivate readonly _dependencies: Set<Rune<unknown>> = new Set();\n\tprivate readonly _id: number;\n\tprivate _active: boolean = true;\n\tprivate _disposed: boolean = false;\n\n\tconstructor(fn: EffectFn) {\n\t\tthis._fn = fn;\n\t\tthis._id = ++effectId;\n\t\tthis._cleanup = undefined;\n\t\tthis._run();\n\t}\n\n\tprivate _run(): void {\n\t\tif (!this._active || this._disposed) return;\n\n\t\t// Run cleanup if exists\n\t\tif (this._cleanup) {\n\t\t\tthis._cleanup();\n\t\t\tthis._cleanup = undefined;\n\t\t}\n\n\t\t// Clear old dependencies\n\t\tthis._dependencies.clear();\n\n\t\t// Push to effect stack\n\t\teffectStack.push(this);\n\t\tcurrentEffect = this;\n\n\t\ttry {\n\t\t\tthis._cleanup = this._fn();\n\t\t} finally {\n\t\t\teffectStack.pop();\n\t\t\tcurrentEffect = effectStack[effectStack.length - 1] || null;\n\t\t}\n\t}\n\n\taddDependency(rune: Rune<unknown>): void {\n\t\tthis._dependencies.add(rune);\n\t}\n\n\tnotify(): void {\n\t\tthis._run();\n\t}\n\n\tpause(): void {\n\t\tthis._active = false;\n\t}\n\n\tresume(): void {\n\t\tthis._active = true;\n\t\tthis._run();\n\t}\n\n\tdispose(): void {\n\t\tif (this._cleanup) {\n\t\t\tthis._cleanup();\n\t\t}\n\t\tthis._disposed = true;\n\t\tthis._dependencies.clear();\n\t}\n}\n\n// Create an Effect\nexport function effect(fn: EffectFn): Effect {\n\treturn new Effect(fn);\n}\n\n// Watch multiple runes\nexport function watch<T>(\n\tsources: Rune<T> | Rune<T>[],\n\tcallback: (values: T | T[], oldValues: T | T[]) => void\n): Unsubscribe {\n\tconst sourceArray = Array.isArray(sources) ? sources : [sources];\n\tconst unsubscribers: Unsubscribe[] = [];\n\n\tsourceArray.forEach(source => {\n\t\tunsubscribers.push(\n\t\t\tsource.subscribe((value, oldValue) => {\n\t\t\t\tconst values = sourceArray.map(s => s.get());\n\t\t\t\tconst oldValues = sourceArray.map(s => oldValue);\n\t\t\t\tcallback(\n\t\t\t\t\tArray.isArray(sources) ? values : values[0],\n\t\t\t\t\tArray.isArray(sources) ? oldValues : oldValues[0]\n\t\t\t\t);\n\t\t\t})\n\t\t);\n\t});\n\n\treturn () => unsubscribers.forEach(unsub => unsub());\n}\n\n// StateMap - collection of named runes\nexport class StateMap {\n\tprivate readonly _runes: Map<string, Rune<unknown>> = new Map();\n\n\tset<T>(key: string, value: T): Rune<T> {\n\t\tconst r = new Rune(value);\n\t\tthis._runes.set(key, r as unknown as Rune<unknown>);\n\t\treturn r;\n\t}\n\n\tget<T>(key: string): Rune<T> | undefined {\n\t\treturn this._runes.get(key) as Rune<T> | undefined;\n\t}\n\n\thas(key: string): boolean {\n\t\treturn this._runes.has(key);\n\t}\n\n\tdelete(key: string): boolean {\n\t\treturn this._runes.delete(key);\n\t}\n\n\tclear(): void {\n\t\tthis._runes.clear();\n\t}\n\n\ttoJSON(): Record<string, unknown> {\n\t\tconst result: Record<string, unknown> = {};\n\t\tthis._runes.forEach((rune, key) => {\n\t\t\tresult[key] = rune.get();\n\t\t});\n\t\treturn result;\n\t}\n\n\tfromJSON(data: Record<string, unknown>): void {\n\t\tObject.entries(data).forEach(([key, value]) => {\n\t\t\tif (this._runes.has(key)) {\n\t\t\t\t(this._runes.get(key) as Rune<unknown>).set(value);\n\t\t\t} else {\n\t\t\t\tthis.set(key, value);\n\t\t\t}\n\t\t});\n\t}\n}\n\n// Create a state map\nexport function stateMap(): StateMap {\n\treturn new StateMap();\n}\n\n// === Additional Svelte 5-like APIs ===\n\n/**\n * untrack - Execute a function without tracking dependencies.\n * Useful when you need to read reactive values inside an effect without subscribing.\n */\nexport function untrack<T>(fn: () => T): T {\n\tconst prevEffect = currentEffect;\n\tcurrentEffect = null;\n\ttry {\n\t\treturn fn();\n\t} finally {\n\t\tcurrentEffect = prevEffect;\n\t}\n}\n\n/**\n * PreEffect - Effect that runs BEFORE DOM updates.\n * Useful for reading DOM state that will be affected by a pending update.\n */\nexport class PreEffect extends Effect {\n\tprivate static _preEffects: PreEffect[] = [];\n\tprivate static _scheduled = false;\n\n\tconstructor(fn: EffectFn) {\n\t\tsuper(fn);\n\t\tPreEffect._preEffects.push(this);\n\t\tPreEffect._scheduleFlush();\n\t}\n\n\tprivate static _scheduleFlush(): void {\n\t\tif (!PreEffect._scheduled) {\n\t\t\tPreEffect._scheduled = true;\n\t\t\t// Use queueMicrotask to run before DOM updates\n\t\t\tqueueMicrotask(() => {\n\t\t\t\tPreEffect._scheduled = false;\n\t\t\t\tconst effects = [...PreEffect._preEffects];\n\t\t\t\tPreEffect._preEffects = [];\n\t\t\t\teffects.forEach(e => e.notify());\n\t\t\t});\n\t\t}\n\t}\n\n\toverride dispose(): void {\n\t\tconst idx = PreEffect._preEffects.indexOf(this);\n\t\tif (idx > -1) PreEffect._preEffects.splice(idx, 1);\n\t\tsuper.dispose();\n\t}\n}\n\n/**\n * Create a pre-effect that runs before DOM updates.\n */\nexport function preEffect(fn: EffectFn): PreEffect {\n\treturn new PreEffect(fn);\n}\n\n/**\n * RuneRaw - Shallow reactive state without deep proxying.\n * Updates require reassignment of the entire value.\n */\nexport class RuneRaw<T> implements Notifier {\n\tprivate _value: T;\n\tprivate readonly _id: number;\n\tprivate readonly _subscribers: Set<Subscriber<T>> = new Set();\n\n\tconstructor(initialValue: T) {\n\t\tthis._value = initialValue;\n\t\tthis._id = ++runeId;\n\t}\n\n\tget value(): T {\n\t\tthis.trackDependency();\n\t\treturn this._value;\n\t}\n\n\tset value(newValue: T) {\n\t\tif (Object.is(this._value, newValue)) return;\n\t\tconst oldValue = this._value;\n\t\tthis._value = newValue;\n\t\tthis._notifySubscribers(oldValue);\n\t}\n\n\tget(): T {\n\t\tthis.trackDependency();\n\t\treturn this._value;\n\t}\n\n\tset(newValue: T): void {\n\t\tthis.value = newValue;\n\t}\n\n\tsubscribe(fn: Subscriber<T>): Unsubscribe {\n\t\tthis._subscribers.add(fn);\n\t\treturn () => this._subscribers.delete(fn);\n\t}\n\n\tprivate _notifySubscribers(oldValue: T): void {\n\t\tif (batchDepth > 0) {\n\t\t\tpendingNotifications.add(this);\n\t\t\treturn;\n\t\t}\n\t\tthis.notify();\n\t}\n\n\tnotify(): void {\n\t\tconst value = this._value;\n\t\tthis._subscribers.forEach(fn => fn(value, this._value));\n\t}\n\n\tprivate trackDependency(): void {\n\t\tif (currentEffect) {\n\t\t\tcurrentEffect.addDependency(this as unknown as Rune<unknown>);\n\t\t}\n\t}\n\n\t/**\n\t * Create a snapshot - non-reactive plain copy.\n\t * For objects/arrays, returns a shallow copy.\n\t */\n\tsnapshot(): T {\n\t\tconst val = this._value;\n\t\tif (typeof val === 'object' && val !== null) {\n\t\t\tif (Array.isArray(val)) return [...val] as T;\n\t\t\treturn { ...val } as T;\n\t\t}\n\t\treturn val;\n\t}\n}\n\n/**\n * Create a raw (shallow) rune.\n */\nexport function runeRaw<T>(initialValue: T): RuneRaw<T> {\n\treturn new RuneRaw(initialValue);\n}\n\n/**\n * snapshot - Create a non-reactive plain copy of a value.\n * Works with Rune, RuneRaw, or plain values.\n */\nexport function snapshot<T>(value: T | Rune<T> | RuneRaw<T>): T {\n\tif (value instanceof RuneRaw) {\n\t\treturn value.snapshot();\n\t}\n\tif (value instanceof Rune) {\n\t\tconst val = value.get();\n\t\tif (typeof val === 'object' && val !== null) {\n\t\t\tif (Array.isArray(val)) return [...val] as T;\n\t\t\treturn { ...val } as T;\n\t\t}\n\t\treturn val;\n\t}\n\t// Plain value - return as-is or shallow copy\n\tif (typeof value === 'object' && value !== null) {\n\t\tif (Array.isArray(value)) return [...value] as T;\n\t\treturn { ...value } as T;\n\t}\n\treturn value;\n}\n\n/**\n * EffectRoot - Manual effect lifecycle control.\n * The effect doesn't auto-dispose and must be manually cleaned up.\n */\nexport class EffectRoot {\n\tprivate _effect: Effect | null = null;\n\tprivate _fn: EffectFn;\n\tprivate _disposed = false;\n\n\tconstructor(fn: EffectFn) {\n\t\tthis._fn = fn;\n\t\tthis._start();\n\t}\n\n\tprivate _start(): void {\n\t\tif (this._disposed) return;\n\t\tthis._effect = new Effect(this._fn);\n\t}\n\n\t/**\n\t * Stop the effect and clean up.\n\t */\n\tstop(): void {\n\t\tif (this._effect) {\n\t\t\tthis._effect.dispose();\n\t\t\tthis._effect = null;\n\t\t}\n\t}\n\n\t/**\n\t * Restart the effect after stopping.\n\t */\n\trestart(): void {\n\t\tthis.stop();\n\t\tthis._start();\n\t}\n\n\t/**\n\t * Permanently dispose the effect root.\n\t */\n\tdispose(): void {\n\t\tthis._disposed = true;\n\t\tthis.stop();\n\t}\n}\n\n/**\n * Create an effect root with manual lifecycle control.\n * Returns a cleanup function.\n */\nexport function effectRoot(fn: EffectFn): () => void {\n\tconst root = new EffectRoot(fn);\n\treturn () => root.dispose();\n}\n\n/**\n * tracking - Check if currently inside a reactive tracking context.\n */\nexport function tracking(): boolean {\n\treturn currentEffect !== null;\n}\n\n// === Async Derived and Resource Patterns ===\n\nexport type ResourceStatus = 'idle' | 'pending' | 'success' | 'error';\n\n/**\n * DerivedAsync - Async computed values with loading/error states.\n * Recomputes when dependencies change.\n */\nexport class DerivedAsync<T, E = Error> implements Notifier {\n\tprivate _value: T | undefined;\n\tprivate _error: E | undefined;\n\tprivate _status: ResourceStatus = 'pending';\n\tprivate readonly _compute: () => Promise<T>;\n\tprivate readonly _dependencies: Set<Rune<unknown>> = new Set();\n\tprivate readonly _subscribers: Set<Subscriber<T | undefined>> = new Set();\n\tprivate _dirty: boolean = true;\n\tprivate _disposed: boolean = false;\n\tprivate _abortController: AbortController | null = null;\n\n\tconstructor(compute: () => Promise<T>) {\n\t\tthis._compute = compute;\n\t\tthis._recompute();\n\t}\n\n\tget value(): T | undefined {\n\t\tif (this._dirty) {\n\t\t\tthis._recompute();\n\t\t}\n\t\tthis.trackDependency();\n\t\treturn this._value;\n\t}\n\n\tget error(): E | undefined {\n\t\treturn this._error;\n\t}\n\n\tget status(): ResourceStatus {\n\t\treturn this._status;\n\t}\n\n\tget isPending(): boolean {\n\t\treturn this._status === 'pending';\n\t}\n\n\tget isSuccess(): boolean {\n\t\treturn this._status === 'success';\n\t}\n\n\tget isError(): boolean {\n\t\treturn this._status === 'error';\n\t}\n\n\tget(): T | undefined {\n\t\treturn this.value;\n\t}\n\n\tsubscribe(fn: Subscriber<T | undefined>): Unsubscribe {\n\t\tthis._subscribers.add(fn);\n\t\treturn () => this._subscribers.delete(fn);\n\t}\n\n\tprivate async _recompute(): Promise<void> {\n\t\t// Abort previous request\n\t\tif (this._abortController) {\n\t\t\tthis._abortController.abort();\n\t\t}\n\t\tthis._abortController = new AbortController();\n\n\t\t// Track dependencies\n\t\tconst oldDeps = new Set(this._dependencies);\n\t\tthis._dependencies.clear();\n\n\t\tconst prevEffect = currentEffect;\n\t\tconst collector = {\n\t\t\taddDependency: (rune: Rune<unknown>) => {\n\t\t\t\tthis._dependencies.add(rune);\n\t\t\t}\n\t\t} as Effect;\n\n\t\tcurrentEffect = collector;\n\t\tlet promise: Promise<T>;\n\t\ttry {\n\t\t\tpromise = this._compute();\n\t\t\tthis._dirty = false;\n\t\t} finally {\n\t\t\tcurrentEffect = prevEffect;\n\t\t}\n\n\t\t// Subscribe to new dependencies\n\t\tthis._dependencies.forEach(dep => {\n\t\t\tif (!oldDeps.has(dep)) {\n\t\t\t\tdep.subscribe(() => {\n\t\t\t\t\tthis._dirty = true;\n\t\t\t\t\tthis._recompute();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// Execute async computation\n\t\tthis._status = 'pending';\n\t\tthis._notifySubscribers();\n\n\t\ttry {\n\t\t\tconst result = await promise;\n\t\t\tif (this._abortController?.signal.aborted) return;\n\t\t\tthis._value = result;\n\t\t\tthis._error = undefined;\n\t\t\tthis._status = 'success';\n\t\t} catch (err) {\n\t\t\tif (this._abortController?.signal.aborted) return;\n\t\t\tthis._error = err as E;\n\t\t\tthis._status = 'error';\n\t\t}\n\n\t\tthis._notifySubscribers();\n\t}\n\n\tprivate _notifySubscribers(): void {\n\t\tif (batchDepth > 0) {\n\t\t\tpendingNotifications.add(this);\n\t\t\treturn;\n\t\t}\n\t\tthis.notify();\n\t}\n\n\tnotify(): void {\n\t\tconst value = this._value;\n\t\tthis._subscribers.forEach(fn => fn(value, this._value));\n\t}\n\n\tprivate trackDependency(): void {\n\t\tif (currentEffect) {\n\t\t\tcurrentEffect.addDependency(this as unknown as Rune<unknown>);\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis._disposed = true;\n\t\tif (this._abortController) {\n\t\t\tthis._abortController.abort();\n\t\t}\n\t\tthis._dependencies.clear();\n\t\tthis._subscribers.clear();\n\t}\n}\n\n/**\n * Create an async derived value.\n */\nexport function derivedAsync<T, E = Error>(compute: () => Promise<T>): DerivedAsync<T, E> {\n\treturn new DerivedAsync(compute);\n}\n\n/**\n * Resource - Wrap async data fetching with reactive status.\n * Similar to SvelteKit's loading stores and Runed's resource.\n */\nexport class Resource<T, E = Error> {\n\tprivate _data: Rune<T | undefined>;\n\tprivate _error: Rune<E | undefined>;\n\tprivate _status: Rune<ResourceStatus>;\n\tprivate _fetcher: () => Promise<T>;\n\tprivate _abortController: AbortController | null = null;\n\n\tconstructor(fetcher: () => Promise<T>) {\n\t\tthis._fetcher = fetcher;\n\t\tthis._data = new Rune<T | undefined>(undefined);\n\t\tthis._error = new Rune<E | undefined>(undefined);\n\t\tthis._status = new Rune<ResourceStatus>('idle');\n\t}\n\n\tget data(): T | undefined {\n\t\treturn this._data.get();\n\t}\n\n\tget error(): E | undefined {\n\t\treturn this._error.get();\n\t}\n\n\tget status(): ResourceStatus {\n\t\treturn this._status.get();\n\t}\n\n\tget isIdle(): boolean {\n\t\treturn this._status.get() === 'idle';\n\t}\n\n\tget isPending(): boolean {\n\t\treturn this._status.get() === 'pending';\n\t}\n\n\tget isSuccess(): boolean {\n\t\treturn this._status.get() === 'success';\n\t}\n\n\tget isError(): boolean {\n\t\treturn this._status.get() === 'error';\n\t}\n\n\t/**\n\t * Fetch or refetch the resource.\n\t */\n\tasync refetch(): Promise<void> {\n\t\t// Abort previous request\n\t\tif (this._abortController) {\n\t\t\tthis._abortController.abort();\n\t\t}\n\t\tthis._abortController = new AbortController();\n\n\t\tthis._status.set('pending');\n\t\tthis._error.set(undefined);\n\n\t\ttry {\n\t\t\tconst result = await this._fetcher();\n\t\t\tif (this._abortController?.signal.aborted) return;\n\t\t\tthis._data.set(result);\n\t\t\tthis._status.set('success');\n\t\t} catch (err) {\n\t\t\tif (this._abortController?.signal.aborted) return;\n\t\t\tthis._error.set(err as E);\n\t\t\tthis._status.set('error');\n\t\t}\n\t}\n\n\t/**\n\t * Reset to idle state.\n\t */\n\treset(): void {\n\t\tif (this._abortController) {\n\t\t\tthis._abortController.abort();\n\t\t\tthis._abortController = null;\n\t\t}\n\t\tthis._data.set(undefined);\n\t\tthis._error.set(undefined);\n\t\tthis._status.set('idle');\n\t}\n}\n\n/**\n * Create a resource from an async fetcher.\n */\nexport function resource<T, E = Error>(fetcher: () => Promise<T>): Resource<T, E> {\n\treturn new Resource(fetcher);\n}\n\n/**\n * Create a resource that auto-fetches when sources change.\n */\nexport function resourceReactive<T, E = Error>(\n\tsources: Rune<unknown> | Rune<unknown>[],\n\tfetcher: () => Promise<T>\n): Resource<T, E> {\n\tconst res = new Resource<T, E>(fetcher);\n\tconst sourceArray = Array.isArray(sources) ? sources : [sources];\n\n\t// Auto-refetch when sources change\n\tsourceArray.forEach(source => {\n\t\tsource.subscribe(() => {\n\t\t\tres.refetch();\n\t\t});\n\t});\n\n\t// Initial fetch\n\tres.refetch();\n\n\treturn res;\n}\n\n// === $inspect Debug Helper ===\n\ntype InspectType = 'init' | 'update';\n\n/**\n * $inspect - Debug helper for observing state changes (dev only).\n * In production, this becomes a no-op.\n */\nexport function inspect<T>(...values: (() => T)[] | T[]): { \n\twith: (callback: (type: InspectType, value: T[]) => void) => void \n} {\n\t// Check if in development\n\tconst isDev = typeof window !== 'undefined' && \n\t\t(window as unknown as { __GOSPA_DEV__?: boolean }).__GOSPA_DEV__ !== false;\n\n\tif (!isDev) {\n\t\treturn { with: () => {} };\n\t}\n\n\tlet firstRun = true;\n\tconst callbacks: Array<(type: InspectType, value: T[]) => void> = [];\n\n\t// Log initial values\n\tconst getValues = (): T[] => values.map(v => typeof v === 'function' ? (v as () => T)() : v);\n\t\n\tconst logValues = (type: InspectType) => {\n\t\tconst currentValues = getValues();\n\t\tconsole.log(`%c[${type}]`, 'color: #888', ...currentValues);\n\t\tcallbacks.forEach(cb => cb(type, currentValues));\n\t};\n\n\t// Set up effect to track changes\n\tnew Effect(() => {\n\t\t// Read all values to track them\n\t\tgetValues();\n\t\t\n\t\tif (firstRun) {\n\t\t\tfirstRun = false;\n\t\t\tlogValues('init');\n\t\t} else {\n\t\t\tlogValues('update');\n\t\t}\n\t});\n\n\treturn {\n\t\twith: (callback: (type: InspectType, value: T[]) => void) => {\n\t\t\tcallbacks.push(callback);\n\t\t}\n\t};\n}\n\n/**\n * $inspect.trace - Log which dependencies triggered an effect.\n */\ninspect.trace = (label?: string) => {\n\tconst isDev = typeof window !== 'undefined' && \n\t\t(window as unknown as { __GOSPA_DEV__?: boolean }).__GOSPA_DEV__ !== false;\n\n\tif (!isDev) return;\n\n\tconsole.log(`%c[trace]${label ? ` ${label}` : ''}`, 'color: #666; font-style: italic');\n};\n\n// === Deep Watch Path Support ===\n\n/**\n * Get a nested property value by dot-separated path.\n */\nfunction getByPath<T>(obj: T, path: string): unknown {\n\tconst parts = path.split('.');\n\tlet current: unknown = obj;\n\t\n\tfor (const part of parts) {\n\t\tif (current === null || current === undefined) return undefined;\n\t\tif (typeof current !== 'object') return undefined;\n\t\tcurrent = (current as Record<string, unknown>)[part];\n\t}\n\t\n\treturn current;\n}\n\n/**\n * Watch a specific path in an object for changes.\n * Returns unsubscribe function.\n */\nexport function watchPath<T extends object>(\n\tobj: Rune<T>,\n\tpath: string,\n\tcallback: (value: unknown, oldValue: unknown) => void\n): Unsubscribe {\n\tlet oldValue: unknown;\n\t\n\treturn obj.subscribe((current) => {\n\t\tconst newValue = getByPath(current, path);\n\t\tif (newValue !== oldValue) {\n\t\t\tcallback(newValue, oldValue);\n\t\t\toldValue = newValue;\n\t\t}\n\t});\n}\n\n/**\n * Create a derived value from a specific path in a reactive object.\n */\nexport function derivedPath<T extends object>(\n\tobj: Rune<T>,\n\tpath: string\n): Derived<unknown> {\n\treturn new Derived(() => getByPath(obj.get(), path));\n}\n",
    "// DOM update engine for reactive bindings\n\nimport { Rune, Derived, batch } from './state.ts';\n\n// Binding types\nexport type BindingType = 'text' | 'html' | 'value' | 'checked' | 'class' | 'style' | 'attr' | 'prop';\n\n// Binding configuration\nexport interface Binding {\n\ttype: BindingType;\n\tkey: string;\n\telement: Element;\n\tattribute?: string;\n\ttransform?: (value: unknown) => unknown;\n}\n\n// Binding registry\nconst bindings = new Map<string, Set<Binding>>();\nconst elementBindings = new WeakMap<Element, Set<Binding>>();\n\n// Create a unique binding ID\nlet bindingId = 0;\nfunction nextBindingId(): string {\n\treturn `binding-${++bindingId}`;\n}\n\n// Register a binding\nexport function registerBinding(binding: Binding): string {\n\tconst id = nextBindingId();\n\t\n\tif (!bindings.has(id)) {\n\t\tbindings.set(id, new Set());\n\t}\n\tbindings.get(id)!.add(binding);\n\t\n\tif (!elementBindings.has(binding.element)) {\n\t\telementBindings.set(binding.element, new Set());\n\t}\n\telementBindings.get(binding.element)!.add(binding);\n\t\n\treturn id;\n}\n\n// Unregister a binding\nexport function unregisterBinding(id: string): void {\n\tconst bindingSet = bindings.get(id);\n\tif (bindingSet) {\n\t\tbindingSet.forEach(binding => {\n\t\t\tconst elemBindings = elementBindings.get(binding.element);\n\t\t\tif (elemBindings) {\n\t\t\t\telemBindings.delete(binding);\n\t\t\t\tif (elemBindings.size === 0) {\n\t\t\t\t\telementBindings.delete(binding.element);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tbindings.delete(id);\n\t}\n}\n\n// Update element based on binding type\nfunction updateElement(binding: Binding, value: unknown): void {\n\tconst { element, type, attribute, transform } = binding;\n\tconst transformedValue = transform ? transform(value) : value;\n\t\n\tswitch (type) {\n\t\tcase 'text':\n\t\t\tif (element instanceof HTMLElement || element instanceof SVGElement) {\n\t\t\t\telement.textContent = String(transformedValue ?? '');\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n\t\tcase 'html':\n\t\t\tif (element instanceof HTMLElement) {\n\t\t\t\telement.innerHTML = String(transformedValue ?? '');\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n\t\tcase 'value':\n\t\t\tif (element instanceof HTMLInputElement || \n\t\t\t\telement instanceof HTMLTextAreaElement || \n\t\t\t\telement instanceof HTMLSelectElement) {\n\t\t\t\tif (element.value !== String(transformedValue ?? '')) {\n\t\t\t\t\telement.value = String(transformedValue ?? '');\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n\t\tcase 'checked':\n\t\t\tif (element instanceof HTMLInputElement) {\n\t\t\t\telement.checked = Boolean(transformedValue);\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n\t\tcase 'class':\n\t\t\tif (element instanceof Element) {\n\t\t\t\tif (attribute) {\n\t\t\t\t\t// Toggle specific class\n\t\t\t\t\tif (transformedValue) {\n\t\t\t\t\t\telement.classList.add(attribute);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.classList.remove(attribute);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof transformedValue === 'string') {\n\t\t\t\t\t// Set class string\n\t\t\t\t\telement.className = transformedValue;\n\t\t\t\t} else if (Array.isArray(transformedValue)) {\n\t\t\t\t\t// Set class array\n\t\t\t\t\telement.className = transformedValue.join(' ');\n\t\t\t\t} else if (typeof transformedValue === 'object' && transformedValue !== null) {\n\t\t\t\t\t// Toggle classes by object\n\t\t\t\t\tObject.entries(transformedValue as Record<string, boolean>).forEach(([cls, enabled]) => {\n\t\t\t\t\t\tif (enabled) {\n\t\t\t\t\t\t\telement.classList.add(cls);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telement.classList.remove(cls);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n\t\tcase 'style':\n\t\t\tif (element instanceof HTMLElement || element instanceof SVGElement) {\n\t\t\t\tif (attribute) {\n\t\t\t\t\t// Set specific style property\n\t\t\t\t\t(element.style as unknown as Record<string, string>)[attribute] = \n\t\t\t\t\t\tString(transformedValue ?? '');\n\t\t\t\t} else if (typeof transformedValue === 'string') {\n\t\t\t\t\t// Set style string\n\t\t\t\t\telement.setAttribute('style', transformedValue);\n\t\t\t\t} else if (typeof transformedValue === 'object' && transformedValue !== null) {\n\t\t\t\t\t// Set styles by object\n\t\t\t\t\tObject.entries(transformedValue as Record<string, string>).forEach(([prop, val]) => {\n\t\t\t\t\t\t(element.style as unknown as Record<string, string>)[prop] = val;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n\t\tcase 'attr':\n\t\t\tif (attribute) {\n\t\t\t\tif (transformedValue === null || transformedValue === undefined || transformedValue === false) {\n\t\t\t\t\telement.removeAttribute(attribute);\n\t\t\t\t} else if (transformedValue === true) {\n\t\t\t\t\telement.setAttribute(attribute, '');\n\t\t\t\t} else {\n\t\t\t\t\telement.setAttribute(attribute, String(transformedValue));\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\t\t\n\t\tcase 'prop':\n\t\t\tif (attribute && element instanceof HTMLElement) {\n\t\t\t\t(element as unknown as Record<string, unknown>)[attribute] = transformedValue;\n\t\t\t}\n\t\t\tbreak;\n\t}\n}\n\n// Bind a rune to an element\nexport function bindElement<T>(\n\telement: Element,\n\trune: Rune<T>,\n\toptions: Partial<Binding> = {}\n): () => void {\n\tconst binding: Binding = {\n\t\ttype: options.type || 'text',\n\t\tkey: options.key || '',\n\t\telement,\n\t\tattribute: options.attribute,\n\t\ttransform: options.transform\n\t};\n\t\n\tconst id = registerBinding(binding);\n\t\n\t// Initial update\n\tupdateElement(binding, rune.get());\n\t\n\t// Subscribe to changes\n\tconst unsubscribe = rune.subscribe((value) => {\n\t\tupdateElement(binding, value);\n\t});\n\t\n\t// Return cleanup function\n\treturn () => {\n\t\tunsubscribe();\n\t\tunregisterBinding(id);\n\t};\n}\n\n// Bind a derived value to an element\nexport function bindDerived<T>(\n\telement: Element,\n\tderived: Derived<T>,\n\toptions: Partial<Binding> = {}\n): () => void {\n\tconst binding: Binding = {\n\t\ttype: options.type || 'text',\n\t\tkey: options.key || '',\n\t\telement,\n\t\tattribute: options.attribute,\n\t\ttransform: options.transform\n\t};\n\t\n\tconst id = registerBinding(binding);\n\t\n\t// Initial update\n\tupdateElement(binding, derived.get());\n\t\n\t// Subscribe to changes\n\tconst unsubscribe = derived.subscribe((value) => {\n\t\tupdateElement(binding, value);\n\t});\n\t\n\t// Return cleanup function\n\treturn () => {\n\t\tunsubscribe();\n\t\tunregisterBinding(id);\n\t};\n}\n\n// Create two-way binding for form elements\nexport function bindTwoWay<T extends string | number | boolean>(\n\telement: HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement,\n\trune: Rune<T>\n): () => void {\n\tconst isCheckbox = element instanceof HTMLInputElement && element.type === 'checkbox';\n\tconst isRadio = element instanceof HTMLInputElement && element.type === 'radio';\n\tconst isNumber = element instanceof HTMLInputElement && element.type === 'number';\n\t\n\t// Initial value\n\tif (isCheckbox) {\n\t\telement.checked = Boolean(rune.get());\n\t} else {\n\t\telement.value = String(rune.get() ?? '');\n\t}\n\t\n\t// Subscribe to rune changes\n\tconst unsubscribe = rune.subscribe((value) => {\n\t\tif (isCheckbox) {\n\t\t\telement.checked = Boolean(value);\n\t\t} else {\n\t\t\tif (element.value !== String(value ?? '')) {\n\t\t\t\telement.value = String(value ?? '');\n\t\t\t}\n\t\t}\n\t});\n\t\n\t// Listen to input changes\n\tconst inputHandler = () => {\n\t\tlet newValue: string | number | boolean;\n\t\t\n\t\tif (isCheckbox) {\n\t\t\tnewValue = element.checked;\n\t\t} else if (isNumber) {\n\t\t\tnewValue = element.value ? parseFloat(element.value) : 0;\n\t\t} else {\n\t\t\tnewValue = element.value;\n\t\t}\n\t\t\n\t\tbatch(() => {\n\t\t\trune.set(newValue as T);\n\t\t});\n\t};\n\t\n\telement.addEventListener('input', inputHandler);\n\telement.addEventListener('change', inputHandler);\n\t\n\t// Return cleanup function\n\treturn () => {\n\t\tunsubscribe();\n\t\telement.removeEventListener('input', inputHandler);\n\t\telement.removeEventListener('change', inputHandler);\n\t};\n}\n\n// Query selector helper with reactive updates\nexport function querySelector(selector: string): Element | null {\n\treturn document.querySelector(selector);\n}\n\nexport function querySelectorAll(selector: string): NodeListOf<Element> {\n\treturn document.querySelectorAll(selector);\n}\n\n// Create element with bindings\nexport function createElement<K extends keyof HTMLElementTagNameMap>(\n\ttag: K,\n\tattrs: Record<string, unknown> = {},\n\tchildren?: (Element | string)[]\n): HTMLElementTagNameMap[K] {\n\tconst element = document.createElement(tag);\n\t\n\tObject.entries(attrs).forEach(([key, value]) => {\n\t\tif (key.startsWith('on') && typeof value === 'function') {\n\t\t\t// Event listener\n\t\t\tconst eventName = key.slice(2).toLowerCase();\n\t\t\telement.addEventListener(eventName, value as EventListener);\n\t\t} else if (key === 'class') {\n\t\t\t// Class\n\t\t\tif (typeof value === 'string') {\n\t\t\t\telement.className = value;\n\t\t\t} else if (Array.isArray(value)) {\n\t\t\t\telement.className = value.join(' ');\n\t\t\t} else if (typeof value === 'object' && value !== null) {\n\t\t\t\tObject.entries(value as Record<string, boolean>).forEach(([cls, enabled]) => {\n\t\t\t\t\tif (enabled) element.classList.add(cls);\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (key === 'style' && typeof value === 'object') {\n\t\t\t// Style object\n\t\t\tObject.entries(value as Record<string, string>).forEach(([prop, val]) => {\n\t\t\t\t(element.style as unknown as Record<string, string>)[prop] = val;\n\t\t\t});\n\t\t} else if (value instanceof Rune) {\n\t\t\t// Reactive binding\n\t\t\tbindElement(element, value, { type: 'attr', attribute: key });\n\t\t} else {\n\t\t\t// Static attribute\n\t\t\telement.setAttribute(key, String(value));\n\t\t}\n\t});\n\t\n\tif (children) {\n\t\tchildren.forEach(child => {\n\t\t\tif (typeof child === 'string') {\n\t\t\t\telement.appendChild(document.createTextNode(child));\n\t\t\t} else {\n\t\t\t\telement.appendChild(child);\n\t\t\t}\n\t\t});\n\t}\n\t\n\treturn element;\n}\n\n// Conditional rendering helper\nexport function renderIf<T>(\n\tcondition: Rune<boolean> | Derived<boolean>,\n\ttrueRender: () => T,\n\tfalseRender?: () => T\n): { element: T | null; cleanup: () => void } {\n\tlet current: T | null = null;\n\t\n\tconst update = (value: boolean) => {\n\t\tif (value) {\n\t\t\tif (!current) {\n\t\t\t\tcurrent = trueRender();\n\t\t\t}\n\t\t} else {\n\t\t\tif (current && falseRender) {\n\t\t\t\tcurrent = falseRender();\n\t\t\t} else {\n\t\t\t\tcurrent = null;\n\t\t\t}\n\t\t}\n\t};\n\t\n\t// Initial render\n\tupdate(condition.get());\n\t\n\t// Subscribe to changes\n\tconst unsubscribe = condition.subscribe(update);\n\t\n\treturn {\n\t\telement: current,\n\t\tcleanup: () => {\n\t\t\tunsubscribe();\n\t\t}\n\t};\n}\n\n// List rendering helper with key tracking\nexport function renderList<T, K>(\n\titems: Rune<T[]> | Derived<T[]>,\n\trender: (item: T, index: number) => Element,\n\tgetKey: (item: T, index: number) => K\n): { container: Element; cleanup: () => void } {\n\tconst container = document.createDocumentFragment();\n\tconst containerElement = document.createElement('div');\n\tcontainer.appendChild(containerElement);\n\t\n\tconst itemMap = new Map<K, { element: Element; index: number }>();\n\t\n\tconst update = (newItems: T[]) => {\n\t\tconst newKeys = new Set<K>();\n\t\t\n\t\t// Add or update items\n\t\tnewItems.forEach((item, index) => {\n\t\t\tconst key = getKey(item, index);\n\t\t\tnewKeys.add(key);\n\t\t\t\n\t\t\tif (!itemMap.has(key)) {\n\t\t\t\tconst element = render(item, index);\n\t\t\t\titemMap.set(key, { element, index });\n\t\t\t\tcontainerElement.appendChild(element);\n\t\t\t} else {\n\t\t\t\tconst existing = itemMap.get(key)!;\n\t\t\t\texisting.index = index;\n\t\t\t\t// Reorder if needed\n\t\t\t\tif (containerElement.children[index] !== existing.element) {\n\t\t\t\t\tcontainerElement.insertBefore(existing.element, containerElement.children[index] || null);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t\t// Remove items not in new list\n\t\titemMap.forEach((value, key) => {\n\t\t\tif (!newKeys.has(key)) {\n\t\t\t\tvalue.element.remove();\n\t\t\t\titemMap.delete(key);\n\t\t\t}\n\t\t});\n\t};\n\t\n\t// Initial render\n\tupdate(items.get());\n\t\n\t// Subscribe to changes\n\tconst unsubscribe = items.subscribe(update);\n\t\n\treturn {\n\t\tcontainer: containerElement,\n\t\tcleanup: () => {\n\t\t\tunsubscribe();\n\t\t\titemMap.clear();\n\t\t}\n\t};\n}\n",
    "// Event handling system for reactive bindings\n\nimport { Rune } from './state.ts';\n\n// Event handler types\nexport type EventHandler<E = Event> = (event: E) => void | Promise<void>;\nexport type ModifierHandler<E = Event> = (event: E, handler: EventHandler<E>) => void | Promise<void>;\n\n// Event modifiers\nexport type EventModifier = 'prevent' | 'stop' | 'capture' | 'once' | 'passive' | 'self';\n\n// Modifier implementations\nconst modifiers: Record<EventModifier, ModifierHandler> = {\n\tprevent: (event, handler) => {\n\t\tevent.preventDefault();\n\t\treturn handler(event);\n\t},\n\tstop: (event, handler) => {\n\t\tevent.stopPropagation();\n\t\treturn handler(event);\n\t},\n\tcapture: (event, handler) => handler(event),\n\tonce: (event, handler) => handler(event),\n\tpassive: (event, handler) => handler(event),\n\tself: (event, handler) => {\n\t\tif (event.target === event.currentTarget) {\n\t\t\treturn handler(event);\n\t\t}\n\t}\n};\n\n// Event configuration\nexport interface EventConfig {\n\tevent: string;\n\thandler: EventHandler;\n\tmodifiers?: EventModifier[];\n\toptions?: AddEventListenerOptions;\n}\n\n// Event listener registry for cleanup\nconst listenerRegistry = new WeakMap<EventTarget, Map<string, Set<EventListener>>>();\n\n// Create wrapped handler with modifiers\nfunction createWrappedHandler<E extends Event>(\n\thandler: EventHandler<E>,\n\tmods: EventModifier[]\n): EventHandler<E> {\n\treturn (event: E) => {\n\t\t// Apply modifiers in order\n\t\tfor (const mod of mods) {\n\t\t\tif (mod === 'capture' || mod === 'once' || mod === 'passive') {\n\t\t\t\tcontinue; // These are handled by addEventListener options\n\t\t\t}\n\t\t\tconst modHandler = modifiers[mod];\n\t\t\tmodHandler(event, handler as EventHandler);\n\t\t}\n\t\t\n\t\t// Call handler directly if no active modifiers\n\t\tconst activeMods = mods.filter(m => !['capture', 'once', 'passive'].includes(m));\n\t\tif (activeMods.length === 0) {\n\t\t\treturn handler(event);\n\t\t}\n\t};\n}\n\n// Parse event string like \"click:prevent:stop\"\nexport function parseEventString(eventStr: string): { event: string; modifiers: EventModifier[] } {\n\tconst parts = eventStr.split(':');\n\tconst event = parts[0];\n\tconst mods = parts.slice(1) as EventModifier[];\n\t\n\treturn { event, modifiers: mods };\n}\n\n// Add event listener with modifiers\nexport function on<K extends keyof HTMLElementEventMap>(\n\ttarget: EventTarget,\n\teventStr: string,\n\thandler: EventHandler<HTMLElementEventMap[K] extends Event ? HTMLElementEventMap[K] : Event>\n): () => void {\n\tconst { event, modifiers: mods } = parseEventString(eventStr);\n\t\n\t// Build options from modifiers\n\tconst options: AddEventListenerOptions = {\n\t\tcapture: mods.includes('capture'),\n\t\tonce: mods.includes('once'),\n\t\tpassive: mods.includes('passive')\n\t};\n\t\n\t// Create wrapped handler\n\tconst wrappedHandler = createWrappedHandler(handler as EventHandler, mods);\n\t\n\t// Add listener\n\ttarget.addEventListener(event, wrappedHandler as EventListener, options);\n\t\n\t// Track for cleanup\n\tif (!listenerRegistry.has(target)) {\n\t\tlistenerRegistry.set(target, new Map());\n\t}\n\tconst targetMap = listenerRegistry.get(target)!;\n\tif (!targetMap.has(eventStr)) {\n\t\ttargetMap.set(eventStr, new Set());\n\t}\n\ttargetMap.get(eventStr)!.add(wrappedHandler as EventListener);\n\t\n\t// Return cleanup function\n\treturn () => {\n\t\ttarget.removeEventListener(event, wrappedHandler as EventListener, options);\n\t\tconst set = targetMap.get(eventStr);\n\t\tif (set) {\n\t\t\tset.delete(wrappedHandler as EventListener);\n\t\t\tif (set.size === 0) {\n\t\t\t\ttargetMap.delete(eventStr);\n\t\t\t}\n\t\t}\n\t};\n}\n\n// Remove all listeners for a target\nexport function offAll(target: EventTarget): void {\n\tconst targetMap = listenerRegistry.get(target);\n\tif (!targetMap) return;\n\t\n\tfor (const [eventStr, listeners] of targetMap) {\n\t\tconst { event, modifiers: mods } = parseEventString(eventStr);\n\t\tconst options: AddEventListenerOptions = {\n\t\t\tcapture: mods.includes('capture')\n\t\t};\n\t\t\n\t\tfor (const listener of listeners) {\n\t\t\ttarget.removeEventListener(event, listener, options);\n\t\t}\n\t}\n\t\n\tlistenerRegistry.delete(target);\n}\n\n// Debounce event handler\nexport function debounce<E extends Event>(\n\thandler: EventHandler<E>,\n\twait: number\n): EventHandler<E> {\n\tlet timeoutId: ReturnType<typeof setTimeout> | null = null;\n\t\n\treturn (event: E) => {\n\t\tif (timeoutId) {\n\t\t\tclearTimeout(timeoutId);\n\t\t}\n\t\t\n\t\ttimeoutId = setTimeout(() => {\n\t\t\thandler(event);\n\t\t\ttimeoutId = null;\n\t\t}, wait);\n\t};\n}\n\n// Throttle event handler\nexport function throttle<E extends Event>(\n\thandler: EventHandler<E>,\n\tlimit: number\n): EventHandler<E> {\n\tlet inThrottle = false;\n\t\n\treturn (event: E) => {\n\t\tif (!inThrottle) {\n\t\t\thandler(event);\n\t\t\tinThrottle = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\tinThrottle = false;\n\t\t\t}, limit);\n\t\t}\n\t};\n}\n\n// Bind event to rune update\nexport function bindEvent<E extends Event>(\n\ttarget: EventTarget,\n\teventStr: string,\n\trune: Rune<unknown>,\n\ttransformer: (event: E) => unknown\n): () => void {\n\treturn on(target, eventStr, (event) => {\n\t\tconst value = transformer(event as E);\n\t\trune.set(value);\n\t});\n}\n\n// Common event transformers\nexport const transformers = {\n\tvalue: (event: Event) => (event.target as HTMLInputElement).value,\n\tchecked: (event: Event) => (event.target as HTMLInputElement).checked,\n\tnumberValue: (event: Event) => Number((event.target as HTMLInputElement).value),\n\tfiles: (event: Event) => (event.target as HTMLInputElement).files,\n\tformData: (event: Event) => {\n\t\tevent.preventDefault();\n\t\treturn new FormData(event.target as HTMLFormElement);\n\t}\n};\n\n// Event delegation helper\nexport function delegate(\n\troot: EventTarget,\n\tselector: string,\n\teventStr: string,\n\thandler: EventHandler\n): () => void {\n\tconst { event, modifiers: mods } = parseEventString(eventStr);\n\t\n\tconst delegatedHandler = (e: Event) => {\n\t\tconst target = e.target as Element;\n\t\tconst matched = target.closest(selector);\n\t\t\n\t\tif (matched) {\n\t\t\tconst wrappedHandler = createWrappedHandler(handler, mods);\n\t\t\twrappedHandler(e);\n\t\t}\n\t};\n\t\n\tconst options: AddEventListenerOptions = {\n\t\tcapture: mods.includes('capture'),\n\t\tpassive: mods.includes('passive')\n\t};\n\t\n\troot.addEventListener(event, delegatedHandler, options);\n\t\n\treturn () => {\n\t\troot.removeEventListener(event, delegatedHandler, options);\n\t};\n}\n\n// Keyboard event helpers\nexport function onKey(\n\tkeys: string | string[],\n\thandler: EventHandler<KeyboardEvent>,\n\toptions?: { preventDefault?: boolean }\n): EventHandler<KeyboardEvent> {\n\tconst keyArray = Array.isArray(keys) ? keys : [keys];\n\t\n\treturn (event: KeyboardEvent) => {\n\t\tif (keyArray.includes(event.key)) {\n\t\t\tif (options?.preventDefault) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\thandler(event);\n\t\t}\n\t};\n}\n\n// Common key shortcuts\nexport const keys = {\n\tenter: 'Enter',\n\tescape: 'Escape',\n\ttab: 'Tab',\n\tspace: ' ',\n\tarrowUp: 'ArrowUp',\n\tarrowDown: 'ArrowDown',\n\tarrowLeft: 'ArrowLeft',\n\tarrowRight: 'ArrowRight'\n};\n",
    "// WebSocket client for real-time state synchronization\n\nimport { Rune, batch } from './state.ts';\n\n// Connection states\nexport type ConnectionState = 'connecting' | 'connected' | 'disconnecting' | 'disconnected';\n\n// Message types matching server\nexport type MessageType = 'init' | 'update' | 'sync' | 'error' | 'ping' | 'pong';\n\nexport interface StateMessage {\n\ttype: MessageType;\n\tcomponentId?: string;\n\tdata?: Record<string, unknown>;\n\tpayload?: Record<string, unknown>;\n\tstate?: Record<string, unknown>; // Server global state from SendState()\n\tdiff?: Record<string, unknown>;\n\terror?: string;\n\ttimestamp?: number;\n}\n\n// WebSocket configuration\nexport interface WebSocketConfig {\n\turl: string;\n\treconnect?: boolean;\n\treconnectInterval?: number;\n\tmaxReconnectAttempts?: number;\n\theartbeatInterval?: number;\n\tonOpen?: () => void;\n\tonClose?: (event: CloseEvent) => void;\n\tonError?: (error: Event) => void;\n\tonMessage?: (message: StateMessage) => void;\n}\n\n// WebSocket client\nexport class WSClient {\n\tprivate ws: WebSocket | null = null;\n\tprivate config: Required<WebSocketConfig>;\n\tprivate reconnectAttempts = 0;\n\tprivate heartbeatTimer: ReturnType<typeof setInterval> | null = null;\n\tprivate messageQueue: StateMessage[] = [];\n\tprivate connectionState: Rune<ConnectionState>;\n\tprivate pendingRequests = new Map<string, { resolve: (value: unknown) => void; reject: (error: Error) => void }>();\n\tprivate requestId = 0;\n\n\tconstructor(config: WebSocketConfig) {\n\t\tthis.config = {\n\t\t\treconnect: true,\n\t\t\treconnectInterval: 1000,\n\t\t\tmaxReconnectAttempts: 10,\n\t\t\theartbeatInterval: 30000,\n\t\t\tonOpen: () => { },\n\t\t\tonClose: () => { },\n\t\t\tonError: () => { },\n\t\t\tonMessage: () => { },\n\t\t\t...config\n\t\t};\n\t\tthis.connectionState = new Rune<ConnectionState>('disconnected');\n\t}\n\n\tget state(): ConnectionState {\n\t\treturn this.connectionState.get();\n\t}\n\n\tget isConnected(): boolean {\n\t\treturn this.connectionState.get() === 'connected';\n\t}\n\n\tconnect(): Promise<void> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.ws?.readyState === WebSocket.OPEN) {\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.connectionState.set('connecting');\n\n\t\t\ttry {\n\t\t\t\tthis.ws = new WebSocket(this.config.url);\n\t\t\t} catch (error) {\n\t\t\t\tthis.connectionState.set('disconnected');\n\t\t\t\treject(error);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.ws.onopen = () => {\n\t\t\t\tthis.connectionState.set('connected');\n\t\t\t\tthis.reconnectAttempts = 0;\n\t\t\t\tthis.startHeartbeat();\n\t\t\t\tthis.flushMessageQueue();\n\n\t\t\t\t// State HMR: Request fresh state from server on reconnect\n\t\t\t\t// This softly patches the runes locally without refreshing the page!\n\t\t\t\tthis.send({ type: 'sync' });\n\n\t\t\t\tthis.config.onOpen();\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tthis.ws.onclose = (event) => {\n\t\t\t\tthis.connectionState.set('disconnected');\n\t\t\t\tthis.stopHeartbeat();\n\t\t\t\tthis.config.onClose(event);\n\n\t\t\t\tif (this.config.reconnect && this.reconnectAttempts < this.config.maxReconnectAttempts) {\n\t\t\t\t\tthis.scheduleReconnect();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.ws.onerror = (error) => {\n\t\t\t\tthis.config.onError(error);\n\t\t\t\tif (this.connectionState.get() === 'connecting') {\n\t\t\t\t\treject(new Error('WebSocket connection failed'));\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.ws.onmessage = (event) => {\n\t\t\t\tthis.handleMessage(event.data);\n\t\t\t};\n\t\t});\n\t}\n\n\tdisconnect(): void {\n\t\tif (this.ws) {\n\t\t\tthis.connectionState.set('disconnecting');\n\t\t\tthis.stopHeartbeat();\n\t\t\tthis.ws.close(1000, 'Client disconnect');\n\t\t\tthis.ws = null;\n\t\t\tthis.connectionState.set('disconnected');\n\t\t}\n\t}\n\n\tprivate scheduleReconnect(): void {\n\t\tthis.reconnectAttempts++;\n\t\tconst delay = this.config.reconnectInterval * Math.min(this.reconnectAttempts, 5);\n\n\t\tsetTimeout(() => {\n\t\t\tif (this.connectionState.get() === 'disconnected') {\n\t\t\t\tthis.connect().catch(() => { });\n\t\t\t}\n\t\t}, delay);\n\t}\n\n\tprivate startHeartbeat(): void {\n\t\tthis.heartbeatTimer = setInterval(() => {\n\t\t\tthis.send({ type: 'ping' });\n\t\t}, this.config.heartbeatInterval);\n\t}\n\n\tprivate stopHeartbeat(): void {\n\t\tif (this.heartbeatTimer) {\n\t\t\tclearInterval(this.heartbeatTimer);\n\t\t\tthis.heartbeatTimer = null;\n\t\t}\n\t}\n\n\tprivate flushMessageQueue(): void {\n\t\twhile (this.messageQueue.length > 0 && this.isConnected) {\n\t\t\tconst message = this.messageQueue.shift();\n\t\t\tif (message) {\n\t\t\t\tthis.send(message);\n\t\t\t}\n\t\t}\n\t}\n\n\tsend(message: StateMessage): void {\n\t\tif (this.ws?.readyState === WebSocket.OPEN) {\n\t\t\tthis.ws.send(JSON.stringify(message));\n\t\t} else {\n\t\t\tthis.messageQueue.push(message);\n\t\t}\n\t}\n\n\tsendWithResponse<T>(message: StateMessage): Promise<T> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst id = `req_${++this.requestId}`;\n\t\t\tmessage.data = { ...message.data, _requestId: id };\n\n\t\t\tthis.pendingRequests.set(id, {\n\t\t\t\tresolve: resolve as (value: unknown) => void,\n\t\t\t\treject\n\t\t\t});\n\n\t\t\tthis.send(message);\n\n\t\t\t// Timeout after 30 seconds\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (this.pendingRequests.has(id)) {\n\t\t\t\t\tthis.pendingRequests.delete(id);\n\t\t\t\t\treject(new Error('Request timeout'));\n\t\t\t\t}\n\t\t\t}, 30000);\n\t\t});\n\t}\n\n\tprivate handleMessage(data: string): void {\n\t\ttry {\n\t\t\tconst message = JSON.parse(data) as StateMessage;\n\n\t\t\t// Handle pong\n\t\t\tif (message.type === 'pong') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Handle response to pending request\n\t\t\tif (message.data?._responseId) {\n\t\t\t\tconst id = message.data._responseId as string;\n\t\t\t\tconst pending = this.pendingRequests.get(id);\n\t\t\t\tif (pending) {\n\t\t\t\t\tthis.pendingRequests.delete(id);\n\t\t\t\t\tif (message.type === 'error') {\n\t\t\t\t\t\tpending.reject(new Error(message.error || 'Unknown error'));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpending.resolve(message.data);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.config.onMessage(message);\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to parse WebSocket message:', error);\n\t\t}\n\t}\n\n\t// Sync global state request\n\trequestSync(): void {\n\t\tthis.send({ type: 'sync' });\n\t}\n\n\t// Request state from server\n\trequestState(componentId: string): Promise<Record<string, unknown>> {\n\t\treturn this.sendWithResponse({\n\t\t\ttype: 'init',\n\t\t\tcomponentId\n\t\t});\n\t}\n}\n\n// Singleton instance\nlet clientInstance: WSClient | null = null;\n\nexport function getWebSocketClient(): WSClient | null {\n\treturn clientInstance;\n}\n\nexport function initWebSocket(config: WebSocketConfig): WSClient {\n\tif (clientInstance) {\n\t\tclientInstance.disconnect();\n\t}\n\tclientInstance = new WSClient(config);\n\treturn clientInstance;\n}\n\n// State synchronization helper\nexport interface SyncedStateOptions {\n\tcomponentId: string;\n\tkey: string;\n\tws?: WSClient;\n\tdebounce?: number;\n}\n\nexport function syncedRune<T>(\n\tinitial: T,\n\toptions: SyncedStateOptions\n): Rune<T> {\n\tconst rune = new Rune<T>(initial);\n\tconst ws = options.ws || clientInstance;\n\n\tlet isReverting = false;\n\tconst originalSet = rune.set.bind(rune);\n\n\trune.set = (newValue: T) => {\n\t\tif (isReverting) {\n\t\t\toriginalSet(newValue);\n\t\t\treturn;\n\t\t}\n\n\t\t// Optimistic UI Rollback: capture the previous verified state\n\t\tconst backupValue = rune.get();\n\t\toriginalSet(newValue);\n\n\t\tif (ws?.isConnected) {\n\t\t\ttry {\n\t\t\t\t// We wrap it in a setTimeout for the debounce if needed\n\t\t\t\tconst executeSync = () => {\n\t\t\t\t\tws.send({\n\t\t\t\t\t\ttype: 'update',\n\t\t\t\t\t\tpayload: { key: options.key, value: newValue }\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tif (options.debounce) {\n\t\t\t\t\t// NOTE: with debounce, rollback might get complicated if multiple sets occur,\n\t\t\t\t\t// but for this implementation we assume the standard Optimistic fire-and-forget.\n\t\t\t\t\tsetTimeout(executeSync, options.debounce);\n\t\t\t\t} else {\n\t\t\t\t\texecuteSync();\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('[GoSPA] Optimistic update failed, rolling back.', e);\n\t\t\t\tisReverting = true;\n\t\t\t\toriginalSet(backupValue);\n\t\t\t\tisReverting = false;\n\t\t\t}\n\t\t} else {\n\t\t\t// Not connected, revert immediately\n\t\t\tconsole.warn('[GoSPA] WS disconnected, optimistic update rolled back.');\n\t\t\tisReverting = true;\n\t\t\toriginalSet(backupValue);\n\t\t\tisReverting = false;\n\t\t}\n\t};\n\n\treturn rune;\n}\n\n// Batch sync multiple state values\nexport function syncBatch(\n\tcomponentId: string,\n\tstates: Record<string, Rune<unknown>>,\n\tws?: WSClient\n): void {\n\tconst client = ws || clientInstance;\n\tif (!client?.isConnected) return;\n\n\tfor (const [key, rune] of Object.entries(states)) {\n\t\tclient.send({\n\t\t\ttype: 'update',\n\t\t\tpayload: { key, value: rune.get() }\n\t\t});\n\t}\n}\n\n// Apply server state updates\nexport function applyStateUpdate(\n\tstates: Record<string, Rune<unknown>>,\n\tdata: Record<string, unknown>\n): void {\n\tbatch(() => {\n\t\tfor (const [key, value] of Object.entries(data)) {\n\t\t\tconst rune = states[key];\n\t\t\tif (rune) {\n\t\t\t\trune.set(value);\n\t\t\t}\n\t\t}\n\t});\n}\n",
    "// GoSPA Client-side Navigation\n// Enables SPA-style navigation without full page reloads\n\n// Navigation state\nconst state = {\n\tcurrentPath: window.location.pathname,\n\tisNavigating: false,\n\tpendingNavigation: null as Promise<boolean> | null,\n};\n\n// Navigation options\nexport interface NavigationOptions {\n\treplace?: boolean;\n\tscrollToTop?: boolean;\n\tpreserveState?: boolean;\n}\n\n// Navigation event handlers\ntype NavigationCallback = (path: string) => void;\nconst beforeNavCallbacks: Set<NavigationCallback> = new Set();\nconst afterNavCallbacks: Set<NavigationCallback> = new Set();\n\n// Register callbacks\nexport function onBeforeNavigate(cb: NavigationCallback): () => void {\n\tbeforeNavCallbacks.add(cb);\n\treturn () => beforeNavCallbacks.delete(cb);\n}\n\nexport function onAfterNavigate(cb: NavigationCallback): () => void {\n\tafterNavCallbacks.add(cb);\n\treturn () => afterNavCallbacks.delete(cb);\n}\n\n// Check if a link is internal (same origin)\nfunction isInternalLink(link: HTMLAnchorElement): boolean {\n\tconst href = link.getAttribute('href');\n\tif (!href || href.startsWith('#') || href.startsWith('javascript:')) {\n\t\treturn false;\n\t}\n\t\n\t// Check for external links\n\tif (href.startsWith('http://') || href.startsWith('https://') || href.startsWith('//')) {\n\t\ttry {\n\t\t\tconst url = new URL(href, window.location.origin);\n\t\t\treturn url.origin === window.location.origin;\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t}\n\t\n\t// Check for special attributes that disable SPA nav\n\tif (link.hasAttribute('data-external') || \n\t\tlink.hasAttribute('download') || \n\t\tlink.getAttribute('target') === '_blank') {\n\t\treturn false;\n\t}\n\t\n\treturn true;\n}\n\n// Page data type\ninterface PageData {\n\tcontent: string;\n\ttitle: string;\n\thead: string;\n}\n\n// Prefetch cache\nconst prefetchCache = new Map<string, PageData>();\n\n// Fetch page content from server\nasync function fetchPageFromServer(path: string): Promise<PageData | null> {\n\ttry {\n\t\tconst response = await fetch(path, {\n\t\t\theaders: {\n\t\t\t\t'X-Requested-With': 'GoSPA-Navigate',\n\t\t\t\t'Accept': 'text/html',\n\t\t\t},\n\t\t});\n\t\t\n\t\tif (!response.ok) {\n\t\t\tconsole.error('[GoSPA] Navigation failed:', response.status);\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tconst html = await response.text();\n\t\t\n\t\t// Parse the HTML response\n\t\tconst parser = new DOMParser();\n\t\tconst doc = parser.parseFromString(html, 'text/html');\n\t\t\n\t\t// Extract content from main element or body\n\t\tconst mainEl = doc.querySelector('main');\n\t\tconst content = mainEl ? mainEl.innerHTML : doc.body.innerHTML;\n\t\t\n\t\t// Extract title\n\t\tconst title = doc.querySelector('title')?.textContent || '';\n\t\t\n\t\t// Extract head elements (for head management)\n\t\tconst headEl = doc.querySelector('head');\n\t\tconst head = headEl ? headEl.innerHTML : '';\n\t\t\n\t\treturn { content, title, head };\n\t} catch (error) {\n\t\tconsole.error('[GoSPA] Navigation error:', error);\n\t\treturn null;\n\t}\n}\n\n// Get page data (from cache or server)\nasync function getPageData(path: string): Promise<PageData | null> {\n\tconst cached = prefetchCache.get(path);\n\tif (cached) {\n\t\tprefetchCache.delete(path);\n\t\treturn cached;\n\t}\n\treturn fetchPageFromServer(path);\n}\n\n// Update the DOM with new content\nfunction updateDOM(data: PageData): void {\n\t// Update title\n\tif (data.title) {\n\t\tdocument.title = data.title;\n\t}\n\t\n\t// Update main content\n\tconst mainEl = document.querySelector('main');\n\tif (mainEl) {\n\t\tmainEl.innerHTML = data.content;\n\t} else {\n\t\t// Fallback: replace body content\n\t\tdocument.body.innerHTML = data.content;\n\t}\n\t\n\t// Update head (managed head elements)\n\tupdateHead(data.head);\n\t\n\t// Re-initialize runtime for new content\n\tinitNewContent();\n}\n\n// Update head elements\nfunction updateHead(headHtml: string): void {\n\t// Parse head HTML to extract elements\n\tconst parser = new DOMParser();\n\tconst doc = parser.parseFromString(`<html><head>${headHtml}</head></html>`, 'text/html');\n\tconst newHead = doc.querySelector('head');\n\t\n\tif (!newHead) return;\n\t\n\t// Get elements with data-gospa-head attribute (managed by GoSPA)\n\tconst managedElements = document.head.querySelectorAll('[data-gospa-head]');\n\t\n\t// Remove old managed elements\n\tmanagedElements.forEach(el => el.remove());\n\t\n\t// Add new managed elements\n\tnewHead.querySelectorAll('title, meta, link, style, script').forEach(el => {\n\t\t// Skip certain elements\n\t\tif (el.tagName === 'SCRIPT' && !el.hasAttribute('data-gospa-head')) {\n\t\t\treturn; // Don't auto-inject scripts unless marked\n\t\t}\n\t\t\n\t\t// Mark as managed\n\t\tel.setAttribute('data-gospa-head', 'true');\n\t\t\n\t\t// Clone and append\n\t\tdocument.head.appendChild(el.cloneNode(true));\n\t});\n}\n\n// Initialize new content (re-run runtime setup)\nfunction initNewContent(): void {\n\t// Re-setup event handlers and bindings for new DOM content\n\tconst eventElements = document.querySelectorAll('[data-on]');\n\tconst boundElements = document.querySelectorAll('[data-bind]');\n\t\n\t// Get WebSocket from global context\n\tconst gospa = (window as any).__gospa__;\n\tconst ws = gospa?._ws;\n\t\n\t// Setup event handlers\n\teventElements.forEach((element) => {\n\t\tconst attr = element.getAttribute('data-on');\n\t\tif (!attr) return;\n\t\t\n\t\tconst [eventType, action] = attr.split(':');\n\t\tif (!eventType || !action) return;\n\t\t\n\t\t// Remove old listener if any (using clone technique)\n\t\tconst newElement = element.cloneNode(true) as Element;\n\t\telement.parentNode?.replaceChild(newElement, element);\n\t\t\n\t\tnewElement.addEventListener(eventType, () => {\n\t\t\tif (ws && ws.readyState === WebSocket.OPEN) {\n\t\t\t\tws.send(JSON.stringify({ action }));\n\t\t\t}\n\t\t});\n\t});\n\t\n\t// Setup bindings\n\tboundElements.forEach((element) => {\n\t\tconst attr = element.getAttribute('data-bind');\n\t\tif (!attr) return;\n\t\t\n\t\tconst [bindingType, stateKey] = attr.split(':');\n\t\tif (!bindingType || !stateKey) return;\n\t\t\n\t\tconst rune = gospa?.state?.get(stateKey);\n\t\tif (!rune) return;\n\t\t\n\t\t// Bind element to rune\n\t\tconst update = (value: any) => {\n\t\t\tswitch (bindingType) {\n\t\t\t\tcase 'text':\n\t\t\t\t\telement.textContent = value;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'html':\n\t\t\t\t\telement.innerHTML = value;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'value':\n\t\t\t\t\t(element as HTMLInputElement).value = value;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'checked':\n\t\t\t\t\t(element as HTMLInputElement).checked = value;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'show':\n\t\t\t\t\t(element as HTMLElement).style.display = value ? '' : 'none';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\t\t\n\t\tupdate(rune.get());\n\t\trune.subscribe(update);\n\t});\n}\n\n// Navigate to a new path\nexport async function navigate(path: string, options: NavigationOptions = {}): Promise<boolean> {\n\t// Don't navigate if already at this path\n\tif (path === state.currentPath && !options.replace) {\n\t\treturn false;\n\t}\n\t\n\t// Wait for any pending navigation\n\tif (state.pendingNavigation) {\n\t\tawait state.pendingNavigation;\n\t}\n\t\n\tstate.isNavigating = true;\n\t\n\t// Notify before navigation\n\tbeforeNavCallbacks.forEach(cb => cb(path));\n\t\n\ttry {\n\t\tstate.pendingNavigation = (async () => {\n\t\t\tconst data = await getPageData(path);\n\t\t\t\n\t\t\tif (!data) {\n\t\t\t\t// Fallback to full page load\n\t\t\t\twindow.location.href = path;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t// Update browser history\n\t\t\tif (options.replace) {\n\t\t\t\twindow.history.replaceState({ path }, '', path);\n\t\t\t} else {\n\t\t\t\twindow.history.pushState({ path }, '', path);\n\t\t\t}\n\t\t\t\n\t\t\t// Update state\n\t\t\tstate.currentPath = path;\n\t\t\t\n\t\t\t// Update DOM\n\t\t\tupdateDOM(data);\n\t\t\t\n\t\t\t// Scroll to top if requested\n\t\t\tif (options.scrollToTop !== false) {\n\t\t\t\twindow.scrollTo(0, 0);\n\t\t\t}\n\t\t\t\n\t\t\t// Notify after navigation\n\t\t\tafterNavCallbacks.forEach(cb => cb(path));\n\t\t\t\n\t\t\treturn true;\n\t\t})();\n\t\t\n\t\treturn await state.pendingNavigation;\n\t} finally {\n\t\tstate.isNavigating = false;\n\t\tstate.pendingNavigation = null;\n\t}\n}\n\n// Go back in history\nexport function back(): void {\n\twindow.history.back();\n}\n\n// Go forward in history\nexport function forward(): void {\n\twindow.history.forward();\n}\n\n// Go to specific position in history\nexport function go(delta: number): void {\n\twindow.history.go(delta);\n}\n\n// Get current path\nexport function getCurrentPath(): string {\n\treturn state.currentPath;\n}\n\n// Check if currently navigating\nexport function isNavigating(): boolean {\n\treturn state.isNavigating;\n}\n\n// Handle popstate (back/forward button)\nfunction handlePopState(event: PopStateEvent): void {\n\tconst path = window.location.pathname;\n\t\n\t// Notify before navigation\n\tbeforeNavCallbacks.forEach(cb => cb(path));\n\t\n\t// Fetch and update\n\tgetPageData(path).then(data => {\n\t\tif (data) {\n\t\t\tstate.currentPath = path;\n\t\t\tupdateDOM(data);\n\t\t\tafterNavCallbacks.forEach(cb => cb(path));\n\t\t} else {\n\t\t\t// Fallback to reload\n\t\t\twindow.location.reload();\n\t\t}\n\t});\n}\n\n// Handle link clicks\nfunction handleLinkClick(event: MouseEvent): void {\n\t// Only handle left clicks without modifiers\n\tif (event.button !== 0 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) {\n\t\treturn;\n\t}\n\t\n\t// Find the closest anchor element\n\tconst target = event.target as Element;\n\tconst link = target.closest('a[href]');\n\t\n\tif (!link) return;\n\t\n\t// Check if it's an internal link\n\tif (!isInternalLink(link as HTMLAnchorElement)) {\n\t\treturn;\n\t}\n\t\n\t// Prevent default navigation\n\tevent.preventDefault();\n\t\n\t// Get the href\n\tconst href = link.getAttribute('href');\n\tif (!href) return;\n\t\n\t// Navigate\n\tnavigate(href);\n}\n\n// Initialize navigation\nexport function initNavigation(): void {\n\t// Setup link click handler\n\tdocument.addEventListener('click', handleLinkClick);\n\t\n\t// Setup popstate handler\n\twindow.addEventListener('popstate', handlePopState);\n\t\n\t// Mark as SPA-enabled\n\tdocument.documentElement.setAttribute('data-gospa-spa', 'true');\n\t\n\tconsole.log('[GoSPA] SPA navigation initialized');\n}\n\n// Cleanup navigation\nexport function destroyNavigation(): void {\n\tdocument.removeEventListener('click', handleLinkClick);\n\twindow.removeEventListener('popstate', handlePopState);\n\tdocument.documentElement.removeAttribute('data-gospa-spa');\n}\n\n// Prefetch a page for faster navigation\nexport async function prefetch(path: string): Promise<void> {\n\tif (prefetchCache.has(path)) return;\n\t\n\tconst data = await fetchPageFromServer(path);\n\tif (data) {\n\t\tprefetchCache.set(path, data);\n\t\t\n\t\t// Clean up cache after 30 seconds\n\t\tsetTimeout(() => prefetchCache.delete(path), 30000);\n\t}\n}\n\n// Export navigation state as reactive\nexport function createNavigationState() {\n\treturn {\n\t\tget path() {\n\t\t\treturn state.currentPath;\n\t\t},\n\t\tget isNavigating() {\n\t\t\treturn state.isNavigating;\n\t\t},\n\t\tnavigate,\n\t\tback,\n\t\tforward,\n\t\tgo,\n\t\tprefetch,\n\t};\n}\n\n// Auto-initialize when DOM is ready\nif (typeof document !== 'undefined') {\n\tif (document.readyState === 'loading') {\n\t\tdocument.addEventListener('DOMContentLoaded', initNavigation);\n\t} else {\n\t\tinitNavigation();\n\t}\n}\n\n// Extend window type\ndeclare global {\n\tinterface Window {\n\t\t__gospa__?: {\n\t\t\tstate: Map<string, any>;\n\t\t\t_ws?: WebSocket;\n\t\t};\n\t}\n}\n",
    "// GoSPA Transition Engine\n// Provides Svelte-like enter/leave animations\n\nexport interface TransitionConfig {\n    delay?: number;\n    duration?: number;\n    easing?: string;\n    css?: (t: number, u: number) => string;\n    tick?: (t: number, u: number) => void;\n}\n\nexport type TransitionFn = (node: Element, params: any) => TransitionConfig;\n\nexport const linear = (t: number) => t;\nexport const cubicOut = (t: number) => {\n    const f = t - 1.0;\n    return f * f * f + 1.0;\n};\nexport const cubicInOut = (t: number) => {\n    return t < 0.5 ? 4.0 * t * t * t : 0.5 * Math.pow(2.0 * t - 2.0, 3.0) + 1.0;\n};\n\n// Built-in transitions\nexport function fade(node: Element, { delay = 0, duration = 400, easing = linear } = {}): TransitionConfig {\n    const o = +getComputedStyle(node).opacity;\n    return {\n        delay,\n        duration,\n        easing: 'linear', // we map the easing function mechanically in JS or via CSS\n        css: (t) => `opacity: ${t * o}`\n    };\n}\n\nexport function fly(node: Element, { delay = 0, duration = 400, easing = cubicOut, x = 0, y = 0, opacity = 0 } = {}): TransitionConfig {\n    const style = getComputedStyle(node);\n    const targetOpacity = +style.opacity;\n    const transform = style.transform === 'none' ? '' : style.transform;\n\n    return {\n        delay,\n        duration,\n        easing: 'ease-out',\n        css: (t, u) => `\n\t\t\ttransform: ${transform} translate(${(1 - t) * x}px, ${(1 - t) * y}px);\n\t\t\topacity: ${targetOpacity - (targetOpacity - opacity) * u}\n\t\t`\n    };\n}\n\nexport function slide(node: Element, { delay = 0, duration = 400, easing = cubicOut } = {}): TransitionConfig {\n    const style = getComputedStyle(node);\n    const opacity = +style.opacity;\n    const height = parseFloat(style.height);\n    const paddingTop = parseFloat(style.paddingTop);\n    const paddingBottom = parseFloat(style.paddingBottom);\n    const marginTop = parseFloat(style.marginTop);\n    const marginBottom = parseFloat(style.marginBottom);\n    const borderTopWidth = parseFloat(style.borderTopWidth);\n    const borderBottomWidth = parseFloat(style.borderBottomWidth);\n\n    return {\n        delay,\n        duration,\n        easing: 'ease-out',\n        css: (t) => `\n\t\t\toverflow: hidden;\n\t\t\topacity: ${Math.min(t * 20, 1) * opacity};\n\t\t\theight: ${t * height}px;\n\t\t\tpadding-top: ${t * paddingTop}px;\n\t\t\tpadding-bottom: ${t * paddingBottom}px;\n\t\t\tmargin-top: ${t * marginTop}px;\n\t\t\tmargin-bottom: ${t * marginBottom}px;\n\t\t\tborder-top-width: ${t * borderTopWidth}px;\n\t\t\tborder-bottom-width: ${t * borderBottomWidth}px;\n\t\t`\n    };\n}\n\nconst activeTransitions = new Set<Element>();\n\n// Apply an enter transition\nexport function transitionIn(node: HTMLElement, fn: TransitionFn, params: any) {\n    if (activeTransitions.has(node)) return;\n    activeTransitions.add(node);\n\n    const config = fn(node, params);\n    const duration = config.duration || 400;\n    const delay = config.delay || 0;\n    const css = config.css || (() => '');\n\n    const originalStyle = node.getAttribute('style') || '';\n\n    // Pre-calculate frames (simple CSS keyframes approach)\n    const name = `gospa-transition-${Math.random().toString(36).substring(2, 9)}`;\n    const keyframes = `\n\t\t@keyframes ${name} {\n\t\t\t0% { ${css(0, 1)} }\n\t\t\t100% { ${css(1, 0)} }\n\t\t}\n\t`;\n\n    const styleSheet = document.createElement('style');\n    styleSheet.textContent = keyframes;\n    document.head.appendChild(styleSheet);\n\n    node.style.animation = `${name} ${duration}ms ${config.easing || 'linear'} ${delay}ms both`;\n\n    setTimeout(() => {\n        node.setAttribute('style', originalStyle);\n        node.style.animation = '';\n        styleSheet.remove();\n        activeTransitions.delete(node);\n    }, duration + delay);\n}\n\n// Apply a leave transition\nexport function transitionOut(node: HTMLElement, fn: TransitionFn, params: any, onComplete: () => void) {\n    if (activeTransitions.has(node)) return;\n    activeTransitions.add(node);\n\n    const config = fn(node, params);\n    const duration = config.duration || 400;\n    const delay = config.delay || 0;\n    const css = config.css || (() => '');\n\n    const name = `gospa-transition-${Math.random().toString(36).substring(2, 9)}`;\n    const keyframes = `\n\t\t@keyframes ${name} {\n\t\t\t0% { ${css(1, 0)} }\n\t\t\t100% { ${css(0, 1)} }\n\t\t}\n\t`;\n\n    const styleSheet = document.createElement('style');\n    styleSheet.textContent = keyframes;\n    document.head.appendChild(styleSheet);\n\n    node.style.animation = `${name} ${duration}ms ${config.easing || 'linear'} ${delay}ms both`;\n\n    setTimeout(() => {\n        styleSheet.remove();\n        activeTransitions.delete(node);\n        onComplete();\n    }, duration + delay);\n}\n\n// Setup automated transitions using attributes like data-transition=\"fade\"\nexport function setupTransitions(root: Element = document.body) {\n    const observer = new MutationObserver((mutations) => {\n        mutations.forEach(mutation => {\n            if (mutation.type === 'childList') {\n                // Handle added nodes\n                mutation.addedNodes.forEach(node => {\n                    if (node.nodeType === Node.ELEMENT_NODE) {\n                        const el = node as HTMLElement;\n                        if (el.closest('[data-gospa-static]')) return;\n                        const transitionType = el.getAttribute('data-transition-in') || el.getAttribute('data-transition');\n                        if (transitionType) {\n                            const fn = getTransitionFn(transitionType);\n                            if (fn) transitionIn(el, fn, getTransitionParams(el));\n                        }\n                    }\n                });\n\n                // Handle removed nodes (requires some DOM trickery to delay true removal)\n                mutation.removedNodes.forEach(node => {\n                    if (node.nodeType === Node.ELEMENT_NODE) {\n                        const el = node as HTMLElement;\n                        if (el.closest('[data-gospa-static]')) return;\n\n                        const transitionType = el.getAttribute('data-transition-out') || el.getAttribute('data-transition');\n                        if (transitionType) {\n                            const fn = getTransitionFn(transitionType);\n                            if (fn && !activeTransitions.has(el)) {\n                                // We have to temporarily put it back in the DOM to animate it out\n                                const clone = el.cloneNode(true) as HTMLElement;\n\n                                // Clean up clone to prevent rogue bindings\n                                clone.querySelectorAll('[data-bind]').forEach(n => n.removeAttribute('data-bind'));\n                                clone.removeAttribute('data-bind');\n\n                                if (mutation.previousSibling && mutation.previousSibling.parentNode) {\n                                    mutation.previousSibling.parentNode.insertBefore(clone, mutation.previousSibling.nextSibling);\n                                } else if (mutation.target) {\n                                    mutation.target.appendChild(clone);\n                                }\n\n                                transitionOut(clone, fn, getTransitionParams(el), () => clone.remove());\n                            }\n                        }\n                    }\n                });\n            }\n        });\n    });\n\n    observer.observe(root, { childList: true, subtree: true });\n}\n\nfunction getTransitionFn(name: string): TransitionFn | null {\n    if (name.startsWith('fade')) return fade;\n    if (name.startsWith('fly')) return fly;\n    if (name.startsWith('slide')) return slide;\n    return null;\n}\n\nfunction getTransitionParams(node: Element): any {\n    const paramStr = node.getAttribute('data-transition-params');\n    if (!paramStr) return {};\n    try {\n        return JSON.parse(paramStr);\n    } catch (e) {\n        console.warn('Invalid transition parameters:', paramStr);\n        return {};\n    }\n}\n",
    "// GoSPA Client Runtime - Main entry point\n// A lightweight runtime for reactive SPAs with Go/Fiber/Templ\n\nimport { Rune, Derived, Effect, StateMap, batch, effect, watch, type Unsubscribe } from './state.ts';\nimport { bindElement, bindTwoWay, renderIf, renderList, registerBinding, unregisterBinding } from './dom.ts';\nimport { on, offAll, debounce, throttle, delegate, onKey, keys, transformers } from './events.ts';\nimport { WSClient, initWebSocket, getWebSocketClient, syncedRune, applyStateUpdate, type StateMessage } from './websocket.ts';\nimport {\n\tnavigate,\n\tback,\n\tforward,\n\tgo,\n\tprefetch,\n\tgetCurrentPath,\n\tisNavigating,\n\tonBeforeNavigate,\n\tonAfterNavigate,\n\tinitNavigation,\n\tdestroyNavigation,\n\tcreateNavigationState,\n\ttype NavigationOptions\n} from './navigation.ts';\nimport { setupTransitions, fade, fly, slide } from './transition.ts';\n\n// Component definition\nexport interface ComponentDefinition {\n\tid: string;\n\tname: string;\n\tstate: Record<string, unknown>;\n\tactions?: Record<string, (...args: unknown[]) => unknown>;\n\tcomputed?: Record<string, () => unknown>;\n\twatch?: Record<string, (value: unknown, oldValue: unknown) => void>;\n\tmount?: () => void | (() => void);\n\tdestroy?: () => void;\n}\n\n// Component instance\nexport interface ComponentInstance {\n\tid: string;\n\tdefinition: ComponentDefinition;\n\tstates: StateMap;\n\tderived: Map<string, Derived<unknown>>;\n\tunsubscribers: Unsubscribe[];\n\tcleanup: (() => void)[];\n\telement: Element | null;\n}\n\n// Runtime configuration\nexport interface RuntimeConfig {\n\twsUrl?: string;\n\tdebug?: boolean;\n\tperformance?: boolean;\n}\n\n// Global component registry\nconst components = new Map<string, ComponentInstance>();\nconst globalState = new StateMap();\n\n// Runtime state\nlet isInitialized = false;\nlet config: RuntimeConfig = {};\n\n// Initialize runtime\nexport function init(options: RuntimeConfig = {}): void {\n\tif (isInitialized) {\n\t\tconsole.warn('GoSPA runtime already initialized');\n\t\treturn;\n\t}\n\n\tconfig = options;\n\tisInitialized = true;\n\n\t// Global transition engine via MutationObserver\n\tsetupTransitions();\n\n\t// Initialize WebSocket if URL provided\n\tif (config.wsUrl) {\n\t\tconst ws = initWebSocket({\n\t\t\turl: config.wsUrl,\n\t\t\tonMessage: handleServerMessage\n\t\t});\n\t\tws.connect().catch(err => {\n\t\t\tif (config.debug) {\n\t\t\t\tconsole.error('WebSocket connection failed:', err);\n\t\t\t}\n\t\t});\n\t}\n\n\t// Set up global error handler\n\twindow.addEventListener('error', (event) => {\n\t\tif (config.debug) {\n\t\t\tconsole.error('Runtime error:', event.error);\n\t\t}\n\t});\n\n\tif (config.debug) {\n\t\tconsole.log('GoSPA runtime initialized');\n\t}\n}\n\n// Handle messages from server\nfunction handleServerMessage(message: StateMessage): void {\n\tswitch (message.type) {\n\t\tcase 'init':\n\t\t\tif (message.componentId && message.data) {\n\t\t\t\tconst component = components.get(message.componentId);\n\t\t\t\tif (component) {\n\t\t\t\t\tcomponent.states.fromJSON(message.data);\n\t\t\t\t}\n\t\t\t} else if (message.state) {\n\t\t\t\t// Global state HMR from server - iterate through components and apply updates based on keys\n\t\t\t\tfor (const component of components.values()) {\n\t\t\t\t\tfor (const [key, value] of Object.entries(message.state)) {\n\t\t\t\t\t\tif (component.states.get(key) !== undefined) {\n\t\t\t\t\t\t\tcomponent.states.set(key, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tglobalState.fromJSON(message.state);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'update':\n\t\t\tif (message.componentId && message.diff) {\n\t\t\t\tconst component = components.get(message.componentId);\n\t\t\t\tif (component) {\n\t\t\t\t\tcomponent.states.fromJSON(message.diff);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'sync':\n\t\t\t// Full state sync\n\t\t\tif (message.data) {\n\t\t\t\tglobalState.fromJSON(message.data);\n\t\t\t} else if ((message as any).key !== undefined && (message as any).value !== undefined) {\n\t\t\t\t// Partial sync from server broadcast\n\t\t\t\tfor (const component of components.values()) {\n\t\t\t\t\tif (component.states.get((message as any).key) !== undefined) {\n\t\t\t\t\t\tcomponent.states.set((message as any).key, (message as any).value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'error':\n\t\t\tif (config.debug) {\n\t\t\t\tconsole.error('Server error:', message.error);\n\t\t\t}\n\t\t\tbreak;\n\t}\n}\n\n// Create component instance\nexport function createComponent(def: ComponentDefinition, element?: Element): ComponentInstance {\n\tconst instance: ComponentInstance = {\n\t\tid: def.id,\n\t\tdefinition: def,\n\t\tstates: new StateMap(),\n\t\tderived: new Map(),\n\t\tunsubscribers: [],\n\t\tcleanup: [],\n\t\telement: element || null\n\t};\n\n\t// Initialize state\n\tfor (const [key, value] of Object.entries(def.state)) {\n\t\tinstance.states.set(key, value);\n\t}\n\n\t// Initialize computed properties\n\tif (def.computed) {\n\t\tfor (const [key, compute] of Object.entries(def.computed)) {\n\t\t\tconst derivedVal = new Derived(compute);\n\t\t\tinstance.derived.set(key, derivedVal);\n\t\t}\n\t}\n\n\t// Initialize watchers\n\tif (def.watch) {\n\t\tfor (const [key, callback] of Object.entries(def.watch)) {\n\t\t\tconst state = instance.states.get(key);\n\t\t\tif (state) {\n\t\t\t\tconst unsub = watch(state, callback);\n\t\t\t\tinstance.unsubscribers.push(unsub);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Call mount hook\n\tif (def.mount) {\n\t\tconst cleanup = def.mount();\n\t\tif (cleanup) {\n\t\t\tinstance.cleanup.push(cleanup);\n\t\t}\n\t}\n\n\tcomponents.set(def.id, instance);\n\n\tif (config.debug) {\n\t\tconsole.log(`Component \"${def.name}\" created with id \"${def.id}\"`);\n\t}\n\n\treturn instance;\n}\n\n// Destroy component instance\nexport function destroyComponent(id: string): void {\n\tconst instance = components.get(id);\n\tif (!instance) return;\n\n\t// Call destroy hook\n\tif (instance.definition.destroy) {\n\t\tinstance.definition.destroy();\n\t}\n\n\t// Run cleanup functions\n\tfor (const cleanup of instance.cleanup) {\n\t\tcleanup();\n\t}\n\n\t// Run unsubscribers\n\tfor (const unsub of instance.unsubscribers) {\n\t\tunsub();\n\t}\n\n\t// Dispose derived\n\tfor (const derivedVal of instance.derived.values()) {\n\t\tderivedVal.dispose();\n\t}\n\n\t// Remove from registry\n\tcomponents.delete(id);\n\n\tif (config.debug) {\n\t\tconsole.log(`Component \"${id}\" destroyed`);\n\t}\n}\n\n// Get component instance\nexport function getComponent(id: string): ComponentInstance | undefined {\n\treturn components.get(id);\n}\n\n// Get state from component\nexport function getState(componentId: string, key: string): Rune<unknown> | undefined {\n\tconst component = components.get(componentId);\n\treturn component?.states.get(key);\n}\n\n// Set state value\nexport function setState(componentId: string, key: string, value: unknown): void {\n\tconst component = components.get(componentId);\n\tif (component) {\n\t\tcomponent.states.set(key, value);\n\t}\n}\n\n// Call component action\nexport function callAction(componentId: string, action: string, ...args: unknown[]): unknown {\n\tconst component = components.get(componentId);\n\tif (!component || !component.definition.actions) {\n\t\tthrow new Error(`Action \"${action}\" not found on component \"${componentId}\"`);\n\t}\n\n\tconst fn = component.definition.actions[action];\n\tif (!fn) {\n\t\tthrow new Error(`Action \"${action}\" not found on component \"${componentId}\"`);\n\t}\n\n\treturn fn(...args);\n}\n\n// Bind element to state\nexport function bind(\n\tcomponentId: string,\n\telement: Element,\n\tbinding: string,\n\tkey: string,\n\toptions?: { twoWay?: boolean; event?: string }\n): () => void {\n\tconst state = getState(componentId, key);\n\tif (!state) {\n\t\tconsole.warn(`State \"${key}\" not found on component \"${componentId}\"`);\n\t\treturn () => { };\n\t}\n\n\tif (options?.twoWay) {\n\t\treturn bindTwoWay(\n\t\t\telement as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement,\n\t\t\tstate as Rune<string | number | boolean>\n\t\t);\n\t}\n\n\treturn bindElement(element, state as Rune<unknown>, { type: binding as 'text' | 'html' | 'value' | 'checked' | 'class' | 'style' | 'attr' | 'prop' });\n}\n\n// Auto-initialize from DOM\nexport function autoInit(): void {\n\t// Find all components with data-gospa-component attribute\n\tconst elements = document.querySelectorAll('[data-gospa-component]');\n\n\tfor (const element of elements) {\n\t\tconst id = element.getAttribute('data-gospa-component');\n\t\tconst stateJson = element.getAttribute('data-gospa-state');\n\n\t\tif (!id) continue;\n\n\t\tconst state = stateJson ? JSON.parse(stateJson) : {};\n\n\t\tcreateComponent({\n\t\t\tid,\n\t\t\tname: id,\n\t\t\tstate\n\t\t}, element);\n\t}\n\n\t// Set up bindings\n\tsetupBindings();\n}\n\n// Set up reactive bindings from DOM attributes\nfunction setupBindings(): void {\n\t// Find all elements with data-bind attribute\n\tconst boundElements = document.querySelectorAll('[data-bind]');\n\n\tfor (const element of boundElements) {\n\t\tconst componentId = element.closest('[data-gospa-component]')?.getAttribute('data-gospa-component');\n\t\tif (!componentId) continue;\n\n\t\tconst bindingSpec = element.getAttribute('data-bind');\n\t\tif (!bindingSpec) continue;\n\n\t\t// Parse binding spec: \"key:binding\" or \"key\" (defaults to text)\n\t\tconst [key, binding = 'text'] = bindingSpec.split(':').map(s => s.trim());\n\n\t\tbind(componentId, element, binding, key);\n\t}\n\n\t// Find all elements with data-on attribute (event handlers)\n\tconst eventElements = document.querySelectorAll('[data-on]');\n\n\tfor (const element of eventElements) {\n\t\tconst componentId = element.closest('[data-gospa-component]')?.getAttribute('data-gospa-component');\n\t\tif (!componentId) continue;\n\n\t\tconst eventSpec = element.getAttribute('data-on');\n\t\tif (!eventSpec) continue;\n\n\t\t// Parse event spec: \"event:action\" or \"event:action:arg1,arg2\"\n\t\tconst [event, action, argsStr] = eventSpec.split(':').map(s => s.trim());\n\t\tconst args = argsStr ? argsStr.split(',').map(s => s.trim()) : [];\n\n\t\ton(element, event, () => {\n\t\t\tcallAction(componentId, action, ...args);\n\t\t});\n\t}\n\n\t// Find all elements with data-model attribute (two-way binding)\n\tconst modelElements = document.querySelectorAll('[data-model]');\n\n\tfor (const element of modelElements) {\n\t\tconst componentId = element.closest('[data-gospa-component]')?.getAttribute('data-gospa-component');\n\t\tif (!componentId) continue;\n\n\t\tconst key = element.getAttribute('data-model');\n\t\tif (!key) continue;\n\n\t\tbind(componentId, element, 'value', key, { twoWay: true });\n\t}\n}\n\n// Export all public APIs\nexport {\n\t// State\n\tRune,\n\tDerived,\n\tEffect,\n\tStateMap,\n\tbatch,\n\teffect,\n\twatch,\n\n\t// DOM\n\tbindElement,\n\tbindTwoWay,\n\trenderIf,\n\trenderList,\n\tregisterBinding,\n\tunregisterBinding,\n\n\t// Events\n\ton,\n\toffAll,\n\tdebounce,\n\tthrottle,\n\tdelegate,\n\tonKey,\n\tkeys,\n\ttransformers,\n\n\t// WebSocket\n\tWSClient,\n\tinitWebSocket,\n\tgetWebSocketClient,\n\tsyncedRune,\n\tapplyStateUpdate,\n\n\t// Transitions\n\tfade,\n\tfly,\n\tslide,\n\tsetupTransitions,\n\n\t// Navigation\n\tnavigate,\n\tback,\n\tforward,\n\tgo,\n\tprefetch,\n\tgetCurrentPath,\n\tisNavigating,\n\tonBeforeNavigate,\n\tonAfterNavigate,\n\tinitNavigation,\n\tdestroyNavigation,\n\tcreateNavigationState\n};\n\n// Export types\nexport type { NavigationOptions };\n\n// Auto-initialize on DOM ready if data-gospa-auto is present\nif (typeof document !== 'undefined') {\n\tif (document.readyState === 'loading') {\n\t\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\t\tif (document.documentElement.hasAttribute('data-gospa-auto')) {\n\t\t\t\tautoInit();\n\t\t\t}\n\t\t});\n\t} else if (document.documentElement.hasAttribute('data-gospa-auto')) {\n\t\tautoInit();\n\t}\n}\n\n// Default export\nexport default {\n\tinit,\n\tcreateComponent,\n\tdestroyComponent,\n\tgetComponent,\n\tgetState,\n\tsetState,\n\tcallAction,\n\tbind,\n\tautoInit,\n\n\t// Re-exported for convenience\n\tRune,\n\tDerived,\n\tEffect,\n\tStateMap,\n\tbatch,\n\teffect,\n\twatch,\n\ton,\n\tdebounce,\n\tthrottle,\n\n\t// Transitions\n\tfade,\n\tfly,\n\tslide,\n\tsetupTransitions,\n\n\t// Navigation\n\tnavigate,\n\tback,\n\tforward,\n\tgo,\n\tprefetch,\n\tgetCurrentPath,\n\tisNavigating,\n\tonBeforeNavigate,\n\tonAfterNavigate,\n\tinitNavigation,\n\tdestroyNavigation,\n\tcreateNavigationState\n};\n"
  ],
  "mappings": "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",
  "debugId": "255410EC05215EBB64756E2164756E21",
  "names": []
}