import{M as L}from"./runtime-qrdd0a7v.js";import"./runtime-1w8zs78r.js";import"./runtime-vhktm8ba.js";var X={currentPath:window.location.pathname,isNavigating:!1,pendingNavigation:null},F=new Set,K=new Set;function f(j){return F.add(j),()=>F.delete(j)}function m(j){return K.add(j),()=>K.delete(j)}function H(j){let G=j.getAttribute("href");if(!G||G.startsWith("#")||G.startsWith("javascript:"))return!1;if(G.startsWith("http://")||G.startsWith("https://")||G.startsWith("//"))try{return new URL(G,window.location.origin).origin===window.location.origin}catch{return!1}if(j.hasAttribute("data-external")||j.hasAttribute("download")||j.getAttribute("target")==="_blank")return!1;return!0}var A=new Map;async function M(j){try{let G=await fetch(j,{headers:{"X-Requested-With":"GoSPA-Navigate",Accept:"text/html"}});if(!G.ok)return console.error("[GoSPA] Navigation failed:",G.status),null;let J=await G.text(),R=new DOMParser().parseFromString(J,"text/html"),Y=R.querySelector("[data-gospa-root]"),$=R.querySelector("main"),B=Y?Y.innerHTML:$?$.innerHTML:R.body.innerHTML,Q=R.querySelector("title")?.textContent||"",V=R.querySelector("head"),W=V?V.innerHTML:"";return{content:B,title:Q,head:W}}catch(G){return console.error("[GoSPA] Navigation error:",G),null}}async function O(j){let G=A.get(j);if(G)return A.delete(j),G;return M(j)}async function D(j){try{return await L(j)}catch(G){console.error("[GoSPA] Sanitization failed:",G);let J=document.createElement("div");return J.textContent=j,J.innerHTML}}async function P(j){if(j.title)document.title=j.title;console.log("[GoSPA DEBUG] Content before sanitization (first 500 chars):",j.content.substring(0,500));let G=document.querySelector("[data-gospa-root]"),J=await D(j.content);console.log("[GoSPA DEBUG] Content after sanitization (first 500 chars):",J.substring(0,500));let U=(j.content.match(/onclick=/g)||[]).length,R=(J.match(/onclick=/g)||[]).length;if(console.log("[GoSPA DEBUG] onclick attributes - Before:",U,"After:",R),G)G.innerHTML=J;else{let Y=document.querySelector("main");if(Y)Y.innerHTML=J;else document.body.innerHTML=J}if(y(j.head),await N(),window.__tw)console.log("[GoSPA DEBUG] Tailwind runtime detected, checking if rescan needed");console.log("[GoSPA DEBUG] DOM update complete, rootEl children:",G?.children.length)}function y(j){let J=new DOMParser().parseFromString(`<html><head>${j}</head></html>`,"text/html"),U=J.querySelector("head");if(!U)return;let R=J.querySelector("title")?.textContent;if(R&&R!==document.title)document.title=R;Array.from(U.querySelectorAll("link")).forEach((Q)=>{let V=Q.getAttribute("href"),W=Q.getAttribute("rel"),_=V?`link[href="${V}"]`:null;if(!(_?document.head.querySelector(_):null)){let I=Q.cloneNode(!0);I.setAttribute("data-gospa-head","true"),document.head.appendChild(I)}}),Array.from(U.querySelectorAll("meta")).forEach((Q)=>{let V=Q.getAttribute("name"),W=Q.getAttribute("property"),_=Q.getAttribute("http-equiv"),Z="";if(V)Z=`meta[name="${V}"]`;else if(W)Z=`meta[property="${W}"]`;else if(_)Z=`meta[http-equiv="${_}"]`;let I=Z?document.head.querySelector(Z):null;if(I){let q=Q.getAttribute("content");if(q)I.setAttribute("content",q)}else{let q=Q.cloneNode(!0);q.setAttribute("data-gospa-head","true"),document.head.appendChild(q)}}),Array.from(U.querySelectorAll("style")).forEach((Q)=>{let V=Q.id,W=V?`style#${V}`:null;if(!(W?document.head.querySelector(W):null)){let Z=Q.cloneNode(!0);Z.setAttribute("data-gospa-head","true"),document.head.appendChild(Z)}}),U.querySelectorAll("script[data-gospa-head]").forEach((Q)=>{let V=Q.getAttribute("src");if(!(V?document.head.querySelector(`script[src="${V}"]`):null)){let _=document.createElement("script");Array.from(Q.attributes).forEach((Z)=>_.setAttribute(Z.name,Z.value)),_.textContent=Q.textContent,document.head.appendChild(_)}})}async function N(){let j=document.querySelectorAll("[data-on]"),G=document.querySelectorAll("[data-bind]"),J=window.__gospa__,U=J?._ws;j.forEach((R)=>{let Y=R.getAttribute("data-on");if(!Y)return;let[$,B]=Y.split(":");if(!$||!B)return;let Q=R.cloneNode(!0);R.parentNode?.replaceChild(Q,R),Q.addEventListener($,()=>{if(U&&U.readyState===WebSocket.OPEN)U.send(JSON.stringify({action:B}))})});for(let R of G){let Y=R.getAttribute("data-bind");if(!Y)continue;let[$,B]=Y.split(":");if(!$||!B)continue;let Q=J?.state?.get(B);if(!Q)continue;let V=async(W)=>{switch($){case"text":R.textContent=W;break;case"html":R.innerHTML=await D(W);break;case"value":R.value=W;break;case"checked":R.checked=W;break;case"show":R.style.display=W?"":"none";break}};await V(Q.get()),Q.subscribe((W)=>V(W))}}async function S(j,G={}){if(j===X.currentPath&&!G.replace)return!1;if(X.pendingNavigation)await X.pendingNavigation;X.isNavigating=!0,F.forEach((J)=>J(j));try{return X.pendingNavigation=(async()=>{let J=await O(j);if(!J)return window.location.href=j,!1;if(G.replace)window.history.replaceState({path:j},"",j);else window.history.pushState({path:j},"",j);if(X.currentPath=j,await P(J),G.scrollToTop!==!1)window.scrollTo(0,0);return K.forEach((U)=>U(j)),!0})(),await X.pendingNavigation}finally{X.isNavigating=!1,X.pendingNavigation=null}}function g(){window.history.back()}function C(){window.history.forward()}function u(j){window.history.go(j)}function w(){return X.currentPath}function E(){return X.isNavigating}function T(j){let G=window.location.pathname;F.forEach((J)=>J(G)),O(G).then((J)=>{if(J)X.currentPath=G,P(J).then(()=>{K.forEach((U)=>U(G))});else window.location.reload()})}function z(j){if(j.button!==0||j.metaKey||j.ctrlKey||j.shiftKey||j.altKey)return;let J=j.target.closest("a[href]");if(!J)return;if(!H(J))return;j.preventDefault();let U=J.getAttribute("href");if(!U)return;S(U)}function x(){document.addEventListener("click",z),window.addEventListener("popstate",T),document.documentElement.setAttribute("data-gospa-spa","true"),console.log("[GoSPA] SPA navigation initialized")}function v(){document.removeEventListener("click",z),window.removeEventListener("popstate",T),document.documentElement.removeAttribute("data-gospa-spa")}async function k(j){if(A.has(j))return;let G=await M(j);if(G)A.set(j,G),setTimeout(()=>A.delete(j),30000)}function d(){return{get path(){return X.currentPath},get isNavigating(){return X.isNavigating},navigate:S,back:g,forward:C,go:u,prefetch:k}}if(typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",x);else x();export{k as prefetch,f as onBeforeNavigate,m as onAfterNavigate,S as navigate,E as isNavigating,x as initNavigation,u as go,w as getCurrentPath,C as forward,v as destroyNavigation,d as createNavigationState,g as back};
export{f as A,m as B,S as C,g as D,C as E,u as F,w as G,E as H,x as I,v as J,k as K,d as L};
