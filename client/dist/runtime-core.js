import{S as Qq,T as Uq,U as f,V as u,W as Yq,X as Zq}from"./runtime-kzfvzrpk.js";import{$ as n,aa as t,ba as y,ca as e,da as qq,ea as M,fa as b}from"./runtime-7ws0tb7k.js";import{na as H,oa as P}from"./runtime-sm05dxvs.js";var l={prevent:(q,Q)=>{return q.preventDefault(),Q(q)},stop:(q,Q)=>{return q.stopPropagation(),Q(q)},capture:(q,Q)=>Q(q),once:(q,Q)=>Q(q),passive:(q,Q)=>Q(q),self:(q,Q)=>{if(q.target===q.currentTarget)return Q(q)}},_=new WeakMap;function I(q,Q){return(U)=>{for(let Z of Q){if(Z==="capture"||Z==="once"||Z==="passive")continue;let $=l[Z];$(U,q)}if(Q.filter((Z)=>!["capture","once","passive"].includes(Z)).length===0)return q(U)}}function x(q){let Q=q.split(":"),U=Q[0],Y=Q.slice(1);return{event:U,modifiers:Y}}function h(q,Q,U){let{event:Y,modifiers:Z}=x(Q),$={capture:Z.includes("capture"),once:Z.includes("once"),passive:Z.includes("passive")},V=I(U,Z);if(q.addEventListener(Y,V,$),!_.has(q))_.set(q,new Map);let F=_.get(q);if(!F.has(Q))F.set(Q,new Set);return F.get(Q).add(V),()=>{q.removeEventListener(Y,V,$);let J=F.get(Q);if(J){if(J.delete(V),J.size===0)F.delete(Q)}}}function m(q){let Q=_.get(q);if(!Q)return;for(let[U,Y]of Q){let{event:Z,modifiers:$}=x(U),V={capture:$.includes("capture")};for(let F of Y)q.removeEventListener(Z,F,V)}_.delete(q)}function d(q,Q){let U=null;return(Y)=>{if(U)clearTimeout(U);U=setTimeout(()=>{q(Y),U=null},Q)}}function i(q,Q){let U=!1;return(Y)=>{if(!U)q(Y),U=!0,setTimeout(()=>{U=!1},Q)}}var r={value:(q)=>q.target.value,checked:(q)=>q.target.checked,numberValue:(q)=>Number(q.target.value),files:(q)=>q.target.files,formData:(q)=>{return q.preventDefault(),new FormData(q.target)}};function a(q,Q,U,Y){let{event:Z,modifiers:$}=x(U),V=(J)=>{if(J.target.closest(Q))I(Y,$)(J)},F={capture:$.includes("capture"),passive:$.includes("passive")};return q.addEventListener(Z,V,F),()=>{q.removeEventListener(Z,V,F)}}function s(q,Q,U){let Y=Array.isArray(q)?q:[q];return(Z)=>{if(Y.includes(Z.key)){if(U?.preventDefault)Z.preventDefault();Q(Z)}}}var o={enter:"Enter",escape:"Escape",tab:"Tab",space:" ",arrowUp:"ArrowUp",arrowDown:"ArrowDown",arrowLeft:"ArrowLeft",arrowRight:"ArrowRight"};var C="/_gospa/remote";function K(q){if(q.prefix)C=q.prefix}function A(){return C}async function O(q,Q,U={}){let Y=`${C}/${encodeURIComponent(q)}`,Z=U.timeout??30000,$=Z!==void 0||U.signal?new AbortController:null,V=$?setTimeout(()=>$.abort(),Z):null,F;if(U.signal&&$)F=()=>$.abort(),U.signal.addEventListener("abort",F);let J=$?.signal??U.signal;try{let G=await fetch(Y,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...U.headers},body:Q!==void 0?JSON.stringify(Q):void 0,signal:J,credentials:"same-origin"});if(V!==null)clearTimeout(V);let T,W,j;if(G.headers.get("content-type")?.includes("application/json"))try{let z=await G.json();if(j=z.code,!G.ok)W=z.error||`HTTP ${G.status}`;else T=z.data!==void 0?z.data:z}catch(z){W=z instanceof Error?`Invalid JSON: ${z.message}`:"Invalid JSON response",j="PARSE_ERROR"}else if(!G.ok)W=`HTTP ${G.status}: ${G.statusText}`,j="HTTP_ERROR";return{data:T,error:W,code:j,status:G.status,ok:G.ok}}catch(G){if(V!==null)clearTimeout(V);if(G instanceof Error){if(G.name==="AbortError")return{error:"Request timeout",code:"TIMEOUT",status:0,ok:!1};return{error:G.message,code:"NETWORK_ERROR",status:0,ok:!1}}return{error:"Unknown error",code:"UNKNOWN_ERROR",status:0,ok:!1}}finally{if(F&&U.signal)U.signal.removeEventListener("abort",F)}}function E(q){return(Q,U)=>{return O(q,Q,U)}}if(typeof window<"u")window.__GOSPA_REMOTE__={remote:O,remoteAction:E,configureRemote:K,getRemotePrefix:A};var X=new Map,D=new b,S=!1,N={},B=null,R=null,L=null;function $q(q={}){if(S){console.warn("GoSPA runtime already initialized");return}if(N=q,S=!0,N.wsUrl)B=import("./websocket-r6yz8xkx.js").then((Q)=>{return Q.initWebSocket({url:N.wsUrl,onMessage:Vq}).connect().catch((Y)=>{if(N.onConnectionError)N.onConnectionError(Y);else if(N.debug)console.error("WebSocket connection failed:",Y)}),Q});window.addEventListener("error",(Q)=>{if(N.debug)console.error("Runtime error:",Q.error)}),window.__GOSPA__={config:N,components:X,globalState:D,init:$q,createComponent:g,destroyComponent:Jq,getComponent:Xq,getState:c,setState:Nq,callAction:p,bind:w,autoInit:k,remote:O,remoteAction:E,configureRemote:K,getRemotePrefix:A}}function Vq(q){switch(q.type){case"init":if(q.componentId&&q.data){let Q=X.get(q.componentId);if(Q)Q.states.fromJSON(q.data)}else if(q.state){let Q=q.state;for(let[U,Y]of Object.entries(Q)){let Z=U.indexOf(".");if(Z>0){let $=U.substring(0,Z),V=U.substring(Z+1),F=X.get($);if(F)F.states.set(V,Y)}else{for(let $ of X.values())if($.states.get(U)!==void 0)$.states.set(U,Y);D.set(U,Y)}}}break;case"patch":if(q.patch){let Q=q.patch;D.fromJSON(Q)}break;case"update":if(q.componentId&&q.diff){let Q=X.get(q.componentId);if(Q)Q.states.fromJSON(q.diff)}break;case"sync":if(q.data)D.fromJSON(q.data);else if(q.key!==void 0&&q.value!==void 0){let{key:Q,componentId:U}=q;if(U){let Y=X.get(U);if(Y)Y.states.set(Q,q.value)}else D.set(Q,q.value)}break;case"error":if(N.debug)console.error("Server error:",q.error);break}}var v="gospa_local_";function Fq(q){try{let Q=localStorage.getItem(v+q);return Q?JSON.parse(Q):null}catch{return null}}function Gq(q,Q){try{localStorage.setItem(v+q,JSON.stringify(Q))}catch{}}function g(q,Q,U=!1){let Y={id:q.id,definition:q,states:new b,derived:new Map,unsubscribers:[],cleanup:[],element:Q||null,isLocal:U};if(U){let Z=Fq(q.id);if(Z)for(let[$,V]of Object.entries(Z))Y.states.set($,V)}for(let[Z,$]of Object.entries(q.state))if(!U||Y.states.get(Z)===void 0)Y.states.set(Z,$);if(U)for(let Z of Object.keys(q.state)){let $=Y.states.get(Z);if($){let V=M($,()=>{Gq(q.id,Y.states.toJSON())});Y.unsubscribers.push(V)}}if(q.computed)for(let[Z,$]of Object.entries(q.computed))Y.derived.set(Z,new y($));if(q.watch)for(let[Z,$]of Object.entries(q.watch)){let V=Y.states.get(Z);if(V)Y.unsubscribers.push(M(V,$))}if(q.mount){let Z=q.mount();if(Z)Y.cleanup.push(Z)}return X.set(q.id,Y),Y}function Jq(q){let Q=X.get(q);if(!Q)return;if(Q.definition.destroy)Q.definition.destroy();for(let U of Q.cleanup)U();for(let U of Q.unsubscribers)U();for(let U of Q.derived.values())U.dispose();X.delete(q)}function Xq(q){return X.get(q)}function c(q,Q){return X.get(q)?.states.get(Q)}async function Nq(q,Q,U){let Y=X.get(q);if(!Y)return;if(Y.states.set(Q,U),!Y.isLocal&&B){let $=(await B).getWebSocketClient();if($?.isConnected)$.send({type:"update",componentId:q,payload:{key:Q,value:U}})}}function p(q,Q,...U){let Y=X.get(q);if(!Y?.definition.actions?.[Q])throw Error(`Action "${Q}" not found on component "${q}"`);return Y.definition.actions[Q](...U)}function w(q,Q,U,Y,Z){let $=c(q,Y);if(!$)return console.warn(`State "${Y}" not found on component "${q}"`),()=>{};if(Z?.twoWay)return u(Q,$);return f(Q,$,{type:U,transform:Z?.transform})}function k(){let q=document.querySelectorAll("[data-gospa-component]");for(let Q of q){let U=Q.getAttribute("data-gospa-component"),Y=Q.getAttribute("data-gospa-state"),Z=Q.hasAttribute("data-gospa-local");if(!U)continue;let $={};try{$=Y?JSON.parse(Y):{}}catch{}let V=Q.getAttribute("data-gospa-hydrate")||N.hydration?.mode||"immediate",F=()=>{g({id:U,name:U,state:$},Q,Z),zq(Q)};if(V==="visible"){let J=new IntersectionObserver((G)=>{if(G[0].isIntersecting)J.disconnect(),F()});J.observe(Q)}else if(V==="idle"&&"requestIdleCallback"in window)window.requestIdleCallback(()=>F(),{timeout:N.hydration?.timeout||2000});else F()}}function zq(q=document){for(let Q of q.querySelectorAll("[data-bind]")){let U=Q.closest("[data-gospa-component]")?.getAttribute("data-gospa-component")||"",Y=Q.getAttribute("data-bind"),Z=Q.getAttribute("data-transform");if(!Y)continue;let[$,V="text"]=Y.split(":").map((J)=>J.trim()),F;if(Z&&typeof window[Z]==="function")F=window[Z];w(U,Q,V,$,{transform:F})}for(let Q of q.querySelectorAll("[data-on]")){let U=Q.closest("[data-gospa-component]")?.getAttribute("data-gospa-component")||"",Y=Q.getAttribute("data-on");if(!Y)continue;let[Z,$,V]=Y.split(":").map((J)=>J.trim()),F=V?V.split(",").map((J)=>J.trim()):[];h(Q,Z,async()=>{try{p(U,$,...F)}catch{if(B){let G=(await B).getWebSocketClient();if(G?.isConnected)G.sendAction($)}}})}for(let Q of q.querySelectorAll("[data-model]")){let U=Q.closest("[data-gospa-component]")?.getAttribute("data-gospa-component")||"",Y=Q.getAttribute("data-model");if(Y)w(U,Q,"value",Y,{twoWay:!0})}}async function Pq(){if(!B)B=import("./websocket-r6yz8xkx.js");return B}async function Tq(){if(!R)R=import("./navigation-bcv51k26.js");return R}async function xq(){if(!L)L=import("./transition-5yeb629b.js");return L}if(typeof document<"u"){if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>{if(document.documentElement.hasAttribute("data-gospa-auto"))k()});else if(document.documentElement.hasAttribute("data-gospa-auto"))k()}export{M as watch,Uq as unregisterBinding,r as transformers,i as throttle,Nq as setState,Zq as renderList,Yq as renderIf,E as remoteAction,O as remote,Qq as registerBinding,s as onKey,h as on,m as offAll,o as keys,$q as init,Pq as getWebSocket,xq as getTransitions,c as getState,A as getRemotePrefix,Tq as getNavigation,Xq as getComponent,qq as effect,Jq as destroyComponent,a as delegate,d as debounce,g as createComponent,K as configureRemote,p as callAction,u as bindTwoWay,f as bindElement,w as bind,n as batch,k as autoInit,b as StateMap,t as Rune,e as Effect,y as Derived};
export{h as a,m as b,d as c,i as d,r as e,a as f,s as g,o as h,K as i,A as j,O as k,E as l,$q as m,g as n,Jq as o,Xq as p,c as q,Nq as r,p as s,w as t,k as u,Pq as v,Tq as w,xq as x};
