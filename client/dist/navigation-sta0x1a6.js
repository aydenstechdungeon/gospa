import{M}from"./runtime-qrdd0a7v.js";import"./runtime-1w8zs78r.js";import"./runtime-vhktm8ba.js";var W={currentPath:window.location.pathname,isNavigating:!1,pendingNavigation:null},K=new Set,x=new Set;function f(j){return K.add(j),()=>K.delete(j)}function m(j){return x.add(j),()=>x.delete(j)}function H(j){let B=j.getAttribute("href");if(!B||B.startsWith("#")||B.startsWith("javascript:"))return!1;if(B.startsWith("http://")||B.startsWith("https://")||B.startsWith("//"))try{return new URL(B,window.location.origin).origin===window.location.origin}catch{return!1}if(j.hasAttribute("data-external")||j.hasAttribute("download")||j.getAttribute("target")==="_blank")return!1;return!0}var q=new Map;async function O(j){try{let B=await fetch(j,{headers:{"X-Requested-With":"GoSPA-Navigate",Accept:"text/html"}});if(!B.ok)return console.error("[GoSPA] Navigation failed:",B.status),null;let G=await B.text(),Q=new DOMParser().parseFromString(G,"text/html"),Z=Q.querySelector("[data-gospa-root]"),_=Q.querySelector("main"),$=Z?Z.innerHTML:_?_.innerHTML:Q.body.innerHTML,J=Q.querySelector("title")?.textContent||"",U=Q.querySelector("head"),V=U?U.innerHTML:"";return{content:$,title:J,head:V}}catch(B){return console.error("[GoSPA] Navigation error:",B),null}}async function D(j){let B=q.get(j);if(B)return q.delete(j),B;return O(j)}async function F(j){try{return await M(j)}catch(B){console.error("[GoSPA] Sanitization failed:",B);let G=document.createElement("div");return G.textContent=j,G.innerHTML}}async function z(j){if(j.title)document.title=j.title;let B=document.querySelector("[data-gospa-root]");if(B)B.innerHTML=await F(j.content);else{let G=document.querySelector("main");if(G)G.innerHTML=await F(j.content);else document.body.innerHTML=await F(j.content)}y(j.head),await N()}function y(j){let G=new DOMParser().parseFromString(`<html><head>${j}</head></html>`,"text/html"),R=G.querySelector("head");if(!R)return;let Q=G.querySelector("title")?.textContent;if(Q&&Q!==document.title)document.title=Q;Array.from(R.querySelectorAll("link")).forEach((J)=>{let U=J.getAttribute("href"),V=J.getAttribute("rel"),Y=U?`link[href="${U}"]`:null;if(!(Y?document.head.querySelector(Y):null)){let A=J.cloneNode(!0);A.setAttribute("data-gospa-head","true"),document.head.appendChild(A)}}),Array.from(R.querySelectorAll("meta")).forEach((J)=>{let U=J.getAttribute("name"),V=J.getAttribute("property"),Y=J.getAttribute("http-equiv"),X="";if(U)X=`meta[name="${U}"]`;else if(V)X=`meta[property="${V}"]`;else if(Y)X=`meta[http-equiv="${Y}"]`;let A=X?document.head.querySelector(X):null;if(A){let I=J.getAttribute("content");if(I)A.setAttribute("content",I)}else{let I=J.cloneNode(!0);I.setAttribute("data-gospa-head","true"),document.head.appendChild(I)}}),Array.from(R.querySelectorAll("style")).forEach((J)=>{let U=J.id,V=U?`style#${U}`:null;if(!(V?document.head.querySelector(V):null)){let X=J.cloneNode(!0);X.setAttribute("data-gospa-head","true"),document.head.appendChild(X)}}),R.querySelectorAll("script[data-gospa-head]").forEach((J)=>{let U=J.getAttribute("src");if(!(U?document.head.querySelector(`script[src="${U}"]`):null)){let Y=document.createElement("script");Array.from(J.attributes).forEach((X)=>Y.setAttribute(X.name,X.value)),Y.textContent=J.textContent,document.head.appendChild(Y)}})}async function N(){let j=document.querySelectorAll("[data-on]"),B=document.querySelectorAll("[data-bind]"),G=window.__gospa__,R=G?._ws;j.forEach((Q)=>{let Z=Q.getAttribute("data-on");if(!Z)return;let[_,$]=Z.split(":");if(!_||!$)return;let J=Q.cloneNode(!0);Q.parentNode?.replaceChild(J,Q),J.addEventListener(_,()=>{if(R&&R.readyState===WebSocket.OPEN)R.send(JSON.stringify({action:$}))})});for(let Q of B){let Z=Q.getAttribute("data-bind");if(!Z)continue;let[_,$]=Z.split(":");if(!_||!$)continue;let J=G?.state?.get($);if(!J)continue;let U=async(V)=>{switch(_){case"text":Q.textContent=V;break;case"html":Q.innerHTML=await F(V);break;case"value":Q.value=V;break;case"checked":Q.checked=V;break;case"show":Q.style.display=V?"":"none";break}};await U(J.get()),J.subscribe((V)=>U(V))}}async function P(j,B={}){if(j===W.currentPath&&!B.replace)return!1;if(W.pendingNavigation)await W.pendingNavigation;W.isNavigating=!0,K.forEach((G)=>G(j));try{return W.pendingNavigation=(async()=>{let G=await D(j);if(!G)return window.location.href=j,!1;if(B.replace)window.history.replaceState({path:j},"",j);else window.history.pushState({path:j},"",j);if(W.currentPath=j,await z(G),B.scrollToTop!==!1)window.scrollTo(0,0);return x.forEach((R)=>R(j)),!0})(),await W.pendingNavigation}finally{W.isNavigating=!1,W.pendingNavigation=null}}function C(){window.history.back()}function g(){window.history.forward()}function u(j){window.history.go(j)}function w(){return W.currentPath}function E(){return W.isNavigating}function T(j){let B=window.location.pathname;K.forEach((G)=>G(B)),D(B).then((G)=>{if(G)W.currentPath=B,z(G).then(()=>{x.forEach((R)=>R(B))});else window.location.reload()})}function S(j){if(j.button!==0||j.metaKey||j.ctrlKey||j.shiftKey||j.altKey)return;let G=j.target.closest("a[href]");if(!G)return;if(!H(G))return;j.preventDefault();let R=G.getAttribute("href");if(!R)return;P(R)}function L(){document.addEventListener("click",S),window.addEventListener("popstate",T),document.documentElement.setAttribute("data-gospa-spa","true"),console.log("[GoSPA] SPA navigation initialized")}function v(){document.removeEventListener("click",S),window.removeEventListener("popstate",T),document.documentElement.removeAttribute("data-gospa-spa")}async function k(j){if(q.has(j))return;let B=await O(j);if(B)q.set(j,B),setTimeout(()=>q.delete(j),30000)}function d(){return{get path(){return W.currentPath},get isNavigating(){return W.isNavigating},navigate:P,back:C,forward:g,go:u,prefetch:k}}if(typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",L);else L();export{k as prefetch,f as onBeforeNavigate,m as onAfterNavigate,P as navigate,E as isNavigating,L as initNavigation,u as go,w as getCurrentPath,g as forward,v as destroyNavigation,d as createNavigationState,C as back};
export{f as A,m as B,P as C,C as D,g as E,u as F,w as G,E as H,L as I,v as J,k as K,d as L};
